"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([["1381"],{75813(e,n,r){r.r(n),r.d(n,{metadata:()=>i,default:()=>h,frontMatter:()=>a,contentTitle:()=>l,toc:()=>o,assets:()=>d});var i=JSON.parse('{"id":"advanced/com/methods","title":"Methods","description":"package:win32 exposes COM methods with idiomatic Dart","source":"@site/docs/advanced/com/methods.md","sourceDirName":"advanced/com","slug":"/advanced/com/methods","permalink":"/docs/advanced/com/methods","draft":false,"unlisted":false,"editUrl":"https://github.com/halildurmus/win32/tree/main/website/docs/advanced/com/methods.md","tags":[],"version":"current","lastUpdatedBy":"Halil Durmus","lastUpdatedAt":1772220481000,"frontMatter":{"title":"Methods"},"sidebar":"mainSidebar","previous":{"title":"Basic Concepts","permalink":"/docs/advanced/com/basic-concepts"},"next":{"title":"Leak Tracking","permalink":"/docs/advanced/leak-tracking"}}'),s=r(74848),t=r(28453);let a={title:"Methods"},l,d={},o=[{value:"Reserved and Optional Parameters",id:"reserved-and-optional-parameters",level:2},{value:"Reserved Parameters",id:"reserved-parameters",level:3},{value:"Optional Parameters",id:"optional-parameters",level:3},{value:"Win32 <code>BOOL</code> Becomes Dart <code>bool</code>",id:"win32-bool-becomes-dart-bool",level:2},{value:"<code>HRESULT</code>-Based APIs",id:"hresult-based-apis",level:2},{value:"Failures Throw",id:"failures-throw",level:3},{value:"Out Parameters Become Return Values",id:"out-parameters-become-return-values",level:3},{value:"COM Queries Return Typed Interfaces",id:"com-queries-return-typed-interfaces",level:2},{value:"Method Transformations",id:"method-transformations",level:2},{value:"Getter and Setter Projections",id:"getter-and-setter-projections",level:3},{value:"General Name Normalization",id:"general-name-normalization",level:3},{value:"Dart Name Conflicts",id:"dart-name-conflicts",level:3},{value:"Overloaded Methods",id:"overloaded-methods",level:3}];function c(e){let n={a:"a",admonition:"admonition",code:"code",em:"em",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.a,{href:"https://pub.dev/packages/win32",children:(0,s.jsx)(n.code,{children:"package:win32"})})," exposes COM methods with idiomatic Dart\nsignatures."]}),"\n",(0,s.jsx)(n.h2,{id:"reserved-and-optional-parameters",children:"Reserved and Optional Parameters"}),"\n",(0,s.jsx)(n.p,{children:"Some COM methods include parameters that are not always meaningful to the\ncaller."}),"\n",(0,s.jsx)(n.p,{children:"These fall into two distinct categories."}),"\n",(0,s.jsx)(n.h3,{id:"reserved-parameters",children:"Reserved Parameters"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.em,{children:"Reserved"})," parameters exist only for ABI or historical compatibility. They\nmust always be set to ",(0,s.jsx)(n.code,{children:"0"})," or ",(0,s.jsx)(n.a,{href:"https://api.dart.dev/dart-ffi/nullptr.html",children:(0,s.jsx)(n.code,{children:"nullptr"})})," and have no semantic meaning."]}),"\n",(0,s.jsxs)(n.p,{children:["In ",(0,s.jsx)(n.code,{children:"package:win32"}),", reserved parameters are ",(0,s.jsx)(n.strong,{children:"removed entirely"})," from the Dart\nsignature and supplied automatically behind the scenes."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-dart",children:"final storage = IStorage(...);\n// Native: storage::EnumElements(NULL, NULL, NULL, &enum);\n// highlight-next-line\nstorage.enumElements();\n"})}),"\n",(0,s.jsx)(n.p,{children:"You never see or pass reserved parameters in Dart."}),"\n",(0,s.jsx)(n.h3,{id:"optional-parameters",children:"Optional Parameters"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.em,{children:"Optional"})," parameters are semantically meaningful but not required for all\ncalls. They may accept real values (such as pointers or integers), but can also\nbe omitted."]}),"\n",(0,s.jsxs)(n.p,{children:["In ",(0,s.jsx)(n.code,{children:"package:win32"}),", optional parameters are projected as\n",(0,s.jsx)(n.strong,{children:"nullable Dart types"}),". Passing ",(0,s.jsx)(n.code,{children:"null"})," maps to ",(0,s.jsx)(n.code,{children:"0"})," or ",(0,s.jsx)(n.code,{children:"nullptr"})," on the native\nside."]}),"\n",(0,s.jsx)(n.p,{children:"This makes it explicit at the call site which parameters are optional, while\nstill allowing real values to be passed when needed."}),"\n",(0,s.jsxs)(n.h2,{id:"win32-bool-becomes-dart-bool",children:["Win32 ",(0,s.jsx)(n.code,{children:"BOOL"})," Becomes Dart ",(0,s.jsx)(n.code,{children:"bool"})]}),"\n",(0,s.jsxs)(n.p,{children:["Win32 APIs that use the ",(0,s.jsx)(n.code,{children:"BOOL"})," type are projected to Dart ",(0,s.jsx)(n.code,{children:"bool"}),"."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-dart",children:"final network = INetwork(...);\n// highlight-next-line\nif (!network.isConnectedToInternet) {\n  // handle not connected\n}\n"})}),"\n",(0,s.jsxs)(n.p,{children:["You never work with ",(0,s.jsx)(n.code,{children:"TRUE"}),", ",(0,s.jsx)(n.code,{children:"FALSE"}),", or integer return values \u2014 only Dart\n",(0,s.jsx)(n.code,{children:"bool"}),"."]}),"\n",(0,s.jsxs)(n.h2,{id:"hresult-based-apis",children:[(0,s.jsx)(n.code,{children:"HRESULT"}),"-Based APIs"]}),"\n",(0,s.jsxs)(n.p,{children:["Most COM methods return an ",(0,s.jsx)(n.a,{href:"https://wikipedia.org/wiki/HRESULT",children:(0,s.jsx)(n.code,{children:"HRESULT"})}),". In ",(0,s.jsx)(n.code,{children:"package:win32"}),", you almost\nnever handle ",(0,s.jsx)(n.code,{children:"HRESULT"})," values directly."]}),"\n",(0,s.jsx)(n.h3,{id:"failures-throw",children:"Failures Throw"}),"\n",(0,s.jsxs)(n.p,{children:["If a COM method reports failure via ",(0,s.jsx)(n.code,{children:"HRESULT"}),", the Dart function throws a\n",(0,s.jsx)(n.a,{href:"https://pub.dev/documentation/win32/latest/win32/WindowsException-class.html",children:(0,s.jsx)(n.code,{children:"WindowsException"})}),"."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-dart",children:"using((arena) {\n  final dialog = arena.com<IFileOpenDialog>(FileOpenDialog);\n  // If the interface is not supported, a WindowsException is thrown.\n  // highlight-next-line\n  dialog.queryInterface<IDesktopWallpaper>();\n});\n"})}),"\n",(0,s.jsx)(n.p,{children:"You can still catch and handle failures explicitly:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-dart",children:"using((arena) {\n  // highlight-next-line\n  try {\n    final dialog = arena.com<IFileOpenDialog>(FileOpenDialog);\n    dialog.queryInterface<IDesktopWallpaper>();\n  // highlight-next-line\n  } on WindowsException catch (e) {\n    // handle error\n    if (e.hr == E_NOINTERFACE) {\n      // specific handling\n    }\n  }\n});\n"})}),"\n",(0,s.jsx)(n.h3,{id:"out-parameters-become-return-values",children:"Out Parameters Become Return Values"}),"\n",(0,s.jsx)(n.p,{children:"If a method logically produces a value via an out parameter, the Dart projection\nreturns that value directly."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-dart",children:"final errorInfo = IErrorInfo(...);\nfinal guid = errorInfo.getGUID(); // returns Pointer<GUID>\n"})}),"\n",(0,s.jsxs)(n.p,{children:["You do not pass output buffers or inspect ",(0,s.jsx)(n.code,{children:"HRESULT"}),"s manually."]}),"\n",(0,s.jsx)(n.admonition,{type:"note",children:(0,s.jsxs)(n.p,{children:["Returned pointers and COM objects follow the same ownership rules as their\nnative counterparts. Be sure to ",(0,s.jsx)(n.a,{href:"https://pub.dev/documentation/win32/latest/win32/free.html",children:(0,s.jsx)(n.code,{children:"free"})})," or ",(0,s.jsx)(n.a,{href:"https://pub.dev/documentation/win32/latest/win32/IUnknown/release.html",children:(0,s.jsx)(n.code,{children:"release"})})," them as\nappropriate."]})}),"\n",(0,s.jsx)(n.h2,{id:"com-queries-return-typed-interfaces",children:"COM Queries Return Typed Interfaces"}),"\n",(0,s.jsxs)(n.p,{children:["Methods that conceptually ",(0,s.jsx)(n.em,{children:"query"})," an interface are projected as generic Dart\nmethods that return the requested type directly."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-dart",children:"using((arena) {\n  // Create the FileOpenDialog COM object.\n  final fileDialog = arena.com<IFileDialog>(FileOpenDialog);\n\n  // Query additional interfaces from the same COM object.\n  // highlight-next-line\n  final fileDialog2 = arena.adopt(fileDialog.queryInterface<IFileDialog2>());\n});\n"})}),"\n",(0,s.jsx)(n.p,{children:"You don't pass IIDs or output pointers. The returned object is already typed and\nready to use."}),"\n",(0,s.jsx)(n.h2,{id:"method-transformations",children:"Method Transformations"}),"\n",(0,s.jsx)(n.p,{children:"COM method names are systematically normalized into Dart-safe, camel-cased\nidentifiers."}),"\n",(0,s.jsx)(n.p,{children:"The transformation is deterministic and follows these rules:"}),"\n",(0,s.jsx)(n.h3,{id:"getter-and-setter-projections",children:"Getter and Setter Projections"}),"\n",(0,s.jsx)(n.p,{children:"Methods that follow COM property conventions are mapped to idiomatic Dart\naccessors:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"get_Foo"})," \u2192 ",(0,s.jsx)(n.code,{children:"foo"})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"put_Foo"})," \u2192 ",(0,s.jsx)(n.code,{children:"setFoo"})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"putref_Foo"})," \u2192 ",(0,s.jsx)(n.code,{children:"setFoo"})]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"general-name-normalization",children:"General Name Normalization"}),"\n",(0,s.jsx)(n.p,{children:"For all other methods:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Underscore-separated names are converted to lower camelCase\n(",(0,s.jsx)(n.code,{children:"Enum_Elements"})," \u2192 ",(0,s.jsx)(n.code,{children:"enumElements"}),")"]}),"\n",(0,s.jsx)(n.li,{children:"The first segment is preserved as-is"}),"\n",(0,s.jsx)(n.li,{children:"Subsequent segments are capitalized"}),"\n",(0,s.jsx)(n.li,{children:"The final name is sanitized into a valid Dart identifier"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Examples:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"add_Item"})," \u2192 ",(0,s.jsx)(n.code,{children:"addItem"})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"remove_EventHandler"})," \u2192 ",(0,s.jsx)(n.code,{children:"removeEventHandler"})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"get_Value"})," \u2192 ",(0,s.jsx)(n.code,{children:"value"})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"put_Value"})," \u2192 ",(0,s.jsx)(n.code,{children:"setValue"})]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"dart-name-conflicts",children:"Dart Name Conflicts"}),"\n",(0,s.jsx)(n.p,{children:"Certain COM method names conflict with core Dart members."}),"\n",(0,s.jsx)(n.p,{children:"These are handled explicitly:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"get_RuntimeType"})," \u2192 ",(0,s.jsx)(n.code,{children:"runtimeType$"})," (avoids collision with\n",(0,s.jsx)(n.code,{children:"Object.runtimeType"}),")"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"ToString"}),", ",(0,s.jsx)(n.code,{children:"toString"})," \u2192 ",(0,s.jsx)(n.code,{children:"toUtf16String"})," (avoids collision with\n",(0,s.jsx)(n.code,{children:"Object.toString"}),")"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"overloaded-methods",children:"Overloaded Methods"}),"\n",(0,s.jsxs)(n.p,{children:["Dart does not support overloaded methods. When multiple COM methods share the\nsame name (including inherited methods), ",(0,s.jsx)(n.code,{children:"package:win32"})," disambiguates them\nby appending a numeric suffix."]}),"\n",(0,s.jsx)(n.p,{children:"The suffix is assigned deterministically based on the overload order in the\ninterface hierarchy."}),"\n",(0,s.jsx)(n.p,{children:"Examples:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"GetValue"})," \u2192 ",(0,s.jsx)(n.code,{children:"getValue"})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"GetValue"})," (overload) \u2192 ",(0,s.jsx)(n.code,{children:"getValue1"})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"GetValue"})," (second overload) \u2192 ",(0,s.jsx)(n.code,{children:"getValue2"})]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["Overload detection traverses the full interface inheritance chain to ensure that\nshadowed or versioned methods (e.g., ",(0,s.jsx)(n.code,{children:"IDWriteFactory1"})," vs ",(0,s.jsx)(n.code,{children:"IDWriteFactory2"}),") are\nhandled correctly."]}),"\n",(0,s.jsx)(n.p,{children:"This guarantees that:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"No projected method names collide"}),"\n",(0,s.jsx)(n.li,{children:"All COM methods remain accessible"}),"\n",(0,s.jsx)(n.li,{children:"Naming remains stable across releases"}),"\n"]})]})}function h(e={}){let{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},28453(e,n,r){r.d(n,{R:()=>a,x:()=>l});var i=r(96540);let s={},t=i.createContext(s);function a(e){let n=i.useContext(t);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),i.createElement(t.Provider,{value:n},e.children)}}}]);