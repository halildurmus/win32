"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([["6607"],{77735(n){n.exports=JSON.parse('{"archive":{"blogPosts":[{"id":"calling-windows-apis","metadata":{"permalink":"/blog/calling-windows-apis","source":"@site/blog/2024/07-10-calling-windows-apis/index.mdx","title":"Calling Windows APIs in Dart with win32","description":"Learn how to call Windows APIs in Dart with the win32 package. Start with simple examples and explore its wide range of applications.","date":"2024-07-10T00:00:00.000Z","tags":[{"inline":true,"label":"win32","permalink":"/blog/tags/win-32"},{"inline":true,"label":"dart","permalink":"/blog/tags/dart"}],"readingTime":3.75,"hasTruncateMarker":true,"authors":[{"name":"Halil Durmus","title":"Software Engineer / Maintainer of win32","url":"https://halildurmus.dev","page":{"permalink":"/blog/authors/halildurmus"},"socials":{"github":"https://github.com/halildurmus"},"github":"https://github.com/halildurmus","imageURL":"https://github.com/halildurmus.png","key":"halildurmus"}],"frontMatter":{"title":"Calling Windows APIs in Dart with win32","description":"Learn how to call Windows APIs in Dart with the win32 package. Start with simple examples and explore its wide range of applications.","slug":"calling-windows-apis","authors":"halildurmus","tags":["win32","dart"],"image":"https://ik.imagekit.io/npajaqrcn/blog/2024-07-10-calling-windows-apis/social.png","hide_table_of_contents":false,"is_featured":true},"unlisted":false},"content":"## Introduction\\n\\nAs Dart expands its reach beyond web and mobile development, interacting with\\nnative Windows APIs unlocks a world of possibilities.\\n\\n[`package:win32`][package:win32] serves as a bridge to the powerful features of\\nthe Windows operating system, allowing Dart developers to harness these\\ncapabilities directly in their applications.\\n\\nIn this blog post, we\'ll explore how to use `package:win32` to call Windows APIs\\nin Dart, enabling you to create powerful Windows applications with ease.\\n\\n\x3c!--truncate--\x3e\\n\\nHere\'s what we\'ll cover:\\n\\n- [Getting Started](#getting-started)\\n- [Interacting with Windows APIs](#interacting-with-windows-apis)\\n  - [Displaying a Message Box](#displaying-a-message-box)\\n  - [Retrieving the System Memory](#retrieving-the-system-memory)\\n  - [Creating a Classic Win32 Window](#creating-a-classic-win32-window)\\n- [Conclusion](#conclusion)\\n\\n## Getting Started\\n\\nLet\'s dive into how you can get started with `package:win32` package and see it\\nin action.\\n\\nAdd the **ffi** and **win32** packages to your project with:\\n\\n```cmd title=\\"Terminal\\"\\ndart pub add ffi win32\\n```\\n\\n## Interacting with Windows APIs\\n\\nLet\'s explore how you can interact with the Windows APIs using `package:win32`.\\n\\n### Displaying a Message Box\\n\\nLet\'s start with a simple example that displays a message box using the\\n[`MessageBox`][MessageBox] function from the Windows API.\\n\\n```dart\\nimport \'package:ffi/ffi.dart\';\\nimport \'package:win32/win32.dart\';\\n\\nvoid main() {\\n  using((arena) {\\n    final Win32Result(:value, :error) = MessageBox(\\n      null,\\n      arena.pcwstr(\'Hello from Dart\'),\\n      arena.pcwstr(\'Dart Win32 MessageBox Demo\'),\\n      MB_OK | MB_ICONINFORMATION,\\n    );\\n    switch (value) {\\n      case IDOK:\\n        print(\'OK pressed\');\\n      case 0:\\n        throw WindowsException(error.toHRESULT());\\n    }\\n  });\\n}\\n```\\n\\n![MessageBox](./img/messagebox.png)\\n\\n### Retrieving the System Memory\\n\\nNext, let\'s retrieve the total amount of physical memory installed on the\\nsystem using the\\n[`GetPhysicallyInstalledSystemMemory`][GetPhysicallyInstalledSystemMemory]\\nfunction.\\n\\n```dart title=\\"sysinfo.dart\\"\\nString getSystemMemorySize() {\\n  return using((arena) {\\n    final lpMemorySize = arena<ULONGLONG>();\\n    final Win32Result(:value, :error) = GetPhysicallyInstalledSystemMemory(\\n      lpMemorySize,\\n    );\\n    if (!value) throw WindowsException(error.toHRESULT());\\n    return lpMemorySize.value ~/ 1024;\\n  });\\n}\\n```\\n\\n<CommonViewSourceCode href=\\"https://github.com/halildurmus/win32/blob/main/examples/sysinfo.dart\\" />\\n\\n![System Memory](./img/memory.png)\\n\\n### Creating a Classic Win32 Window\\n\\nFinally, let\'s create a classic Win32 window. First, we\'ll define the window\\nprocedure that will handle messages sent to the window.\\n\\n```dart title=\\"hello.dart\\"\\nimport \'dart:ffi\';\\n\\nimport \'package:ffi/ffi.dart\';\\nimport \'package:ffi_leak_tracker/ffi_leak_tracker.dart\';\\nimport \'package:win32/win32.dart\';\\n\\nint mainWindowProc(Pointer hWnd, int uMsg, int wParam, int lParam) {\\n  final hwnd = HWND(hWnd);\\n  switch (uMsg) {\\n    case WM_DESTROY:\\n      PostQuitMessage(0);\\n      return 0;\\n\\n    case WM_PAINT:\\n      final ps = adaptiveCalloc<PAINTSTRUCT>();\\n      final hdc = BeginPaint(hwnd, ps);\\n      final rect = adaptiveCalloc<RECT>();\\n      final msg = \'Hello, Dart!\'.toPcwstr();\\n\\n      GetClientRect(hwnd, rect);\\n      DrawText(hdc, msg, -1, rect, DT_CENTER | DT_VCENTER | DT_SINGLELINE);\\n      EndPaint(hwnd, ps);\\n\\n      free(msg);\\n      free(rect);\\n      free(ps);\\n\\n      return 0;\\n  }\\n\\n  return DefWindowProc(hwnd, uMsg, .new(wParam), .new(lParam));\\n}\\n```\\n\\nNext, we\'ll define the `winMain` entry point, which creates the window and runs\\nthe message loop.\\n\\n```dart title=\\"hello.dart\\"\\n// ...\\n\\nvoid winMain(HINSTANCE hInstance, List<String> args, SHOW_WINDOW_CMD nShowCmd) {\\n  using((arena) {\\n    final lpfnWndProc = NativeCallable<WNDPROC>.isolateLocal(\\n      mainWindowProc,\\n      exceptionalReturn: 0,\\n    );\\n\\n    final className = arena.pcwstr(\'Sample Window Class\');\\n\\n    final wc = arena<WNDCLASS>();\\n    wc.ref\\n      ..style = CS_HREDRAW | CS_VREDRAW\\n      ..lpfnWndProc = lpfnWndProc.nativeFunction\\n      ..hInstance = hInstance\\n      ..lpszClassName = .new(className)\\n      ..hCursor = LoadCursor(null, IDC_ARROW).value\\n      ..hbrBackground = .new(GetStockObject(WHITE_BRUSH));\\n    final result = RegisterClass(wc);\\n    if (result.value == 0) throw WindowsException(result.error.toHRESULT());\\n\\n    // Create the window.\\n    final windowCaption = arena.pcwstr(\'Dart Native Win32 window\');\\n    final Win32Result(value: hWnd, :error) = CreateWindowEx(\\n      WS_EX_LEFT, // Optional window styles.\\n      className, // Window class\\n      windowCaption, // Window caption\\n      WS_OVERLAPPEDWINDOW, // Window style\\n      // Size and position\\n      CW_USEDEFAULT,\\n      CW_USEDEFAULT,\\n      CW_USEDEFAULT,\\n      CW_USEDEFAULT,\\n      null, // Parent window\\n      null, // Menu\\n      hInstance, // Instance handle\\n      null, // Additional application data\\n    );\\n    if (hWnd.isNull) throw WindowsException(error.toHRESULT());\\n\\n    ShowWindow(hWnd, nShowCmd);\\n    UpdateWindow(hWnd);\\n\\n    // Run the message loop.\\n    final msg = arena<MSG>();\\n    while (GetMessage(msg, null, 0, 0).value) {\\n      TranslateMessage(msg);\\n      DispatchMessage(msg);\\n    }\\n\\n    UnregisterClass(className, hInstance);\\n    lpfnWndProc.close();\\n  });\\n}\\n```\\n\\nFinally, we\'ll define the `main()` function to initialize the application and\\ncall the `winMain()` function. The `package:win32` provides the\\n[`initApp`][initApp] helper function, which sets up the WinMain function with\\nall the necessary information, including the entry point and command line\\narguments, simplifying the process for you.\\n\\n```dart title=\\"hello.dart\\"\\n// ...\\n\\nvoid main() => initApp(winMain);\\n```\\n\\n![Dart Native Win32 Window](./img/hello.png)\\n\\n## Conclusion\\n\\n`package:win32` is a powerful tool for Dart developers aiming to leverage the\\nfull capabilities of the Windows operating system. By bridging the gap between\\nDart and the extensive Windows APIs, `package:win32` enables you to create\\nfeature-rich applications with ease.\\n\\nWhether you\'re displaying simple message boxes, querying system information, or\\ncreating complex graphical interfaces, `package:win32` unlocks new possibilities\\nfor your Dart projects. Start exploring today and discover what you can build\\nwith Dart and Windows APIs!\\n\\nFor more detailed information, check out our [documentation](/docs).\\n\\n[package:win32]: https://pub.dev/packages/win32\\n[GetPhysicallyInstalledSystemMemory]: https://docs.microsoft.com/windows/win32/api/sysinfoapi/nf-sysinfoapi-getphysicallyinstalledsystemmemory\\n[MessageBox]: https://learn.microsoft.com/windows/win32/api/winuser/nf-winuser-messagebox\\n[initApp]: https://pub.dev/documentation/win32/latest/win32/initApp.html"}]}}')}}]);