"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([["6541"],{20529(e,n,r){r.r(n),r.d(n,{metadata:()=>t,default:()=>h,frontMatter:()=>i,contentTitle:()=>l,toc:()=>d,assets:()=>o});var t=JSON.parse('{"id":"core/functions","title":"Functions","description":"package:win32 exposes Win32 APIs as","source":"@site/docs/core/functions.md","sourceDirName":"core","slug":"/core/functions","permalink":"/docs/core/functions","draft":false,"unlisted":false,"editUrl":"https://github.com/halildurmus/win32/tree/main/website/docs/core/functions.md","tags":[],"version":"current","lastUpdatedBy":"Halil Durmus","lastUpdatedAt":1772220481000,"frontMatter":{"title":"Functions"},"sidebar":"mainSidebar","previous":{"title":"Quick Start","permalink":"/docs/getting-started/quick-start"},"next":{"title":"Memory Allocation","permalink":"/docs/core/memory-allocation"}}'),s=r(74848),a=r(28453);let i={title:"Functions"},l,o={},d=[{value:"Reserved and Optional Parameters",id:"reserved-and-optional-parameters",level:2},{value:"Reserved Parameters",id:"reserved-parameters",level:3},{value:"Optional Parameters",id:"optional-parameters",level:3},{value:"Win32 <code>BOOL</code> Becomes Dart <code>bool</code>",id:"win32-bool-becomes-dart-bool",level:2},{value:"<code>HRESULT</code>-Based APIs",id:"hresult-based-apis",level:2},{value:"Failures Throw",id:"failures-throw",level:3},{value:"Output Values are Returned Directly",id:"output-values-are-returned-directly",level:3},{value:"APIs That Call <code>SetLastError()</code>",id:"apis-that-call-setlasterror",level:2},{value:"COM Queries Return Typed Interfaces",id:"com-queries-return-typed-interfaces",level:2}];function c(e){let n={a:"a",admonition:"admonition",code:"code",em:"em",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.a,{href:"https://pub.dev/packages/win32",children:(0,s.jsx)(n.code,{children:"package:win32"})})," exposes Win32 APIs as\n",(0,s.jsx)(n.strong,{children:"global Dart functions"}),", projected into a safer and more idiomatic Dart\nsurface."]}),"\n",(0,s.jsx)(n.p,{children:"In most cases, you can call Win32 APIs as if they were normal Dart functions."}),"\n",(0,s.jsx)(n.h2,{id:"reserved-and-optional-parameters",children:"Reserved and Optional Parameters"}),"\n",(0,s.jsx)(n.p,{children:"Some Win32 APIs include parameters that are not always meaningful to the caller."}),"\n",(0,s.jsx)(n.p,{children:"These fall into two distinct categories."}),"\n",(0,s.jsx)(n.h3,{id:"reserved-parameters",children:"Reserved Parameters"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.em,{children:"Reserved"})," parameters exist only for ABI or historical compatibility. They\nmust always be set to ",(0,s.jsx)(n.code,{children:"0"})," or ",(0,s.jsx)(n.a,{href:"https://api.dart.dev/dart-ffi/nullptr.html",children:(0,s.jsx)(n.code,{children:"nullptr"})})," and have no semantic meaning."]}),"\n",(0,s.jsxs)(n.p,{children:["In ",(0,s.jsx)(n.code,{children:"package:win32"}),", reserved parameters are ",(0,s.jsx)(n.strong,{children:"removed entirely"})," from the Dart\nsignature and supplied automatically behind the scenes."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-dart",children:"// Native: CoInitializeEx(NULL, COINIT_MULTITHREADED)\nCoInitializeEx(COINIT_MULTITHREADED);\n"})}),"\n",(0,s.jsx)(n.p,{children:"You never see or pass reserved parameters in Dart."}),"\n",(0,s.jsx)(n.h3,{id:"optional-parameters",children:"Optional Parameters"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.em,{children:"Optional"})," parameters are semantically meaningful but not required for all\ncalls. They may accept real values (such as pointers or integers), but can also\nbe omitted."]}),"\n",(0,s.jsxs)(n.p,{children:["In ",(0,s.jsx)(n.code,{children:"package:win32"}),", optional parameters are projected as\n",(0,s.jsx)(n.strong,{children:"nullable Dart types"}),". Passing ",(0,s.jsx)(n.code,{children:"null"})," maps to ",(0,s.jsx)(n.code,{children:"0"})," or ",(0,s.jsx)(n.code,{children:"nullptr"})," on the native\nside."]}),"\n",(0,s.jsx)(n.p,{children:"This makes it explicit at the call site which parameters are optional, while\nstill allowing real values to be passed when needed."}),"\n",(0,s.jsxs)(n.h2,{id:"win32-bool-becomes-dart-bool",children:["Win32 ",(0,s.jsx)(n.code,{children:"BOOL"})," Becomes Dart ",(0,s.jsx)(n.code,{children:"bool"})]}),"\n",(0,s.jsxs)(n.p,{children:["Win32 APIs that use the ",(0,s.jsx)(n.code,{children:"BOOL"})," type are projected to Dart ",(0,s.jsx)(n.code,{children:"bool"}),"."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-dart",children:"final success = MagShowSystemCursor(true);\nif (!success) {\n  // handle error\n}\n"})}),"\n",(0,s.jsxs)(n.p,{children:["You never work with ",(0,s.jsx)(n.code,{children:"TRUE"}),", ",(0,s.jsx)(n.code,{children:"FALSE"}),", or integer return values \u2014 only Dart\n",(0,s.jsx)(n.code,{children:"bool"}),"."]}),"\n",(0,s.jsxs)(n.h2,{id:"hresult-based-apis",children:[(0,s.jsx)(n.code,{children:"HRESULT"}),"-Based APIs"]}),"\n",(0,s.jsxs)(n.p,{children:["Most COM and system APIs return an ",(0,s.jsx)(n.a,{href:"https://wikipedia.org/wiki/HRESULT",children:(0,s.jsx)(n.code,{children:"HRESULT"})}),". In ",(0,s.jsx)(n.code,{children:"package:win32"}),", you\nalmost never handle ",(0,s.jsx)(n.code,{children:"HRESULT"})," values directly."]}),"\n",(0,s.jsx)(n.h3,{id:"failures-throw",children:"Failures Throw"}),"\n",(0,s.jsxs)(n.p,{children:["If a Win32 API reports failure via ",(0,s.jsx)(n.code,{children:"HRESULT"}),", the Dart function throws a\n",(0,s.jsx)(n.a,{href:"https://pub.dev/documentation/win32/latest/win32/WindowsException-class.html",children:(0,s.jsx)(n.code,{children:"WindowsException"})}),"."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-dart",children:"CoGetApartmentType(pAptType, pAptQualifier); // throws on failure\n"})}),"\n",(0,s.jsx)(n.p,{children:"You can still catch and handle failures explicitly:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-dart",children:"try {\n  CoGetApartmentType(pAptType, pAptQualifier);\n} on WindowsException catch (e) {\n  // handle error\n  if (e.hr == CO_E_NOTINITIALIZED) {\n    // specific handling\n  }\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"output-values-are-returned-directly",children:"Output Values are Returned Directly"}),"\n",(0,s.jsxs)(n.p,{children:["If a function logically produces a value via an ",(0,s.jsx)(n.em,{children:"out"})," parameter, the Dart\nprojection returns that value directly."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-dart",children:"final guid = CoCreateGuid(); // returns Pointer<GUID>\n"})}),"\n",(0,s.jsxs)(n.p,{children:["You do not pass output buffers or inspect ",(0,s.jsx)(n.code,{children:"HRESULT"}),"s manually."]}),"\n",(0,s.jsx)(n.admonition,{type:"note",children:(0,s.jsxs)(n.p,{children:["Returned pointers and COM objects follow the same ownership rules as their\nnative counterparts. Be sure to ",(0,s.jsx)(n.a,{href:"https://pub.dev/documentation/win32/latest/win32/free.html",children:(0,s.jsx)(n.code,{children:"free()"})})," or\n",(0,s.jsx)(n.a,{href:"https://pub.dev/documentation/win32/latest/win32/IUnknown/release.html",children:(0,s.jsx)(n.code,{children:"IUnknown.release()"})})," them as appropriate."]})}),"\n",(0,s.jsxs)(n.h2,{id:"apis-that-call-setlasterror",children:["APIs That Call ",(0,s.jsx)(n.code,{children:"SetLastError()"})]}),"\n",(0,s.jsxs)(n.p,{children:["Many Win32 APIs indicate failure by their return value and record corresponding\nerror code in the thread-local ",(0,s.jsx)(n.em,{children:"last-error"})," slot via\n",(0,s.jsx)(n.a,{href:"https://learn.microsoft.com/windows/win32/api/errhandlingapi/nf-errhandlingapi-setlasterror",children:(0,s.jsx)(n.code,{children:"SetLastError()"})}),". This error code can be queried using\n",(0,s.jsx)(n.a,{href:"https://learn.microsoft.com/windows/win32/api/errhandlingapi/nf-errhandlingapi-getlasterror",children:(0,s.jsx)(n.code,{children:"GetLastError()"})}),"."]}),"\n",(0,s.jsxs)(n.p,{children:["In Dart, calling ",(0,s.jsx)(n.code,{children:"GetLastError()"})," directly after a Win32 API invocation is\n",(0,s.jsx)(n.strong,{children:"not reliable"}),". Between the original native call and a Dart-side\n",(0,s.jsx)(n.code,{children:"GetLastError()"})," invocation, the Dart runtime may perform additional native\noperations that ",(0,s.jsx)(n.strong,{children:"overwrite the last-error state"}),"."]}),"\n",(0,s.jsxs)(n.p,{children:["This is a known limitation of Dart FFI (see\n",(0,s.jsx)(n.a,{href:"https://github.com/dart-lang/sdk/issues/38832",children:"dart-lang/sdk#38832"}),") and\n",(0,s.jsx)(n.strong,{children:"cannot be reliably mitigated in user code"}),"."]}),"\n",(0,s.jsxs)(n.p,{children:["To address this, ",(0,s.jsx)(n.code,{children:"package:win32"})," adopts a different convention for APIs that\nfollow this pattern. These APIs return a ",(0,s.jsx)(n.a,{href:"https://pub.dev/documentation/win32/latest/win32/Win32Result-class.html",children:(0,s.jsx)(n.code,{children:"Win32Result<T>"})}),",\nwhich captures both the logical return value and the associated last-error\ncode atomically on the native side, ensuring the ",(0,s.jsx)(n.strong,{children:"error state is preserved"}),"."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-dart",children:"final Win32Result(:value, :error) = WriteFile(...);\nif (!value) {\n  print('Error: ${error.toHRESULT()}');\n}\n"})}),"\n",(0,s.jsxs)(n.p,{children:["When calling APIs that return ",(0,s.jsx)(n.code,{children:"Win32Result<T>"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Always"})," inspect ",(0,s.jsx)(n.code,{children:"value"})," first to determine ",(0,s.jsx)(n.strong,{children:"success"})," or ",(0,s.jsx)(n.strong,{children:"failure"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:["Consult ",(0,s.jsx)(n.code,{children:"error"})," ",(0,s.jsx)(n.strong,{children:"only"})," when the API contract ",(0,s.jsx)(n.em,{children:"indicates"})," failure."]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"com-queries-return-typed-interfaces",children:"COM Queries Return Typed Interfaces"}),"\n",(0,s.jsxs)(n.p,{children:["APIs that conceptually ",(0,s.jsx)(n.em,{children:"query"})," an interface are projected as generic Dart\nfunctions that return the requested type directly."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-dart",children:"final clsid = FileOpenDialog.toNative();\nfinal dialog = CoCreateInstance<IFileDialog>(\n  clsid,\n  null,\n  CLSCTX_ALL,\n); // returns IFileDialog\n"})}),"\n",(0,s.jsx)(n.p,{children:"You don't pass IIDs or output pointers. The returned object is already typed and\nready to use."})]})}function h(e={}){let{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},28453(e,n,r){r.d(n,{R:()=>i,x:()=>l});var t=r(96540);let s={},a=t.createContext(s);function i(e){let n=t.useContext(a);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),t.createElement(a.Provider,{value:n},e.children)}}}]);