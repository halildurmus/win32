<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://win32.pub/blog</id>
    <title>win32 Blog</title>
    <updated>2024-07-16T00:00:00.000Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://win32.pub/blog"/>
    <subtitle>A resource for win32, Flutter and Dart ecosystem, and Windows development.</subtitle>
    <rights>Copyright © 2025 • Halil Durmus</rights>
    <entry>
        <title type="html"><![CDATA[Building a Task Manager App in Flutter with win32]]></title>
        <id>https://win32.pub/blog/building-task-manager-app</id>
        <link href="https://win32.pub/blog/building-task-manager-app"/>
        <updated>2024-07-16T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[We'll build a Task Manager app to manage running Windows tasks in Flutter using the win32 package.]]></summary>
        <content type="html"><![CDATA[<p><img decoding="async" loading="lazy" alt="Task Manager App" src="https://win32.pub/assets/images/task_manager-163b66b5a0c160f663eb5963ac095949.png" width="2336" height="1472" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="introduction">Introduction<a href="https://win32.pub/blog/building-task-manager-app#introduction" class="hash-link" aria-label="Direct link to Introduction" title="Direct link to Introduction">​</a></h2>
<p>In this blog post, we will build a Task Manager app in Flutter using the
<strong>win32</strong> package. By utilizing the Windows APIs provided by <strong>win32</strong>, we'll
create an intuitive app to <strong>view</strong> and <strong>manage</strong> running tasks on a Windows
system.</p>
<p>Whether you're a developer looking to enhance your Flutter skills or an
enthusiast eager to dive into Windows programming, this guide will walk you
through the process of creating your own Task Manager app from scratch.</p>
<p>Here's what we'll cover:</p>
<ul>
<li><a href="https://win32.pub/blog/building-task-manager-app#feature-overview">Feature Overview</a></li>
<li><a href="https://win32.pub/blog/building-task-manager-app#setting-up-the-project">Setting Up the Project</a>
<ul>
<li><a href="https://win32.pub/blog/building-task-manager-app#creating-a-new-flutter-project">Creating a New Flutter Project</a></li>
<li><a href="https://win32.pub/blog/building-task-manager-app#installing-dependencies">Installing Dependencies</a></li>
</ul>
</li>
<li><a href="https://win32.pub/blog/building-task-manager-app#defining-the-models">Defining the Models</a></li>
<li><a href="https://win32.pub/blog/building-task-manager-app#implementing-task-manager-logic">Implementing Task Manager Logic</a>
<ul>
<li><a href="https://win32.pub/blog/building-task-manager-app#running-a-new-task">Running a New Task</a></li>
<li><a href="https://win32.pub/blog/building-task-manager-app#enumerating-running-tasks">Enumerating Running Tasks</a>
<ul>
<li><a href="https://win32.pub/blog/building-task-manager-app#retrieving-file-description">Retrieving File Description</a></li>
<li><a href="https://win32.pub/blog/building-task-manager-app#extracting-task-icon">Extracting Task Icon</a></li>
</ul>
</li>
<li><a href="https://win32.pub/blog/building-task-manager-app#terminating-a-task">Terminating a Task</a></li>
</ul>
</li>
<li><a href="https://win32.pub/blog/building-task-manager-app#building-the-ui">Building the UI</a>
<ul>
<li><a href="https://win32.pub/blog/building-task-manager-app#setting-up-the-main-entry-point">Setting Up the Main Entry Point</a></li>
<li><a href="https://win32.pub/blog/building-task-manager-app#creating-the-home-screen-skeleton">Creating the Home Screen Skeleton</a></li>
<li><a href="https://win32.pub/blog/building-task-manager-app#loading-and-displaying-tasks">Loading and Displaying Tasks</a></li>
<li><a href="https://win32.pub/blog/building-task-manager-app#task-sorting-searching-and-refreshing">Task Sorting, Searching, and Refreshing</a></li>
<li><a href="https://win32.pub/blog/building-task-manager-app#task-termination">Task Termination</a></li>
<li><a href="https://win32.pub/blog/building-task-manager-app#task-creation">Task Creation</a></li>
</ul>
</li>
<li><a href="https://win32.pub/blog/building-task-manager-app#conclusion">Conclusion</a></li>
<li><a href="https://win32.pub/blog/building-task-manager-app#source-code">Source Code</a></li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="feature-overview">Feature Overview<a href="https://win32.pub/blog/building-task-manager-app#feature-overview" class="hash-link" aria-label="Direct link to Feature Overview" title="Direct link to Feature Overview">​</a></h2>
<p>Our Task Manager app will include the following key features:</p>
<ul>
<li><strong>Enumerating running tasks:</strong> View a list of running tasks, including their
names, PIDs, and descriptions.</li>
<li><strong>Searching and sorting tasks:</strong> Search and sort tasks based on their name,
PID, or description.</li>
<li><strong>Starting a new task:</strong> Start a new task by specifying its executable path
directly within the app.</li>
<li><strong>Terminating a task:</strong> Terminate a running task by clicking the button next
to the task.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="setting-up-the-project">Setting Up the Project<a href="https://win32.pub/blog/building-task-manager-app#setting-up-the-project" class="hash-link" aria-label="Direct link to Setting Up the Project" title="Direct link to Setting Up the Project">​</a></h2>
<p>Before we dive into coding, let’s set up our project.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="creating-a-new-flutter-project">Creating a New Flutter Project<a href="https://win32.pub/blog/building-task-manager-app#creating-a-new-flutter-project" class="hash-link" aria-label="Direct link to Creating a New Flutter Project" title="Direct link to Creating a New Flutter Project">​</a></h3>
<p>Open your terminal and run:</p>
<div class="win32-common-code-block language-cmd rounded-lg bg-win32-react-light-code dark:bg-win32-react-dark-code border border-gray-300 dark:border-0 mb-6 relative win32-wider-container"><div class="relative pt-3 pb-0 not-prose"><pre tabindex="0" class="prism-code language-cmd bg-transparent !mt-0 !mb-0 m-0 px-0 pt-0 font-jetBrains-mono pb-3"><code class="font-[inherit] bg-transparent inline-block min-w-full"><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">&gt; flutter create task_manager --platforms=windows</span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">&gt; cd task_manager</span><br></span></code></pre></div><div class="absolute top-3 right-3 flex items-center gap-2"><button type="button" aria-label="Copy code to clipboard" title="Copy code to clipboard" class="w-6 h-6 flex justify-center items-center bg-gray-200 dark:bg-gray-800 hover:bg-gray-300 dark:hover:bg-win32-react-dark-code rounded group transition-[background-color] duration-200 ease-in-out"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" class="w-3 h-3 text-gray-500 dark:text-gray-400 transition-all duration-200 ease-in-out" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill="none" d="M0 0h24v24H0z"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></button></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="installing-dependencies">Installing Dependencies<a href="https://win32.pub/blog/building-task-manager-app#installing-dependencies" class="hash-link" aria-label="Direct link to Installing Dependencies" title="Direct link to Installing Dependencies">​</a></h3>
<p>Add the <strong>ffi</strong> and <strong>win32</strong> packages to your project with:</p>
<div class="win32-common-code-block language-cmd rounded-lg bg-win32-react-light-code dark:bg-win32-react-dark-code border border-gray-300 dark:border-0 mb-6 relative win32-wider-container"><div class="py-3 px-4 bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-100 text-xs flex items-center gap-2 rounded-tl-lg rounded-tr-lg"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" height="20" width="20" xmlns="http://www.w3.org/2000/svg"><path fill="none" stroke-linejoin="round" stroke-width="32" d="M416 221.25V416a48 48 0 0 1-48 48H144a48 48 0 0 1-48-48V96a48 48 0 0 1 48-48h98.75a32 32 0 0 1 22.62 9.37l141.26 141.26a32 32 0 0 1 9.37 22.62z"></path><path fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-width="32" d="M256 56v120a32 32 0 0 0 32 32h120m-232 80h160m-160 80h160"></path></svg>Terminal</div><div class="relative pt-3 pb-0 not-prose"><pre tabindex="0" class="prism-code language-cmd bg-transparent !mt-0 !mb-0 m-0 px-0 pt-0 font-jetBrains-mono pb-3"><code class="font-[inherit] bg-transparent inline-block min-w-full"><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">flutter pub add ffi win32</span><br></span></code></pre></div><div class="absolute top-2 right-2 flex items-center gap-2"><button type="button" aria-label="Copy code to clipboard" title="Copy code to clipboard" class="w-6 h-6 flex justify-center items-center bg-gray-200 dark:bg-gray-800 hover:bg-gray-300 dark:hover:bg-win32-react-dark-code rounded group transition-[background-color] duration-200 ease-in-out"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" class="w-3 h-3 text-gray-500 dark:text-gray-400 transition-all duration-200 ease-in-out" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill="none" d="M0 0h24v24H0z"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></button></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="defining-the-models">Defining the Models<a href="https://win32.pub/blog/building-task-manager-app#defining-the-models" class="hash-link" aria-label="Direct link to Defining the Models" title="Direct link to Defining the Models">​</a></h2>
<p>We'll start by defining the models responsible for storing <strong>task information</strong>
and <strong>sorting options</strong>.</p>
<p>Create a new file named <code>models.dart</code> in the <code>lib\src</code> directory and add the
following code:</p>
<div class="win32-common-code-block language-dart rounded-lg bg-win32-react-light-code dark:bg-win32-react-dark-code border border-gray-300 dark:border-0 mb-6 relative win32-wider-container"><div class="py-3 px-4 bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-100 text-xs flex items-center gap-2 rounded-tl-lg rounded-tr-lg"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"><path fill="#01579B" d="M5.013 18.936.996 14.92c-.476-.489-.772-1.18-.772-1.854 0-.312.176-.801.309-1.082l3.708-7.725z"></path><path fill="#40C4FF" d="m18.764 5.032-4.017-4.017c-.351-.352-1.082-.772-1.7-.772-.531 0-1.052.106-1.39.309L4.241 4.259zM9.803 23.726h9.733v-4.172l-7.261-2.317-6.644 2.317Z"></path><path fill="#29B6F6" d="M4.241 16.773c0 1.239.155 1.543.772 2.163l.618.618h13.905l-6.798-7.724-8.497-7.571z"></path><path fill="#01579B" d="M16.601 4.259H4.241l15.295 15.295h4.171V9.976l-4.943-4.944c-.694-.697-1.311-.772-2.163-.772"></path><path opacity=".2" fill="#FFF" d="M5.168 19.091c-.618-.62-.772-1.232-.772-2.318V4.414l-.154-.154v12.513c0 1.086 0 1.387.927 2.318l.464.464z"></path><path opacity=".2" fill="#263238" d="M23.553 9.821V19.4h-4.171l.154.154h4.172V9.976Z"></path><path opacity=".2" fill="#FFF" d="M18.764 5.032c-.766-.766-1.394-.772-2.318-.772H4.241l.154.154h12.051c.462 0 1.625-.077 2.318.618"></path><radialGradient id="a" cx="538.463" cy="539.28" r="528.383" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#fff" stop-opacity="0.1"></stop><stop offset="1" stop-color="#fff" stop-opacity="0"></stop></radialGradient><path opacity=".2" fill="url(#a)" d="m23.553 9.821-4.789-4.789-4.017-4.017c-.351-.352-1.082-.772-1.7-.772-.531 0-1.052.106-1.39.309L4.241 4.259.533 11.984c-.132.281-.309.769-.309 1.082 0 .674.297 1.365.772 1.854l3.702 3.675c.089.108.192.219.315.342l.154.154.464.464 4.017 4.017.154.154h9.733v-4.172h4.171V9.976z"></path></svg>models.dart</div><div class="relative pt-3 pb-0 not-prose"><pre tabindex="0" class="prism-code language-dart bg-transparent !mt-0 !mb-0 m-0 px-0 pt-0 font-jetBrains-mono pb-3"><code class="font-[inherit] bg-transparent inline-block min-w-full"><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token string-literal string" style="color:#e3116c">'dart:typed_data'</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">/// Specifies the field by which to sort the tasks.</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">enum</span><span class="token plain"> </span><span class="token class-name">SortBy</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">/// Sort by task name.</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">/// Sort by task PID (Process ID).</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  pid</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">/// Sort by task description.</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  description</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">/// Specifies the order in which to sort the tasks.</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">enum</span><span class="token plain"> </span><span class="token class-name">SortOrder</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">/// Sort in ascending order.</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  ascending</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">/// Sort in descending order.</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  descending</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">/// A Windows task with its icon, name, PID, and description.</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">Task</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token class-name">Task</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    required </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">iconAsBytes</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    required </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    required </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">pid</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    required </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">description</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">/// The icon of the task.</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> </span><span class="token class-name">Uint8List</span><span class="token plain"> iconAsBytes</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">/// The name of the task.</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> </span><span class="token class-name">String</span><span class="token plain"> name</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">/// The PID (Process ID) of the task.</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> int pid</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">/// The description of the task.</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> </span><span class="token class-name">String</span><span class="token plain"> description</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div><div class="absolute top-2 right-2 flex items-center gap-2"><button type="button" aria-label="Copy code to clipboard" title="Copy code to clipboard" class="w-6 h-6 flex justify-center items-center bg-gray-200 dark:bg-gray-800 hover:bg-gray-300 dark:hover:bg-win32-react-dark-code rounded group transition-[background-color] duration-200 ease-in-out"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" class="w-3 h-3 text-gray-500 dark:text-gray-400 transition-all duration-200 ease-in-out" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill="none" d="M0 0h24v24H0z"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></button></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="implementing-task-manager-logic">Implementing Task Manager Logic<a href="https://win32.pub/blog/building-task-manager-app#implementing-task-manager-logic" class="hash-link" aria-label="Direct link to Implementing Task Manager Logic" title="Direct link to Implementing Task Manager Logic">​</a></h2>
<p>Next, we'll implement the functionality for managing Windows tasks, including
enumerating running tasks, starting new tasks, and terminating tasks.</p>
<p>Create a new file named <code>task_manager.dart</code> in the <code>lib\src</code> directory and
add the following code to set up the skeleton for managing Windows tasks:</p>
<div class="win32-common-code-block language-dart rounded-lg bg-win32-react-light-code dark:bg-win32-react-dark-code border border-gray-300 dark:border-0 mb-6 relative win32-wider-container"><div class="py-3 px-4 bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-100 text-xs flex items-center gap-2 rounded-tl-lg rounded-tr-lg"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"><path fill="#01579B" d="M5.013 18.936.996 14.92c-.476-.489-.772-1.18-.772-1.854 0-.312.176-.801.309-1.082l3.708-7.725z"></path><path fill="#40C4FF" d="m18.764 5.032-4.017-4.017c-.351-.352-1.082-.772-1.7-.772-.531 0-1.052.106-1.39.309L4.241 4.259zM9.803 23.726h9.733v-4.172l-7.261-2.317-6.644 2.317Z"></path><path fill="#29B6F6" d="M4.241 16.773c0 1.239.155 1.543.772 2.163l.618.618h13.905l-6.798-7.724-8.497-7.571z"></path><path fill="#01579B" d="M16.601 4.259H4.241l15.295 15.295h4.171V9.976l-4.943-4.944c-.694-.697-1.311-.772-2.163-.772"></path><path opacity=".2" fill="#FFF" d="M5.168 19.091c-.618-.62-.772-1.232-.772-2.318V4.414l-.154-.154v12.513c0 1.086 0 1.387.927 2.318l.464.464z"></path><path opacity=".2" fill="#263238" d="M23.553 9.821V19.4h-4.171l.154.154h4.172V9.976Z"></path><path opacity=".2" fill="#FFF" d="M18.764 5.032c-.766-.766-1.394-.772-2.318-.772H4.241l.154.154h12.051c.462 0 1.625-.077 2.318.618"></path><radialGradient id="a" cx="538.463" cy="539.28" r="528.383" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#fff" stop-opacity="0.1"></stop><stop offset="1" stop-color="#fff" stop-opacity="0"></stop></radialGradient><path opacity=".2" fill="url(#a)" d="m23.553 9.821-4.789-4.789-4.017-4.017c-.351-.352-1.082-.772-1.7-.772-.531 0-1.052.106-1.39.309L4.241 4.259.533 11.984c-.132.281-.309.769-.309 1.082 0 .674.297 1.365.772 1.854l3.702 3.675c.089.108.192.219.315.342l.154.154.464.464 4.017 4.017.154.154h9.733v-4.172h4.171V9.976z"></path></svg>task_manager.dart</div><div class="relative pt-3 pb-0 not-prose"><pre tabindex="0" class="prism-code language-dart bg-transparent !mt-0 !mb-0 m-0 px-0 pt-0 font-jetBrains-mono pb-3"><code class="font-[inherit] bg-transparent inline-block min-w-full"><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token string-literal string" style="color:#e3116c">'dart:ffi'</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token string-literal string" style="color:#e3116c">'dart:typed_data'</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token string-literal string" style="color:#e3116c">'package:ffi/ffi.dart'</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token string-literal string" style="color:#e3116c">'package:win32/win32.dart'</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token string-literal string" style="color:#e3116c">'models.dart'</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">/// Provides functionality for managing Windows tasks, including:</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">/// - Enumerating running tasks</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">/// - Running a new task</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">/// - Terminating a running task</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">abstract</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">TaskManager</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">/// Runs a new task from the specified [path].</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">///</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">/// Returns `true` if the task was successfully started; otherwise, `false`.</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> bool </span><span class="token function" style="color:#d73a49">run</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">String</span><span class="token plain"> path</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// TODO: Implement this method</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">throw</span><span class="token plain"> </span><span class="token class-name">UnimplementedError</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">/// Retrieves a list of currently running tasks.</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">///</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">/// Returns `null` if retrieval failed.</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token class-name">List</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">Task</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token operator" style="color:#393A34">?</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">get</span><span class="token plain"> tasks </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// TODO: Implement this method</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">throw</span><span class="token plain"> </span><span class="token class-name">UnimplementedError</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">/// Terminates a running task with the given [pid].</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">///</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">/// Returns `true` if the task was successfully terminated; otherwise,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">/// `false`.</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> bool </span><span class="token function" style="color:#d73a49">terminate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">int pid</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// TODO: Implement this method</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">throw</span><span class="token plain"> </span><span class="token class-name">UnimplementedError</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div><div class="absolute top-2 right-2 flex items-center gap-2"><button type="button" aria-label="Copy code to clipboard" title="Copy code to clipboard" class="w-6 h-6 flex justify-center items-center bg-gray-200 dark:bg-gray-800 hover:bg-gray-300 dark:hover:bg-win32-react-dark-code rounded group transition-[background-color] duration-200 ease-in-out"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" class="w-3 h-3 text-gray-500 dark:text-gray-400 transition-all duration-200 ease-in-out" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill="none" d="M0 0h24v24H0z"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></button></div></div>
<p>With the skeleton in place, we can start implementing the task manager logic.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="running-a-new-task">Running a New Task<a href="https://win32.pub/blog/building-task-manager-app#running-a-new-task" class="hash-link" aria-label="Direct link to Running a New Task" title="Direct link to Running a New Task">​</a></h3>
<p>Now, let's implement the <code>run</code> function to <strong>run a new task</strong>.</p>
<div class="win32-common-code-block language-dart rounded-lg bg-win32-react-light-code dark:bg-win32-react-dark-code border border-gray-300 dark:border-0 mb-6 relative win32-wider-container"><div class="py-3 px-4 bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-100 text-xs flex items-center gap-2 rounded-tl-lg rounded-tr-lg"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"><path fill="#01579B" d="M5.013 18.936.996 14.92c-.476-.489-.772-1.18-.772-1.854 0-.312.176-.801.309-1.082l3.708-7.725z"></path><path fill="#40C4FF" d="m18.764 5.032-4.017-4.017c-.351-.352-1.082-.772-1.7-.772-.531 0-1.052.106-1.39.309L4.241 4.259zM9.803 23.726h9.733v-4.172l-7.261-2.317-6.644 2.317Z"></path><path fill="#29B6F6" d="M4.241 16.773c0 1.239.155 1.543.772 2.163l.618.618h13.905l-6.798-7.724-8.497-7.571z"></path><path fill="#01579B" d="M16.601 4.259H4.241l15.295 15.295h4.171V9.976l-4.943-4.944c-.694-.697-1.311-.772-2.163-.772"></path><path opacity=".2" fill="#FFF" d="M5.168 19.091c-.618-.62-.772-1.232-.772-2.318V4.414l-.154-.154v12.513c0 1.086 0 1.387.927 2.318l.464.464z"></path><path opacity=".2" fill="#263238" d="M23.553 9.821V19.4h-4.171l.154.154h4.172V9.976Z"></path><path opacity=".2" fill="#FFF" d="M18.764 5.032c-.766-.766-1.394-.772-2.318-.772H4.241l.154.154h12.051c.462 0 1.625-.077 2.318.618"></path><radialGradient id="a" cx="538.463" cy="539.28" r="528.383" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#fff" stop-opacity="0.1"></stop><stop offset="1" stop-color="#fff" stop-opacity="0"></stop></radialGradient><path opacity=".2" fill="url(#a)" d="m23.553 9.821-4.789-4.789-4.017-4.017c-.351-.352-1.082-.772-1.7-.772-.531 0-1.052.106-1.39.309L4.241 4.259.533 11.984c-.132.281-.309.769-.309 1.082 0 .674.297 1.365.772 1.854l3.702 3.675c.089.108.192.219.315.342l.154.154.464.464 4.017 4.017.154.154h9.733v-4.172h4.171V9.976z"></path></svg>task_manager.dart</div><div class="relative pt-3 pb-0 not-prose"><pre tabindex="0" class="prism-code language-dart bg-transparent !mt-0 !mb-0 m-0 px-0 pt-0 font-jetBrains-mono pb-3"><code class="font-[inherit] bg-transparent inline-block min-w-full"><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">/// Runs a new task from the specified [path].</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">///</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">/// Returns `true` if the task was successfully started; otherwise, `false`.</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> bool </span><span class="token function" style="color:#d73a49">run</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">String</span><span class="token plain"> path</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> lpFile </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> path</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">toNativeUtf16</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> result </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">ShellExecute</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token string-literal string" style="color:#e3116c">'open'</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">toNativeUtf16</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    lpFile</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    nullptr</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    nullptr</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    SW_SHOWNORMAL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">free</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">lpFile</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> result </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">32</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div><div class="absolute top-2 right-2 flex items-center gap-2"><button type="button" aria-label="Copy code to clipboard" title="Copy code to clipboard" class="w-6 h-6 flex justify-center items-center bg-gray-200 dark:bg-gray-800 hover:bg-gray-300 dark:hover:bg-win32-react-dark-code rounded group transition-[background-color] duration-200 ease-in-out"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" class="w-3 h-3 text-gray-500 dark:text-gray-400 transition-all duration-200 ease-in-out" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill="none" d="M0 0h24v24H0z"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></button></div></div>
<p>We first convert the provided file path into a native UTF-16 format using the
<code>toNativeUtf16</code> extension method from <code>package:ffi</code>. This formatted path is then
passed along with other necessary parameters to <a href="https://learn.microsoft.com/windows/win32/api/shellapi/nf-shellapi-shellexecutew" target="_blank" rel="noopener noreferrer">ShellExecute</a>, specifying an
action to open the file and dictate how the new process window should appear.</p>
<p>After executing the function, we free the allocated memory for the path to
ensure efficient resource management. If the value returned by <a href="https://learn.microsoft.com/windows/win32/api/shellapi/nf-shellapi-shellexecutew" target="_blank" rel="noopener noreferrer">ShellExecute</a> is
greater than <strong>32</strong>, it indicates a <em>successful</em> task launch, and the function
returns <code>true</code>. Otherwise, it returns <code>false</code>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="enumerating-running-tasks">Enumerating Running Tasks<a href="https://win32.pub/blog/building-task-manager-app#enumerating-running-tasks" class="hash-link" aria-label="Direct link to Enumerating Running Tasks" title="Direct link to Enumerating Running Tasks">​</a></h3>
<p>Next, we'll implement the <code>tasks</code> getter to <strong>enumerate all running tasks</strong> on
the system.</p>
<div class="win32-common-code-block language-dart rounded-lg bg-win32-react-light-code dark:bg-win32-react-dark-code border border-gray-300 dark:border-0 mb-6 relative win32-wider-container"><div class="py-3 px-4 bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-100 text-xs flex items-center gap-2 rounded-tl-lg rounded-tr-lg"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"><path fill="#01579B" d="M5.013 18.936.996 14.92c-.476-.489-.772-1.18-.772-1.854 0-.312.176-.801.309-1.082l3.708-7.725z"></path><path fill="#40C4FF" d="m18.764 5.032-4.017-4.017c-.351-.352-1.082-.772-1.7-.772-.531 0-1.052.106-1.39.309L4.241 4.259zM9.803 23.726h9.733v-4.172l-7.261-2.317-6.644 2.317Z"></path><path fill="#29B6F6" d="M4.241 16.773c0 1.239.155 1.543.772 2.163l.618.618h13.905l-6.798-7.724-8.497-7.571z"></path><path fill="#01579B" d="M16.601 4.259H4.241l15.295 15.295h4.171V9.976l-4.943-4.944c-.694-.697-1.311-.772-2.163-.772"></path><path opacity=".2" fill="#FFF" d="M5.168 19.091c-.618-.62-.772-1.232-.772-2.318V4.414l-.154-.154v12.513c0 1.086 0 1.387.927 2.318l.464.464z"></path><path opacity=".2" fill="#263238" d="M23.553 9.821V19.4h-4.171l.154.154h4.172V9.976Z"></path><path opacity=".2" fill="#FFF" d="M18.764 5.032c-.766-.766-1.394-.772-2.318-.772H4.241l.154.154h12.051c.462 0 1.625-.077 2.318.618"></path><radialGradient id="a" cx="538.463" cy="539.28" r="528.383" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#fff" stop-opacity="0.1"></stop><stop offset="1" stop-color="#fff" stop-opacity="0"></stop></radialGradient><path opacity=".2" fill="url(#a)" d="m23.553 9.821-4.789-4.789-4.017-4.017c-.351-.352-1.082-.772-1.7-.772-.531 0-1.052.106-1.39.309L4.241 4.259.533 11.984c-.132.281-.309.769-.309 1.082 0 .674.297 1.365.772 1.854l3.702 3.675c.089.108.192.219.315.342l.154.154.464.464 4.017 4.017.154.154h9.733v-4.172h4.171V9.976z"></path></svg>task_manager.dart</div><div class="relative pt-3 pb-0 not-prose"><pre tabindex="0" class="prism-code language-dart bg-transparent !mt-0 !mb-0 m-0 px-0 pt-0 font-jetBrains-mono pb-3"><code class="font-[inherit] bg-transparent inline-block min-w-full"><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">/// Retrieves a list of currently running tasks.</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">///</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">/// Returns `null` if retrieval failed.</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token class-name">List</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">Task</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token operator" style="color:#393A34">?</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">get</span><span class="token plain"> tasks </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">using</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">arena</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> tasks </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">Task</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> buffer </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> arena</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">Uint32</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1024</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> cbNeeded </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> arena</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">Uint32</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">EnumProcesses</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">buffer</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> sizeOf</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">Uint32</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1024</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> cbNeeded</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> FALSE</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> processCount </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> cbNeeded</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">value </span><span class="token operator" style="color:#393A34">~/</span><span class="token plain"> sizeOf</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">Uint32</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> processIds </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> buffer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">asTypedList</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">processCount</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> pid </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> processIds</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> hProcess </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">OpenProcess</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        PROCESS_QUERY_INFORMATION </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> PROCESS_VM_READ</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        FALSE</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        pid</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">hProcess </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> NULL</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> hModule </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> arena</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics">HMODULE</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> cbNeededMod </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> arena</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">Uint32</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">EnumProcessModules</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                hProcess</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> hModule</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> sizeOf</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics">HMODULE</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> cbNeededMod</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">            </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">          </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> moduleName </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> arena</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics">WCHAR</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">MAX_PATH</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">cast</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">Utf16</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">          </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">GetModuleBaseName</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                hProcess</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                hModule</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">value</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                moduleName</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                MAX_PATH</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">              </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">              </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> name </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> moduleName</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">toDartString</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> filePath </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> arena</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics">WCHAR</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">MAX_PATH</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">cast</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">Utf16</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> result </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">GetModuleFileNameEx</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                hProcess</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> hModule</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">value</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> filePath</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> MAX_PATH</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> path </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> result </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">?</span><span class="token plain"> filePath</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">toDartString</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> description </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                path </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">?</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">_getFileDescription</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">path</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">?</span><span class="token operator" style="color:#393A34">?</span><span class="token plain"> name</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> name</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> task </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">Task</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">              iconAsBytes</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> path </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                  </span><span class="token operator" style="color:#393A34">?</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">_extractIcon</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">path</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">?</span><span class="token operator" style="color:#393A34">?</span><span class="token plain"> </span><span class="token class-name">Uint8List</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                  </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">Uint8List</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">              name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">              pid</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> pid</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">              description</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> description</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">            tasks</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">task</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">CloseHandle</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">hProcess</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> tasks</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div><div class="absolute top-2 right-2 flex items-center gap-2"><button type="button" aria-label="Copy code to clipboard" title="Copy code to clipboard" class="w-6 h-6 flex justify-center items-center bg-gray-200 dark:bg-gray-800 hover:bg-gray-300 dark:hover:bg-win32-react-dark-code rounded group transition-[background-color] duration-200 ease-in-out"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" class="w-3 h-3 text-gray-500 dark:text-gray-400 transition-all duration-200 ease-in-out" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill="none" d="M0 0h24v24H0z"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></button></div></div>
<p>We begin by allocating memory for an array of <code>Uint32</code> values to store the PIDs
of running processes. We then call <a href="https://learn.microsoft.com/windows/win32/api/psapi/nf-psapi-enumprocesses" target="_blank" rel="noopener noreferrer">EnumProcesses</a> to retrieve the list of PIDs
and the number of processes.</p>
<p>Next, we iterate over the list of PIDs and open a handle to each process using
<a href="https://learn.microsoft.com/windows/win32/api/processthreadsapi/nf-processthreadsapi-openprocess" target="_blank" rel="noopener noreferrer">OpenProcess</a>. We then call <a href="https://learn.microsoft.com/windows/win32/api/psapi/nf-psapi-enumprocessmodules" target="_blank" rel="noopener noreferrer">EnumProcessModules</a> to retrieve the module handle
for the process and <a href="https://learn.microsoft.com/windows/win32/api/psapi/nf-psapi-getmodulebasenamew" target="_blank" rel="noopener noreferrer">GetModuleBaseName</a> to retrieve the name of the module.</p>
<p>Next, we retrieve the file path of the module using <a href="https://learn.microsoft.com/windows/win32/api/psapi/nf-psapi-getmodulefilenameexw" target="_blank" rel="noopener noreferrer">GetModuleFileNameEx</a> and
extract the file description using the <code>_getFileDescription</code> function. We also
extract the icon of the task using the <code>_extractIcon</code> function. Finally, we
create a <code>Task</code> object with the retrieved information and add it to the list of
tasks.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="retrieving-file-description">Retrieving File Description<a href="https://win32.pub/blog/building-task-manager-app#retrieving-file-description" class="hash-link" aria-label="Direct link to Retrieving File Description" title="Direct link to Retrieving File Description">​</a></h4>
<p>Next, we'll implement the <code>_getFileDescription</code> function to retrieve the file
description.</p>
<div class="win32-common-code-block language-dart rounded-lg bg-win32-react-light-code dark:bg-win32-react-dark-code border border-gray-300 dark:border-0 mb-6 relative win32-wider-container"><div class="py-3 px-4 bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-100 text-xs flex items-center gap-2 rounded-tl-lg rounded-tr-lg"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"><path fill="#01579B" d="M5.013 18.936.996 14.92c-.476-.489-.772-1.18-.772-1.854 0-.312.176-.801.309-1.082l3.708-7.725z"></path><path fill="#40C4FF" d="m18.764 5.032-4.017-4.017c-.351-.352-1.082-.772-1.7-.772-.531 0-1.052.106-1.39.309L4.241 4.259zM9.803 23.726h9.733v-4.172l-7.261-2.317-6.644 2.317Z"></path><path fill="#29B6F6" d="M4.241 16.773c0 1.239.155 1.543.772 2.163l.618.618h13.905l-6.798-7.724-8.497-7.571z"></path><path fill="#01579B" d="M16.601 4.259H4.241l15.295 15.295h4.171V9.976l-4.943-4.944c-.694-.697-1.311-.772-2.163-.772"></path><path opacity=".2" fill="#FFF" d="M5.168 19.091c-.618-.62-.772-1.232-.772-2.318V4.414l-.154-.154v12.513c0 1.086 0 1.387.927 2.318l.464.464z"></path><path opacity=".2" fill="#263238" d="M23.553 9.821V19.4h-4.171l.154.154h4.172V9.976Z"></path><path opacity=".2" fill="#FFF" d="M18.764 5.032c-.766-.766-1.394-.772-2.318-.772H4.241l.154.154h12.051c.462 0 1.625-.077 2.318.618"></path><radialGradient id="a" cx="538.463" cy="539.28" r="528.383" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#fff" stop-opacity="0.1"></stop><stop offset="1" stop-color="#fff" stop-opacity="0"></stop></radialGradient><path opacity=".2" fill="url(#a)" d="m23.553 9.821-4.789-4.789-4.017-4.017c-.351-.352-1.082-.772-1.7-.772-.531 0-1.052.106-1.39.309L4.241 4.259.533 11.984c-.132.281-.309.769-.309 1.082 0 .674.297 1.365.772 1.854l3.702 3.675c.089.108.192.219.315.342l.154.154.464.464 4.017 4.017.154.154h9.733v-4.172h4.171V9.976z"></path></svg>task_manager.dart</div><div class="relative pt-3 pb-0 not-prose"><pre tabindex="0" class="prism-code language-dart bg-transparent !mt-0 !mb-0 m-0 px-0 pt-0 font-jetBrains-mono pb-3"><code class="font-[inherit] bg-transparent inline-block min-w-full"><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token class-name">String</span><span class="token operator" style="color:#393A34">?</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">_getFileDescription</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">String</span><span class="token plain"> path</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">using</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">arena</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> lptstrFileName </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> path</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">toNativeUtf16</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">allocator</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> arena</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> handle </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> arena</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">Uint32</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> size </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">GetFileVersionInfoSize</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">lptstrFileName</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> handle</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">size </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> versionInfo </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> arena</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">Uint8</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">size</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">GetFileVersionInfo</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">lptstrFileName</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> size</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> versionInfo</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> FALSE</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> lplpBuffer </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> arena</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">Pointer</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">Utf16</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> puLen </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> arena</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">Uint32</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">VerQueryValue</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">          versionInfo</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">          </span><span class="token string-literal string" style="color:#e3116c">r'\StringFileInfo\040904b0\FileDescription'</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">              </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">toNativeUtf16</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">allocator</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> arena</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">          lplpBuffer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">cast</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">          puLen</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        FALSE</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">puLen</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">value </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> lplpBuffer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">value</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">toDartString</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div><div class="absolute top-2 right-2 flex items-center gap-2"><button type="button" aria-label="Copy code to clipboard" title="Copy code to clipboard" class="w-6 h-6 flex justify-center items-center bg-gray-200 dark:bg-gray-800 hover:bg-gray-300 dark:hover:bg-win32-react-dark-code rounded group transition-[background-color] duration-200 ease-in-out"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" class="w-3 h-3 text-gray-500 dark:text-gray-400 transition-all duration-200 ease-in-out" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill="none" d="M0 0h24v24H0z"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></button></div></div>
<p>We first convert the provided file path into a native UTF-16 format using the
<code>toNativeUtf16</code> extension method from <code>package:ffi</code>. This formatted path is then
passed to <a href="https://learn.microsoft.com/windows/win32/api/winver/nf-winver-getfileversioninfosizew" target="_blank" rel="noopener noreferrer">GetFileVersionInfoSize</a> to retrieve the size of the version
information block for the specified file.</p>
<p>Next, we allocate memory for the version information block and call
<a href="https://learn.microsoft.com/windows/win32/api/winver/nf-winver-getfileversioninfow" target="_blank" rel="noopener noreferrer">GetFileVersionInfo</a> to retrieve the version information for the file.</p>
<p>We then use <a href="https://learn.microsoft.com/windows/win32/api/winver/nf-winver-verqueryvaluew" target="_blank" rel="noopener noreferrer">VerQueryValue</a> to retrieve the file description from the version
information block. If the value is <code>0</code>, the function returns <code>null</code>. Otherwise,
it converts the retrieved value to a Dart string and returns it.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="extracting-task-icon">Extracting Task Icon<a href="https://win32.pub/blog/building-task-manager-app#extracting-task-icon" class="hash-link" aria-label="Direct link to Extracting Task Icon" title="Direct link to Extracting Task Icon">​</a></h4>
<p>Finally, we'll implement the <code>_extractIcon</code> function to extract the icon of the
task.</p>
<div class="win32-common-code-block language-dart rounded-lg bg-win32-react-light-code dark:bg-win32-react-dark-code border border-gray-300 dark:border-0 mb-6 relative win32-wider-container"><div class="py-3 px-4 bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-100 text-xs flex items-center gap-2 rounded-tl-lg rounded-tr-lg"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"><path fill="#01579B" d="M5.013 18.936.996 14.92c-.476-.489-.772-1.18-.772-1.854 0-.312.176-.801.309-1.082l3.708-7.725z"></path><path fill="#40C4FF" d="m18.764 5.032-4.017-4.017c-.351-.352-1.082-.772-1.7-.772-.531 0-1.052.106-1.39.309L4.241 4.259zM9.803 23.726h9.733v-4.172l-7.261-2.317-6.644 2.317Z"></path><path fill="#29B6F6" d="M4.241 16.773c0 1.239.155 1.543.772 2.163l.618.618h13.905l-6.798-7.724-8.497-7.571z"></path><path fill="#01579B" d="M16.601 4.259H4.241l15.295 15.295h4.171V9.976l-4.943-4.944c-.694-.697-1.311-.772-2.163-.772"></path><path opacity=".2" fill="#FFF" d="M5.168 19.091c-.618-.62-.772-1.232-.772-2.318V4.414l-.154-.154v12.513c0 1.086 0 1.387.927 2.318l.464.464z"></path><path opacity=".2" fill="#263238" d="M23.553 9.821V19.4h-4.171l.154.154h4.172V9.976Z"></path><path opacity=".2" fill="#FFF" d="M18.764 5.032c-.766-.766-1.394-.772-2.318-.772H4.241l.154.154h12.051c.462 0 1.625-.077 2.318.618"></path><radialGradient id="a" cx="538.463" cy="539.28" r="528.383" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#fff" stop-opacity="0.1"></stop><stop offset="1" stop-color="#fff" stop-opacity="0"></stop></radialGradient><path opacity=".2" fill="url(#a)" d="m23.553 9.821-4.789-4.789-4.017-4.017c-.351-.352-1.082-.772-1.7-.772-.531 0-1.052.106-1.39.309L4.241 4.259.533 11.984c-.132.281-.309.769-.309 1.082 0 .674.297 1.365.772 1.854l3.702 3.675c.089.108.192.219.315.342l.154.154.464.464 4.017 4.017.154.154h9.733v-4.172h4.171V9.976z"></path></svg>task_manager.dart</div><div class="relative pt-3 pb-0 not-prose"><pre tabindex="0" class="prism-code language-dart bg-transparent !mt-0 !mb-0 m-0 px-0 pt-0 font-jetBrains-mono pb-3"><code class="font-[inherit] bg-transparent inline-block min-w-full"><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token class-name">Uint8List</span><span class="token operator" style="color:#393A34">?</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">_extractIcon</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">String</span><span class="token plain"> path</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">using</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">arena</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> filePath </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> path</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">toNativeUtf16</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">allocator</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> arena</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> instance </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">GetModuleHandle</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">nullptr</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> iconID </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> arena</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics">WORD</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> hIcon </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">ExtractAssociatedIcon</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">instance</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> filePath</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> iconID</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">hIcon </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> NULL</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">_getIconData</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">hIcon</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token class-name">Uint8List</span><span class="token operator" style="color:#393A34">?</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">_getIconData</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">int hIcon</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">int nColorBits </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">32</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">using</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">arena</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> buffer </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics">int</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> hdc </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">CreateCompatibleDC</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">NULL</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> icoHeader </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    buffer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">addAll</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">icoHeader</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> iconInfo </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> arena</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics">ICONINFO</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">GetIconInfo</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">hIcon</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> iconInfo</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token class-name">DeleteDC</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">hdc</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> bmInfo </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> arena</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics">BITMAPINFO</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    bmInfo</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ref</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">bmiHeader</span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">biSize </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> sizeOf</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics">BITMAPINFOHEADER</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">biBitCount </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">GetDIBits</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">          hdc</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">          iconInfo</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ref</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">hbmColor</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">          </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">          </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">          nullptr</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">          bmInfo</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">          DIB_RGB_COLORS</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token class-name">DeleteDC</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">hdc</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    int nBmInfoSize </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> sizeOf</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics">BITMAPINFOHEADER</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">nColorBits </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">24</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      nBmInfoSize </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> sizeOf</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics">RGBQUAD</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token plain"> nColorBits</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">bmInfo</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ref</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">bmiHeader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">biSizeImage </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token class-name">DeleteDC</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">hdc</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> bits </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> arena</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">Uint8</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">bmInfo</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ref</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">bmiHeader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">biSizeImage</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    bmInfo</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ref</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">bmiHeader</span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">biBitCount </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> nColorBits</span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">biCompression </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> BI_RGB</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">GetDIBits</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">          hdc</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">          iconInfo</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ref</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">hbmColor</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">          </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">          bmInfo</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ref</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">bmiHeader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">biHeight</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">          bits</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">          bmInfo</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">          DIB_RGB_COLORS</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token class-name">DeleteDC</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">hdc</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> maskInfo </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> arena</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics">BITMAPINFO</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    maskInfo</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ref</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">bmiHeader</span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">biSize </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> sizeOf</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics">BITMAPINFOHEADER</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">biBitCount </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">GetDIBits</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">              hdc</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">              iconInfo</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ref</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">hbmMask</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">              </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">              </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">              nullptr</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">              maskInfo</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">              DIB_RGB_COLORS</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">            </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        maskInfo</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ref</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">bmiHeader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">biBitCount </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token class-name">DeleteDC</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">hdc</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> maskBits </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> arena</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">Uint8</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">maskInfo</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ref</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">bmiHeader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">biSizeImage</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">GetDIBits</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">          hdc</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">          iconInfo</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ref</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">hbmMask</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">          </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">          maskInfo</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ref</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">bmiHeader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">biHeight</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">          maskBits</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">          maskInfo</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">          DIB_RGB_COLORS</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token class-name">DeleteDC</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">hdc</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> dir </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> arena</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics">_IconDirectoryEntry</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    dir</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ref</span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">nWidth </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> bmInfo</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ref</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">bmiHeader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">biWidth</span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">nHeight </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> bmInfo</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ref</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">bmiHeader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">biHeight</span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">nNumColorsInPalette </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">nColorBits </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">?</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">16</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">nNumColorPlanes </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">nBitsPerPixel </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> bmInfo</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ref</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">bmiHeader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">biBitCount</span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">nDataLength </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> bmInfo</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ref</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">bmiHeader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">biSizeImage </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">          maskInfo</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ref</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">bmiHeader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">biSizeImage </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">          nBmInfoSize</span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">nOffset </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> sizeOf</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics">_IconDirectoryEntry</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">6</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    buffer</span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">addAll</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">dir</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">cast</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">Uint8</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">asTypedList</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">sizeOf</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics">_IconDirectoryEntry</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    bmInfo</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ref</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">bmiHeader</span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">biHeight </span><span class="token operator" style="color:#393A34">*=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">biCompression </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">biSizeImage </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> maskInfo</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ref</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">bmiHeader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">biSizeImage</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    buffer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">addAll</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">bmInfo</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">cast</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">Uint8</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">asTypedList</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">nBmInfoSize</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    buffer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">addAll</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">bits</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">asTypedList</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">bmInfo</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ref</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">bmiHeader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">biSizeImage</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    buffer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">addAll</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">maskBits</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">asTypedList</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">maskInfo</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ref</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">bmiHeader</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">biSizeImage</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">DeleteObject</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">iconInfo</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ref</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">hbmColor</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">DeleteObject</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">iconInfo</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ref</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">hbmMask</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">DeleteDC</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">hdc</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token class-name">Uint8List</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">fromList</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">buffer</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">base </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> _IconDirectoryEntry </span><span class="token keyword" style="color:#00009f">extends</span><span class="token plain"> </span><span class="token class-name">Struct</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token metadata function" style="color:#d73a49">@Uint8</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">external</span><span class="token plain"> int nWidth</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token metadata function" style="color:#d73a49">@Uint8</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">external</span><span class="token plain"> int nHeight</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token metadata function" style="color:#d73a49">@Uint8</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">external</span><span class="token plain"> int nNumColorsInPalette</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token metadata function" style="color:#d73a49">@Uint8</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">external</span><span class="token plain"> int nReserved</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token metadata function" style="color:#d73a49">@Uint16</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">external</span><span class="token plain"> int nNumColorPlanes</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token metadata function" style="color:#d73a49">@Uint16</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">external</span><span class="token plain"> int nBitsPerPixel</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token metadata function" style="color:#d73a49">@Uint32</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">external</span><span class="token plain"> int nDataLength</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token metadata function" style="color:#d73a49">@Uint32</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">external</span><span class="token plain"> int nOffset</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div><div class="absolute top-2 right-2 flex items-center gap-2"><button type="button" aria-label="Copy code to clipboard" title="Copy code to clipboard" class="w-6 h-6 flex justify-center items-center bg-gray-200 dark:bg-gray-800 hover:bg-gray-300 dark:hover:bg-win32-react-dark-code rounded group transition-[background-color] duration-200 ease-in-out"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" class="w-3 h-3 text-gray-500 dark:text-gray-400 transition-all duration-200 ease-in-out" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill="none" d="M0 0h24v24H0z"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></button></div></div>
<p>We first convert the provided file path into a native UTF-16 format using the
<code>toNativeUtf16</code> extension method from <code>package:ffi</code>. This formatted path is then
passed to <a href="https://learn.microsoft.com/windows/win32/api/shellapi/nf-shellapi-extractassociatediconw" target="_blank" rel="noopener noreferrer">ExtractAssociatedIcon</a> to retrieve the handle to the associated icon
for the specified file.</p>
<p>Next, we call the <code>_getIconData</code> function to extract the icon data from the icon
handle. This function retrieves the icon information, including the icon size,
color depth, and pixel data, and returns it as a <code>Uint8List</code>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="terminating-a-task">Terminating a Task<a href="https://win32.pub/blog/building-task-manager-app#terminating-a-task" class="hash-link" aria-label="Direct link to Terminating a Task" title="Direct link to Terminating a Task">​</a></h3>
<p>Finally, let's implement the <code>terminate</code> function to
<strong>terminate a running task</strong>.</p>
<div class="win32-common-code-block language-dart rounded-lg bg-win32-react-light-code dark:bg-win32-react-dark-code border border-gray-300 dark:border-0 mb-6 relative win32-wider-container"><div class="py-3 px-4 bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-100 text-xs flex items-center gap-2 rounded-tl-lg rounded-tr-lg"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"><path fill="#01579B" d="M5.013 18.936.996 14.92c-.476-.489-.772-1.18-.772-1.854 0-.312.176-.801.309-1.082l3.708-7.725z"></path><path fill="#40C4FF" d="m18.764 5.032-4.017-4.017c-.351-.352-1.082-.772-1.7-.772-.531 0-1.052.106-1.39.309L4.241 4.259zM9.803 23.726h9.733v-4.172l-7.261-2.317-6.644 2.317Z"></path><path fill="#29B6F6" d="M4.241 16.773c0 1.239.155 1.543.772 2.163l.618.618h13.905l-6.798-7.724-8.497-7.571z"></path><path fill="#01579B" d="M16.601 4.259H4.241l15.295 15.295h4.171V9.976l-4.943-4.944c-.694-.697-1.311-.772-2.163-.772"></path><path opacity=".2" fill="#FFF" d="M5.168 19.091c-.618-.62-.772-1.232-.772-2.318V4.414l-.154-.154v12.513c0 1.086 0 1.387.927 2.318l.464.464z"></path><path opacity=".2" fill="#263238" d="M23.553 9.821V19.4h-4.171l.154.154h4.172V9.976Z"></path><path opacity=".2" fill="#FFF" d="M18.764 5.032c-.766-.766-1.394-.772-2.318-.772H4.241l.154.154h12.051c.462 0 1.625-.077 2.318.618"></path><radialGradient id="a" cx="538.463" cy="539.28" r="528.383" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#fff" stop-opacity="0.1"></stop><stop offset="1" stop-color="#fff" stop-opacity="0"></stop></radialGradient><path opacity=".2" fill="url(#a)" d="m23.553 9.821-4.789-4.789-4.017-4.017c-.351-.352-1.082-.772-1.7-.772-.531 0-1.052.106-1.39.309L4.241 4.259.533 11.984c-.132.281-.309.769-.309 1.082 0 .674.297 1.365.772 1.854l3.702 3.675c.089.108.192.219.315.342l.154.154.464.464 4.017 4.017.154.154h9.733v-4.172h4.171V9.976z"></path></svg>task_manager.dart</div><div class="relative pt-3 pb-0 not-prose"><pre tabindex="0" class="prism-code language-dart bg-transparent !mt-0 !mb-0 m-0 px-0 pt-0 font-jetBrains-mono pb-3"><code class="font-[inherit] bg-transparent inline-block min-w-full"><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">/// Terminates a running task with the given [pid].</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">///</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">/// Returns `true` if the task was successfully terminated; otherwise,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">/// `false`.</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> bool </span><span class="token function" style="color:#d73a49">terminate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">int pid</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> handle </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">OpenProcess</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">PROCESS_TERMINATE</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> FALSE</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> pid</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">handle </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> NULL</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">try</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token class-name">TerminateProcess</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">handle</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> TRUE</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">finally</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">CloseHandle</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">handle</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div><div class="absolute top-2 right-2 flex items-center gap-2"><button type="button" aria-label="Copy code to clipboard" title="Copy code to clipboard" class="w-6 h-6 flex justify-center items-center bg-gray-200 dark:bg-gray-800 hover:bg-gray-300 dark:hover:bg-win32-react-dark-code rounded group transition-[background-color] duration-200 ease-in-out"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" class="w-3 h-3 text-gray-500 dark:text-gray-400 transition-all duration-200 ease-in-out" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill="none" d="M0 0h24v24H0z"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></button></div></div>
<p>We first attempt to open a handle to the process with the specified PID using
<a href="https://learn.microsoft.com/windows/win32/api/processthreadsapi/nf-processthreadsapi-openprocess" target="_blank" rel="noopener noreferrer">OpenProcess</a>. If the handle is successfully opened, we proceed to terminate the
process by calling <a href="https://learn.microsoft.com/windows/win32/api/processthreadsapi/nf-processthreadsapi-terminateprocess" target="_blank" rel="noopener noreferrer">TerminateProcess</a>. If the termination is successful, the
function returns <code>true</code>; otherwise, it returns <code>false</code>. Finally, we close the
handle to the process using <code>CloseHandle</code> to ensure proper cleanup.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="building-the-ui">Building the UI<a href="https://win32.pub/blog/building-task-manager-app#building-the-ui" class="hash-link" aria-label="Direct link to Building the UI" title="Direct link to Building the UI">​</a></h2>
<p>With the task manager logic in place, we can now focus on building the UI for
our Task Manager app.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="setting-up-the-main-entry-point">Setting Up the Main Entry Point<a href="https://win32.pub/blog/building-task-manager-app#setting-up-the-main-entry-point" class="hash-link" aria-label="Direct link to Setting Up the Main Entry Point" title="Direct link to Setting Up the Main Entry Point">​</a></h3>
<p>First, open <code>lib\main.dart</code> file and replace the contents with the following
code to set up the main entry point for the app:</p>
<div class="win32-common-code-block language-dart rounded-lg bg-win32-react-light-code dark:bg-win32-react-dark-code border border-gray-300 dark:border-0 mb-6 relative win32-wider-container"><div class="py-3 px-4 bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-100 text-xs flex items-center gap-2 rounded-tl-lg rounded-tr-lg"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"><path fill="#01579B" d="M5.013 18.936.996 14.92c-.476-.489-.772-1.18-.772-1.854 0-.312.176-.801.309-1.082l3.708-7.725z"></path><path fill="#40C4FF" d="m18.764 5.032-4.017-4.017c-.351-.352-1.082-.772-1.7-.772-.531 0-1.052.106-1.39.309L4.241 4.259zM9.803 23.726h9.733v-4.172l-7.261-2.317-6.644 2.317Z"></path><path fill="#29B6F6" d="M4.241 16.773c0 1.239.155 1.543.772 2.163l.618.618h13.905l-6.798-7.724-8.497-7.571z"></path><path fill="#01579B" d="M16.601 4.259H4.241l15.295 15.295h4.171V9.976l-4.943-4.944c-.694-.697-1.311-.772-2.163-.772"></path><path opacity=".2" fill="#FFF" d="M5.168 19.091c-.618-.62-.772-1.232-.772-2.318V4.414l-.154-.154v12.513c0 1.086 0 1.387.927 2.318l.464.464z"></path><path opacity=".2" fill="#263238" d="M23.553 9.821V19.4h-4.171l.154.154h4.172V9.976Z"></path><path opacity=".2" fill="#FFF" d="M18.764 5.032c-.766-.766-1.394-.772-2.318-.772H4.241l.154.154h12.051c.462 0 1.625-.077 2.318.618"></path><radialGradient id="a" cx="538.463" cy="539.28" r="528.383" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#fff" stop-opacity="0.1"></stop><stop offset="1" stop-color="#fff" stop-opacity="0"></stop></radialGradient><path opacity=".2" fill="url(#a)" d="m23.553 9.821-4.789-4.789-4.017-4.017c-.351-.352-1.082-.772-1.7-.772-.531 0-1.052.106-1.39.309L4.241 4.259.533 11.984c-.132.281-.309.769-.309 1.082 0 .674.297 1.365.772 1.854l3.702 3.675c.089.108.192.219.315.342l.154.154.464.464 4.017 4.017.154.154h9.733v-4.172h4.171V9.976z"></path></svg>main.dart</div><div class="relative pt-3 pb-0 not-prose"><pre tabindex="0" class="prism-code language-dart bg-transparent !mt-0 !mb-0 m-0 px-0 pt-0 font-jetBrains-mono pb-3"><code class="font-[inherit] bg-transparent inline-block min-w-full"><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token string-literal string" style="color:#e3116c">'package:flutter/material.dart'</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token string-literal string" style="color:#e3116c">'models.dart'</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token string-literal string" style="color:#e3116c">'task_manager.dart'</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">main</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">runApp</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token class-name">TaskManagerApp</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">TaskManagerApp</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">extends</span><span class="token plain"> </span><span class="token class-name">StatelessWidget</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token class-name">TaskManagerApp</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token keyword" style="color:#00009f">super</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">key</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token metadata function" style="color:#d73a49">@override</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token class-name">Widget</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">build</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">BuildContext</span><span class="token plain"> context</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token class-name">MaterialApp</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      debugShowCheckedModeBanner</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      title</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string-literal string" style="color:#e3116c">'Task Manager'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      theme</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">ThemeData</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        brightness</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">Brightness</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">dark</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      home</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token class-name">TaskManagerHomeScreen</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div><div class="absolute top-2 right-2 flex items-center gap-2"><button type="button" aria-label="Copy code to clipboard" title="Copy code to clipboard" class="w-6 h-6 flex justify-center items-center bg-gray-200 dark:bg-gray-800 hover:bg-gray-300 dark:hover:bg-win32-react-dark-code rounded group transition-[background-color] duration-200 ease-in-out"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" class="w-3 h-3 text-gray-500 dark:text-gray-400 transition-all duration-200 ease-in-out" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill="none" d="M0 0h24v24H0z"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></button></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="creating-the-home-screen-skeleton">Creating the Home Screen Skeleton<a href="https://win32.pub/blog/building-task-manager-app#creating-the-home-screen-skeleton" class="hash-link" aria-label="Direct link to Creating the Home Screen Skeleton" title="Direct link to Creating the Home Screen Skeleton">​</a></h3>
<p>Next, let's create the basic structure of the home screen including the
StatefulWidget and State class.</p>
<div class="win32-common-code-block language-dart rounded-lg bg-win32-react-light-code dark:bg-win32-react-dark-code border border-gray-300 dark:border-0 mb-6 relative win32-wider-container"><div class="py-3 px-4 bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-100 text-xs flex items-center gap-2 rounded-tl-lg rounded-tr-lg"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"><path fill="#01579B" d="M5.013 18.936.996 14.92c-.476-.489-.772-1.18-.772-1.854 0-.312.176-.801.309-1.082l3.708-7.725z"></path><path fill="#40C4FF" d="m18.764 5.032-4.017-4.017c-.351-.352-1.082-.772-1.7-.772-.531 0-1.052.106-1.39.309L4.241 4.259zM9.803 23.726h9.733v-4.172l-7.261-2.317-6.644 2.317Z"></path><path fill="#29B6F6" d="M4.241 16.773c0 1.239.155 1.543.772 2.163l.618.618h13.905l-6.798-7.724-8.497-7.571z"></path><path fill="#01579B" d="M16.601 4.259H4.241l15.295 15.295h4.171V9.976l-4.943-4.944c-.694-.697-1.311-.772-2.163-.772"></path><path opacity=".2" fill="#FFF" d="M5.168 19.091c-.618-.62-.772-1.232-.772-2.318V4.414l-.154-.154v12.513c0 1.086 0 1.387.927 2.318l.464.464z"></path><path opacity=".2" fill="#263238" d="M23.553 9.821V19.4h-4.171l.154.154h4.172V9.976Z"></path><path opacity=".2" fill="#FFF" d="M18.764 5.032c-.766-.766-1.394-.772-2.318-.772H4.241l.154.154h12.051c.462 0 1.625-.077 2.318.618"></path><radialGradient id="a" cx="538.463" cy="539.28" r="528.383" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#fff" stop-opacity="0.1"></stop><stop offset="1" stop-color="#fff" stop-opacity="0"></stop></radialGradient><path opacity=".2" fill="url(#a)" d="m23.553 9.821-4.789-4.789-4.017-4.017c-.351-.352-1.082-.772-1.7-.772-.531 0-1.052.106-1.39.309L4.241 4.259.533 11.984c-.132.281-.309.769-.309 1.082 0 .674.297 1.365.772 1.854l3.702 3.675c.089.108.192.219.315.342l.154.154.464.464 4.017 4.017.154.154h9.733v-4.172h4.171V9.976z"></path></svg>main.dart</div><div class="relative pt-3 pb-0 not-prose"><pre tabindex="0" class="prism-code language-dart bg-transparent !mt-0 !mb-0 m-0 px-0 pt-0 font-jetBrains-mono pb-3"><code class="font-[inherit] bg-transparent inline-block min-w-full"><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">TaskManagerHomeScreen</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">extends</span><span class="token plain"> </span><span class="token class-name">StatefulWidget</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token class-name">TaskManagerHomeScreen</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token keyword" style="color:#00009f">super</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">key</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token metadata function" style="color:#d73a49">@override</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token class-name">TaskManagerHomeScreenState</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">createState</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token class-name">TaskManagerHomeScreenState</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">TaskManagerHomeScreenState</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">extends</span><span class="token plain"> </span><span class="token class-name">State</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">TaskManagerHomeScreen</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> _tasks </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">Task</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> _filteredTasks </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">Task</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  int</span><span class="token operator" style="color:#393A34">?</span><span class="token plain"> _selectedTask</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> _sortBy </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">SortBy</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">name</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> _sortOrder </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">SortOrder</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ascending</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token class-name">TextEditingController</span><span class="token operator" style="color:#393A34">?</span><span class="token plain"> _searchController</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token class-name">FocusNode</span><span class="token operator" style="color:#393A34">?</span><span class="token plain"> _searchFocusNode</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token metadata function" style="color:#d73a49">@override</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">initState</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">super</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">initState</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    _searchController </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">TextEditingController</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    _searchFocusNode </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">FocusNode</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">loadTasks</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token metadata function" style="color:#d73a49">@override</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">dispose</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    _searchController</span><span class="token operator" style="color:#393A34">?</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">dispose</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    _searchFocusNode</span><span class="token operator" style="color:#393A34">?</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">dispose</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">super</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">dispose</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token metadata function" style="color:#d73a49">@override</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token class-name">Widget</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">build</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">BuildContext</span><span class="token plain"> context</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token class-name">Scaffold</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      appBar</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">AppBar</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        title</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token class-name">Text</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-literal string" style="color:#e3116c">'Task Manager'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        actions</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      body</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token class-name">Center</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        child</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">Padding</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">          padding</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">EdgeInsets</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">all</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">16</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">          child</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">Text</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-literal string" style="color:#e3116c">'No tasks found'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div><div class="absolute top-2 right-2 flex items-center gap-2"><button type="button" aria-label="Copy code to clipboard" title="Copy code to clipboard" class="w-6 h-6 flex justify-center items-center bg-gray-200 dark:bg-gray-800 hover:bg-gray-300 dark:hover:bg-win32-react-dark-code rounded group transition-[background-color] duration-200 ease-in-out"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" class="w-3 h-3 text-gray-500 dark:text-gray-400 transition-all duration-200 ease-in-out" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill="none" d="M0 0h24v24H0z"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></button></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="loading-and-displaying-tasks">Loading and Displaying Tasks<a href="https://win32.pub/blog/building-task-manager-app#loading-and-displaying-tasks" class="hash-link" aria-label="Direct link to Loading and Displaying Tasks" title="Direct link to Loading and Displaying Tasks">​</a></h3>
<p>Now, let's implement the method to load tasks, update the state, and use the
<code>DataTable</code> widget to display tasks.</p>
<div class="win32-common-code-block language-dart rounded-lg bg-win32-react-light-code dark:bg-win32-react-dark-code border border-gray-300 dark:border-0 mb-6 relative win32-wider-container"><div class="py-3 px-4 bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-100 text-xs flex items-center gap-2 rounded-tl-lg rounded-tr-lg"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"><path fill="#01579B" d="M5.013 18.936.996 14.92c-.476-.489-.772-1.18-.772-1.854 0-.312.176-.801.309-1.082l3.708-7.725z"></path><path fill="#40C4FF" d="m18.764 5.032-4.017-4.017c-.351-.352-1.082-.772-1.7-.772-.531 0-1.052.106-1.39.309L4.241 4.259zM9.803 23.726h9.733v-4.172l-7.261-2.317-6.644 2.317Z"></path><path fill="#29B6F6" d="M4.241 16.773c0 1.239.155 1.543.772 2.163l.618.618h13.905l-6.798-7.724-8.497-7.571z"></path><path fill="#01579B" d="M16.601 4.259H4.241l15.295 15.295h4.171V9.976l-4.943-4.944c-.694-.697-1.311-.772-2.163-.772"></path><path opacity=".2" fill="#FFF" d="M5.168 19.091c-.618-.62-.772-1.232-.772-2.318V4.414l-.154-.154v12.513c0 1.086 0 1.387.927 2.318l.464.464z"></path><path opacity=".2" fill="#263238" d="M23.553 9.821V19.4h-4.171l.154.154h4.172V9.976Z"></path><path opacity=".2" fill="#FFF" d="M18.764 5.032c-.766-.766-1.394-.772-2.318-.772H4.241l.154.154h12.051c.462 0 1.625-.077 2.318.618"></path><radialGradient id="a" cx="538.463" cy="539.28" r="528.383" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#fff" stop-opacity="0.1"></stop><stop offset="1" stop-color="#fff" stop-opacity="0"></stop></radialGradient><path opacity=".2" fill="url(#a)" d="m23.553 9.821-4.789-4.789-4.017-4.017c-.351-.352-1.082-.772-1.7-.772-.531 0-1.052.106-1.39.309L4.241 4.259.533 11.984c-.132.281-.309.769-.309 1.082 0 .674.297 1.365.772 1.854l3.702 3.675c.089.108.192.219.315.342l.154.154.464.464 4.017 4.017.154.154h9.733v-4.172h4.171V9.976z"></path></svg>main.dart</div><div class="relative pt-3 pb-0 not-prose"><pre tabindex="0" class="prism-code language-dart bg-transparent !mt-0 !mb-0 m-0 px-0 pt-0 font-jetBrains-mono pb-3"><code class="font-[inherit] bg-transparent inline-block min-w-full"><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">loadTasks</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">setState</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    _tasks </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">TaskManager</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">tasks </span><span class="token operator" style="color:#393A34">?</span><span class="token operator" style="color:#393A34">?</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    _filteredTasks </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">List</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">from</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_tasks</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">sortTasks</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain"></span><span class="token metadata function" style="color:#d73a49">@override</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain"></span><span class="token class-name">Widget</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">build</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">BuildContext</span><span class="token plain"> context</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token class-name">Scaffold</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    appBar</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// ...</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    body</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">CustomScrollView</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      slivers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">SliverToBoxAdapter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">          child</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> _filteredTasks</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">isEmpty</span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">              </span><span class="token operator" style="color:#393A34">?</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token class-name">Center</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                  child</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">Padding</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                    padding</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">EdgeInsets</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">all</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">16</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                    child</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">Text</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-literal string" style="color:#e3116c">'No tasks found'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                  </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">              </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">DataTable</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                  columns</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token class-name">DataColumn</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">label</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">Text</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-literal string" style="color:#e3116c">'Name'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token class-name">DataColumn</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">label</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">Text</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-literal string" style="color:#e3116c">'PID'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> numeric</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token class-name">DataColumn</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">label</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">Text</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-literal string" style="color:#e3116c">'Description'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token class-name">DataColumn</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">label</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">Text</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-literal string" style="color:#e3116c">'Actions'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                  </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                  rows</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> _filteredTasks</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">map</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">task</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token class-name">DataRow</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                      cells</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                        </span><span class="token class-name">DataCell</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">Text</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">task</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">name</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                        </span><span class="token class-name">DataCell</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">Text</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">task</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">pid</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">toString</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                        </span><span class="token class-name">DataCell</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">Text</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">task</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">description</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                        </span><span class="token class-name">DataCell</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                          </span><span class="token class-name">IconButton</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                            icon</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token class-name">Icon</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                              </span><span class="token class-name">Icons</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">cancel_outlined</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                              color</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">Colors</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">red</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                            </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                            onPressed</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                          </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                        </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                      </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">toList</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div><div class="absolute top-2 right-2 flex items-center gap-2"><button type="button" aria-label="Copy code to clipboard" title="Copy code to clipboard" class="w-6 h-6 flex justify-center items-center bg-gray-200 dark:bg-gray-800 hover:bg-gray-300 dark:hover:bg-win32-react-dark-code rounded group transition-[background-color] duration-200 ease-in-out"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" class="w-3 h-3 text-gray-500 dark:text-gray-400 transition-all duration-200 ease-in-out" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill="none" d="M0 0h24v24H0z"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></button></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="task-sorting-searching-and-refreshing">Task Sorting, Searching, and Refreshing<a href="https://win32.pub/blog/building-task-manager-app#task-sorting-searching-and-refreshing" class="hash-link" aria-label="Direct link to Task Sorting, Searching, and Refreshing" title="Direct link to Task Sorting, Searching, and Refreshing">​</a></h3>
<p>Next, let's implement the functionality to sort and search tasks based on the
user's input and add a button to the app bar to refresh the task list.</p>
<div class="win32-common-code-block language-dart rounded-lg bg-win32-react-light-code dark:bg-win32-react-dark-code border border-gray-300 dark:border-0 mb-6 relative win32-wider-container"><div class="py-3 px-4 bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-100 text-xs flex items-center gap-2 rounded-tl-lg rounded-tr-lg"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"><path fill="#01579B" d="M5.013 18.936.996 14.92c-.476-.489-.772-1.18-.772-1.854 0-.312.176-.801.309-1.082l3.708-7.725z"></path><path fill="#40C4FF" d="m18.764 5.032-4.017-4.017c-.351-.352-1.082-.772-1.7-.772-.531 0-1.052.106-1.39.309L4.241 4.259zM9.803 23.726h9.733v-4.172l-7.261-2.317-6.644 2.317Z"></path><path fill="#29B6F6" d="M4.241 16.773c0 1.239.155 1.543.772 2.163l.618.618h13.905l-6.798-7.724-8.497-7.571z"></path><path fill="#01579B" d="M16.601 4.259H4.241l15.295 15.295h4.171V9.976l-4.943-4.944c-.694-.697-1.311-.772-2.163-.772"></path><path opacity=".2" fill="#FFF" d="M5.168 19.091c-.618-.62-.772-1.232-.772-2.318V4.414l-.154-.154v12.513c0 1.086 0 1.387.927 2.318l.464.464z"></path><path opacity=".2" fill="#263238" d="M23.553 9.821V19.4h-4.171l.154.154h4.172V9.976Z"></path><path opacity=".2" fill="#FFF" d="M18.764 5.032c-.766-.766-1.394-.772-2.318-.772H4.241l.154.154h12.051c.462 0 1.625-.077 2.318.618"></path><radialGradient id="a" cx="538.463" cy="539.28" r="528.383" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#fff" stop-opacity="0.1"></stop><stop offset="1" stop-color="#fff" stop-opacity="0"></stop></radialGradient><path opacity=".2" fill="url(#a)" d="m23.553 9.821-4.789-4.789-4.017-4.017c-.351-.352-1.082-.772-1.7-.772-.531 0-1.052.106-1.39.309L4.241 4.259.533 11.984c-.132.281-.309.769-.309 1.082 0 .674.297 1.365.772 1.854l3.702 3.675c.089.108.192.219.315.342l.154.154.464.464 4.017 4.017.154.154h9.733v-4.172h4.171V9.976z"></path></svg>main.dart</div><div class="relative pt-3 pb-0 not-prose"><pre tabindex="0" class="prism-code language-dart bg-transparent !mt-0 !mb-0 m-0 px-0 pt-0 font-jetBrains-mono pb-3"><code class="font-[inherit] bg-transparent inline-block min-w-full"><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">searchTasks</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">String</span><span class="token plain"> query</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> filtered </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> _tasks</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">where</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">task</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> task</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">name</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">toLowerCase</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">contains</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">query</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">toLowerCase</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        task</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">description</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">toLowerCase</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">contains</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">query</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">toLowerCase</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        task</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">pid</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">toString</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">contains</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">query</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">toList</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">setState</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    _filteredTasks </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> filtered</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">sortTasks</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">sortTasks</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">setState</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    _filteredTasks</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">sort</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">a</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> b</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> cmp </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">switch</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_sortBy</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">SortBy</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">name </span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> a</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">name</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">compareTo</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">b</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">name</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">SortBy</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">pid </span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> a</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">pid</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">compareTo</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">b</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">pid</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">SortBy</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">description </span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> a</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">description</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">compareTo</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">b</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">description</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> _sortOrder </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token class-name">SortOrder</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ascending </span><span class="token operator" style="color:#393A34">?</span><span class="token plain"> cmp </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">cmp</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain"></span><span class="token metadata function" style="color:#d73a49">@override</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain"></span><span class="token class-name">Widget</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">build</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">BuildContext</span><span class="token plain"> context</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token class-name">Scaffold</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    appBar</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">AppBar</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      title</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token class-name">Text</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-literal string" style="color:#e3116c">'Task Manager'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      actions</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">Padding</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">          padding</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token class-name">EdgeInsets</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">symmetric</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">horizontal</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">          child</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">Tooltip</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">            message</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string-literal string" style="color:#e3116c">'Type a name or PID to search'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">            child</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">SizedBox</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">              height</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">40</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">              width</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">300</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">              child</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">TextField</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                controller</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> _searchController</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                focusNode</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> _searchFocusNode</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                decoration</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">InputDecoration</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                  labelText</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string-literal string" style="color:#e3116c">'Type a name or PID to search'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                  border</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token class-name">OutlineInputBorder</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                  prefixIcon</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token class-name">Icon</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">Icons</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">search</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                  suffix</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> _searchController</span><span class="token operator" style="color:#393A34">!</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">text</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">isNotEmpty</span><br></span><span class="token-line theme-code-block-highlighted-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                      </span><span class="token operator" style="color:#393A34">?</span><span class="token plain"> </span><span class="token class-name">IconButton</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                          icon</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token class-name">Icon</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">Icons</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">clear</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                          onPressed</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                            </span><span class="token function" style="color:#d73a49">setState</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                              _searchController</span><span class="token operator" style="color:#393A34">!</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">clear</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                              _searchFocusNode</span><span class="token operator" style="color:#393A34">!</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">unfocus</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                              _tasks </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">TaskManager</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">tasks </span><span class="token operator" style="color:#393A34">?</span><span class="token operator" style="color:#393A34">?</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                              _filteredTasks </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">List</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">from</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_tasks</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                              </span><span class="token function" style="color:#d73a49">sortTasks</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                          </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                        </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                      </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                onChanged</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> searchTasks</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">              </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">Padding</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">          padding</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token class-name">EdgeInsets</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">symmetric</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">horizontal</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">          child</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">IconButton</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">            icon</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token class-name">Icon</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">Icons</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">refresh</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">            onPressed</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">              </span><span class="token function" style="color:#d73a49">setState</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                _tasks </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">TaskManager</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">tasks </span><span class="token operator" style="color:#393A34">?</span><span class="token operator" style="color:#393A34">?</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_searchController</span><span class="token operator" style="color:#393A34">!</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">text</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">isNotEmpty</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                  </span><span class="token function" style="color:#d73a49">searchTasks</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_searchController</span><span class="token operator" style="color:#393A34">!</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">text</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                  _filteredTasks </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">List</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">from</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_tasks</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                  </span><span class="token function" style="color:#d73a49">sortTasks</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">              </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">            tooltip</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string-literal string" style="color:#e3116c">'Refresh the list of tasks'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    body</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">CustomScrollView</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      slivers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">SliverToBoxAdapter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">          child</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> _filteredTasks</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">isEmpty</span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">              </span><span class="token operator" style="color:#393A34">?</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token class-name">Center</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                  child</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">Padding</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                    padding</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">EdgeInsets</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">all</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">16</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                    child</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">Text</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-literal string" style="color:#e3116c">'No tasks found'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                  </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">              </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">DataTable</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                  columns</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                    </span><span class="token class-name">DataColumn</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                      label</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token class-name">Text</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-literal string" style="color:#e3116c">'Name'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                      onSort</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">columnIndex</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> ascending</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                        </span><span class="token function" style="color:#d73a49">setState</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                          _sortBy </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">SortBy</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">name</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                          _sortOrder </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ascending</span><br></span><span class="token-line theme-code-block-highlighted-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                              </span><span class="token operator" style="color:#393A34">?</span><span class="token plain"> </span><span class="token class-name">SortOrder</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ascending</span><br></span><span class="token-line theme-code-block-highlighted-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                              </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">SortOrder</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">descending</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                          </span><span class="token function" style="color:#d73a49">sortTasks</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                    </span><span class="token class-name">DataColumn</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                      label</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token class-name">Text</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-literal string" style="color:#e3116c">'PID'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                      numeric</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                      onSort</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">columnIndex</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> ascending</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                        </span><span class="token function" style="color:#d73a49">setState</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                          _sortBy </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">SortBy</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">pid</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                          _sortOrder </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ascending</span><br></span><span class="token-line theme-code-block-highlighted-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                              </span><span class="token operator" style="color:#393A34">?</span><span class="token plain"> </span><span class="token class-name">SortOrder</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ascending</span><br></span><span class="token-line theme-code-block-highlighted-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                              </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">SortOrder</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">descending</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                          </span><span class="token function" style="color:#d73a49">sortTasks</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                      tooltip</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string-literal string" style="color:#e3116c">'Process ID'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                    </span><span class="token class-name">DataColumn</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                      label</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token class-name">Text</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-literal string" style="color:#e3116c">'Description'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                      onSort</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">columnIndex</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> ascending</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                        </span><span class="token function" style="color:#d73a49">setState</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                          _sortBy </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">SortBy</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">description</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                          _sortOrder </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ascending</span><br></span><span class="token-line theme-code-block-highlighted-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                              </span><span class="token operator" style="color:#393A34">?</span><span class="token plain"> </span><span class="token class-name">SortOrder</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ascending</span><br></span><span class="token-line theme-code-block-highlighted-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                              </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">SortOrder</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">descending</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                          </span><span class="token function" style="color:#d73a49">sortTasks</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token class-name">DataColumn</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">label</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">Text</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-literal string" style="color:#e3116c">'Actions'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                  </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                  rows</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// ...</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                  sortAscending</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> _sortOrder </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token class-name">SortOrder</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ascending</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                  sortColumnIndex</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">switch</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_sortBy</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                    </span><span class="token class-name">SortBy</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">name </span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                    </span><span class="token class-name">SortBy</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">pid </span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                    </span><span class="token class-name">SortBy</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">description </span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div><div class="absolute top-2 right-2 flex items-center gap-2"><button type="button" aria-label="Copy code to clipboard" title="Copy code to clipboard" class="w-6 h-6 flex justify-center items-center bg-gray-200 dark:bg-gray-800 hover:bg-gray-300 dark:hover:bg-win32-react-dark-code rounded group transition-[background-color] duration-200 ease-in-out"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" class="w-3 h-3 text-gray-500 dark:text-gray-400 transition-all duration-200 ease-in-out" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill="none" d="M0 0h24v24H0z"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></button></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="task-termination">Task Termination<a href="https://win32.pub/blog/building-task-manager-app#task-termination" class="hash-link" aria-label="Direct link to Task Termination" title="Direct link to Task Termination">​</a></h3>
<p>Next, let's implement the functionality to terminate a task. We'll display a
confirmation dialog to user before terminating the task.</p>
<div class="win32-common-code-block language-dart rounded-lg bg-win32-react-light-code dark:bg-win32-react-dark-code border border-gray-300 dark:border-0 mb-6 relative win32-wider-container"><div class="py-3 px-4 bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-100 text-xs flex items-center gap-2 rounded-tl-lg rounded-tr-lg"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"><path fill="#01579B" d="M5.013 18.936.996 14.92c-.476-.489-.772-1.18-.772-1.854 0-.312.176-.801.309-1.082l3.708-7.725z"></path><path fill="#40C4FF" d="m18.764 5.032-4.017-4.017c-.351-.352-1.082-.772-1.7-.772-.531 0-1.052.106-1.39.309L4.241 4.259zM9.803 23.726h9.733v-4.172l-7.261-2.317-6.644 2.317Z"></path><path fill="#29B6F6" d="M4.241 16.773c0 1.239.155 1.543.772 2.163l.618.618h13.905l-6.798-7.724-8.497-7.571z"></path><path fill="#01579B" d="M16.601 4.259H4.241l15.295 15.295h4.171V9.976l-4.943-4.944c-.694-.697-1.311-.772-2.163-.772"></path><path opacity=".2" fill="#FFF" d="M5.168 19.091c-.618-.62-.772-1.232-.772-2.318V4.414l-.154-.154v12.513c0 1.086 0 1.387.927 2.318l.464.464z"></path><path opacity=".2" fill="#263238" d="M23.553 9.821V19.4h-4.171l.154.154h4.172V9.976Z"></path><path opacity=".2" fill="#FFF" d="M18.764 5.032c-.766-.766-1.394-.772-2.318-.772H4.241l.154.154h12.051c.462 0 1.625-.077 2.318.618"></path><radialGradient id="a" cx="538.463" cy="539.28" r="528.383" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#fff" stop-opacity="0.1"></stop><stop offset="1" stop-color="#fff" stop-opacity="0"></stop></radialGradient><path opacity=".2" fill="url(#a)" d="m23.553 9.821-4.789-4.789-4.017-4.017c-.351-.352-1.082-.772-1.7-.772-.531 0-1.052.106-1.39.309L4.241 4.259.533 11.984c-.132.281-.309.769-.309 1.082 0 .674.297 1.365.772 1.854l3.702 3.675c.089.108.192.219.315.342l.154.154.464.464 4.017 4.017.154.154h9.733v-4.172h4.171V9.976z"></path></svg>main.dart</div><div class="relative pt-3 pb-0 not-prose"><pre tabindex="0" class="prism-code language-dart bg-transparent !mt-0 !mb-0 m-0 px-0 pt-0 font-jetBrains-mono pb-3"><code class="font-[inherit] bg-transparent inline-block min-w-full"><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">confirmEndTask</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">int pid</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">String</span><span class="token plain"> taskName</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">showDialog</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    context</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> context</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    builder</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">context</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token class-name">AlertDialog</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        title</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">Text</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-literal string" style="color:#e3116c">'Do you want to end </span><span class="token string-literal interpolation punctuation" style="color:#393A34">$</span><span class="token string-literal interpolation expression">taskName</span><span class="token string-literal string" style="color:#e3116c">?'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        content</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token class-name">Text</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">          </span><span class="token string-literal string" style="color:#e3116c">'If an open program is associated with this process, it will close '</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">          </span><span class="token string-literal string" style="color:#e3116c">'and you will lose any unsaved data. If you end a system process, '</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">          </span><span class="token string-literal string" style="color:#e3116c">'it might result in system instability. Are you sure you want to '</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">          </span><span class="token string-literal string" style="color:#e3116c">'continue?'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        actions</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">Widget</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">          </span><span class="token class-name">TextButton</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">            child</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token class-name">Text</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-literal string" style="color:#e3116c">'End task'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">            onPressed</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">              </span><span class="token class-name">Navigator</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">of</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">context</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">pop</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">              </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">TaskManager</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">terminate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">pid</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                </span><span class="token class-name">ScaffoldMessenger</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">of</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">context</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">showSnackBar</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                  </span><span class="token class-name">SnackBar</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                    content</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">Text</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-literal string" style="color:#e3116c">'Task "</span><span class="token string-literal interpolation punctuation" style="color:#393A34">$</span><span class="token string-literal interpolation expression">taskName</span><span class="token string-literal string" style="color:#e3116c">" ended successfully'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                  </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                </span><span class="token function" style="color:#d73a49">loadTasks</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">              </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                </span><span class="token class-name">ScaffoldMessenger</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">of</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">context</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">showSnackBar</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                  </span><span class="token class-name">SnackBar</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                    content</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">Text</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-literal string" style="color:#e3116c">'Failed to end task "</span><span class="token string-literal interpolation punctuation" style="color:#393A34">$</span><span class="token string-literal interpolation expression">taskName</span><span class="token string-literal string" style="color:#e3116c">"'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                  </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">              </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">          </span><span class="token class-name">TextButton</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">            child</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token class-name">Text</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-literal string" style="color:#e3116c">'Cancel'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">            onPressed</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">              </span><span class="token class-name">Navigator</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">of</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">context</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">pop</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain"></span><span class="token metadata function" style="color:#d73a49">@override</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain"></span><span class="token class-name">Widget</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">build</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">BuildContext</span><span class="token plain"> context</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token class-name">Scaffold</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    appBar</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// ...</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    body</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">CustomScrollView</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      slivers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">SliverToBoxAdapter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">          child</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> _filteredTasks</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">isEmpty</span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">            </span><span class="token operator" style="color:#393A34">?</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token class-name">Center</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                child</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">Padding</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                  padding</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">EdgeInsets</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">all</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">16</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                  child</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">Text</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-literal string" style="color:#e3116c">'No tasks found'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">              </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">DataTable</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                columns</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// ...</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                rows</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> _filteredTasks</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">map</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">task</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                  </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token class-name">DataRow</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                    cells</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                      </span><span class="token comment" style="color:#999988;font-style:italic">// ...</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                      </span><span class="token class-name">DataCell</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                        </span><span class="token class-name">IconButton</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                          icon</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token class-name">Icon</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                            </span><span class="token class-name">Icons</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">cancel_outlined</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                            color</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">Colors</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">red</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                          </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                          onPressed</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">confirmEndTask</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">task</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">pid</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> task</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">name</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                        </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                      </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                    </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                  </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">toList</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                </span><span class="token comment" style="color:#999988;font-style:italic">// ...</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">              </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div><div class="absolute top-2 right-2 flex items-center gap-2"><button type="button" aria-label="Copy code to clipboard" title="Copy code to clipboard" class="w-6 h-6 flex justify-center items-center bg-gray-200 dark:bg-gray-800 hover:bg-gray-300 dark:hover:bg-win32-react-dark-code rounded group transition-[background-color] duration-200 ease-in-out"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" class="w-3 h-3 text-gray-500 dark:text-gray-400 transition-all duration-200 ease-in-out" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill="none" d="M0 0h24v24H0z"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></button></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="task-creation">Task Creation<a href="https://win32.pub/blog/building-task-manager-app#task-creation" class="hash-link" aria-label="Direct link to Task Creation" title="Direct link to Task Creation">​</a></h3>
<p>Finally, let's implement the functionality to run a new task by displaying a
dialog with a text field to the user for entering the task name.</p>
<div class="win32-common-code-block language-dart rounded-lg bg-win32-react-light-code dark:bg-win32-react-dark-code border border-gray-300 dark:border-0 mb-6 relative win32-wider-container"><div class="py-3 px-4 bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-100 text-xs flex items-center gap-2 rounded-tl-lg rounded-tr-lg"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"><path fill="#01579B" d="M5.013 18.936.996 14.92c-.476-.489-.772-1.18-.772-1.854 0-.312.176-.801.309-1.082l3.708-7.725z"></path><path fill="#40C4FF" d="m18.764 5.032-4.017-4.017c-.351-.352-1.082-.772-1.7-.772-.531 0-1.052.106-1.39.309L4.241 4.259zM9.803 23.726h9.733v-4.172l-7.261-2.317-6.644 2.317Z"></path><path fill="#29B6F6" d="M4.241 16.773c0 1.239.155 1.543.772 2.163l.618.618h13.905l-6.798-7.724-8.497-7.571z"></path><path fill="#01579B" d="M16.601 4.259H4.241l15.295 15.295h4.171V9.976l-4.943-4.944c-.694-.697-1.311-.772-2.163-.772"></path><path opacity=".2" fill="#FFF" d="M5.168 19.091c-.618-.62-.772-1.232-.772-2.318V4.414l-.154-.154v12.513c0 1.086 0 1.387.927 2.318l.464.464z"></path><path opacity=".2" fill="#263238" d="M23.553 9.821V19.4h-4.171l.154.154h4.172V9.976Z"></path><path opacity=".2" fill="#FFF" d="M18.764 5.032c-.766-.766-1.394-.772-2.318-.772H4.241l.154.154h12.051c.462 0 1.625-.077 2.318.618"></path><radialGradient id="a" cx="538.463" cy="539.28" r="528.383" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#fff" stop-opacity="0.1"></stop><stop offset="1" stop-color="#fff" stop-opacity="0"></stop></radialGradient><path opacity=".2" fill="url(#a)" d="m23.553 9.821-4.789-4.789-4.017-4.017c-.351-.352-1.082-.772-1.7-.772-.531 0-1.052.106-1.39.309L4.241 4.259.533 11.984c-.132.281-.309.769-.309 1.082 0 .674.297 1.365.772 1.854l3.702 3.675c.089.108.192.219.315.342l.154.154.464.464 4.017 4.017.154.154h9.733v-4.172h4.171V9.976z"></path></svg>main.dart</div><div class="relative pt-3 pb-0 not-prose"><pre tabindex="0" class="prism-code language-dart bg-transparent !mt-0 !mb-0 m-0 px-0 pt-0 font-jetBrains-mono pb-3"><code class="font-[inherit] bg-transparent inline-block min-w-full"><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">runTask</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">String</span><span class="token plain"> path</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> result </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">TaskManager</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">run</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">path</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">result</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">Navigator</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">of</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">context</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">pop</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">ScaffoldMessenger</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">of</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">context</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">showSnackBar</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token class-name">SnackBar</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        content</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">Text</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-literal string" style="color:#e3116c">'Task "</span><span class="token string-literal interpolation punctuation" style="color:#393A34">$</span><span class="token string-literal interpolation expression">path</span><span class="token string-literal string" style="color:#e3116c">" started successfully'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">showDialog</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      context</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> context</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      builder</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">context</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token class-name">AlertDialog</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">          title</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token class-name">Text</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-literal string" style="color:#e3116c">'Error'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">          content</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">Text</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-literal string" style="color:#e3116c">'Failed to run task "</span><span class="token string-literal interpolation punctuation" style="color:#393A34">$</span><span class="token string-literal interpolation expression">path</span><span class="token string-literal string" style="color:#e3116c">"'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">          actions</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">            </span><span class="token class-name">TextButton</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">              onPressed</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                </span><span class="token class-name">Navigator</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">of</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">context</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">pop</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">              </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">              child</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token class-name">Text</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-literal string" style="color:#e3116c">'Ok'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">showRunTaskDialog</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> taskNameController </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">TextEditingController</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">showDialog</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    context</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> context</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    builder</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">context</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token class-name">AlertDialog</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        title</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token class-name">Text</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-literal string" style="color:#e3116c">'Run new task'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        content</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">TextField</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">          autofocus</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">          onSubmitted</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> path </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> taskNameController</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">text</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">path</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">isNotEmpty</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">              </span><span class="token function" style="color:#d73a49">runTask</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">path</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">          controller</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> taskNameController</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">          decoration</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token class-name">InputDecoration</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">hintText</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string-literal string" style="color:#e3116c">'Enter task name'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        actions</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">          </span><span class="token class-name">TextButton</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">            onPressed</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">              </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> path </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> taskNameController</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">text</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">              </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">path</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">isNotEmpty</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                </span><span class="token function" style="color:#d73a49">runTask</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">path</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">              </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">            child</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token class-name">Text</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-literal string" style="color:#e3116c">'Run'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">          </span><span class="token class-name">TextButton</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">            onPressed</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">              </span><span class="token class-name">Navigator</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">of</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">context</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">pop</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">            child</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token class-name">Text</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-literal string" style="color:#e3116c">'Cancel'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain"></span><span class="token metadata function" style="color:#d73a49">@override</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain"></span><span class="token class-name">Widget</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">build</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">BuildContext</span><span class="token plain"> context</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token class-name">Scaffold</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    appBar</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">AppBar</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      title</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token class-name">Text</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-literal string" style="color:#e3116c">'Task Manager'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      actions</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// ...</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">Padding</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">          padding</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token class-name">EdgeInsets</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">symmetric</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">horizontal</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">          child</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">IconButton</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">            onPressed</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> showRunTaskDialog</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">            icon</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token class-name">Icon</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">Icons</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">add</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">            tooltip</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string-literal string" style="color:#e3116c">'Run a new task'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// ...</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div><div class="absolute top-2 right-2 flex items-center gap-2"><button type="button" aria-label="Copy code to clipboard" title="Copy code to clipboard" class="w-6 h-6 flex justify-center items-center bg-gray-200 dark:bg-gray-800 hover:bg-gray-300 dark:hover:bg-win32-react-dark-code rounded group transition-[background-color] duration-200 ease-in-out"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" class="w-3 h-3 text-gray-500 dark:text-gray-400 transition-all duration-200 ease-in-out" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill="none" d="M0 0h24v24H0z"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></button></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="conclusion">Conclusion<a href="https://win32.pub/blog/building-task-manager-app#conclusion" class="hash-link" aria-label="Direct link to Conclusion" title="Direct link to Conclusion">​</a></h2>
<p>In this blog post, we've built an app in Flutter using the <strong>win32</strong> package to
manage running tasks on a Windows system. We've covered the process of
enumerating running tasks, starting new tasks, and terminating tasks, as well as
building a beautiful UI to interact with the task manager.</p>
<p>I hope this tutorial has inspired you to explore further and build even more
advanced applications with Dart, Flutter, and <strong>win32</strong>. Your feedback and
contributions are always welcome, so feel free to share your thoughts and ideas.</p>
<p>Happy coding! 🚀</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="source-code">Source Code<a href="https://win32.pub/blog/building-task-manager-app#source-code" class="hash-link" aria-label="Direct link to Source Code" title="Direct link to Source Code">​</a></h2>
<div class="win32-wider-container py-2 px-2 flex items-center gap-2 rounded-lg font-sans text-base bg-gray-100 dark:bg-gray-700 mb-6"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 496 512" class="ml-1.5 w-6 h-6 text-gray-700 dark:text-gray-100" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg><a href="https://github.com/halildurmus/win32/tree/main/examples/task_manager" target="_blank" rel="noopener noreferrer" class="text-base leading-8 text-win32-react-light-link dark:text-win32-react-dark-link"><span>View Source Code</span></a></div>]]></content>
        <author>
            <name>Halil Durmus</name>
            <uri>https://halildurmus.dev</uri>
        </author>
        <category label="win32" term="win32"/>
        <category label="flutter" term="flutter"/>
        <category label="tutorial" term="tutorial"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Building a Service Manager CLI in Dart with win32]]></title>
        <id>https://win32.pub/blog/building-service-manager-cli</id>
        <link href="https://win32.pub/blog/building-service-manager-cli"/>
        <updated>2024-07-13T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[We'll build a command-line interface (CLI) to manage Windows services in Dart using the win32 package.]]></summary>
        <content type="html"><![CDATA[<h2 class="anchor anchorWithStickyNavbar_LWe7" id="introduction">Introduction<a href="https://win32.pub/blog/building-service-manager-cli#introduction" class="hash-link" aria-label="Direct link to Introduction" title="Direct link to Introduction">​</a></h2>
<p>In this blog post, we will explore how to build a Service Manager CLI in Dart
using the <strong>win32</strong> package. By leveraging the Windows APIs provided by
<strong>win32</strong>, we'll create a robust command-line tool that can
<strong>enumerate services</strong>, <strong>start and stop services</strong>, and
<strong>query service status</strong>.</p>
<p>Whether you're looking to enhance your development toolkit or simply learn more
about integrating Dart with Windows system functionalities, this guide will
provide you with the insights and steps necessary to build your own service
manager from scratch.</p>
<p>Here's what we'll cover:</p>
<ul>
<li><a href="https://win32.pub/blog/building-service-manager-cli#feature-overview">Feature Overview</a></li>
<li><a href="https://win32.pub/blog/building-service-manager-cli#setting-up-the-project">Setting Up the Project</a>
<ul>
<li><a href="https://win32.pub/blog/building-service-manager-cli#creating-a-new-dart-project">Creating a New Dart Project</a></li>
<li><a href="https://win32.pub/blog/building-service-manager-cli#installing-dependencies">Installing Dependencies</a></li>
</ul>
</li>
<li><a href="https://win32.pub/blog/building-service-manager-cli#defining-the-models">Defining the Models</a></li>
<li><a href="https://win32.pub/blog/building-service-manager-cli#implementing-service-manager-logic">Implementing Service Manager Logic</a>
<ul>
<li><a href="https://win32.pub/blog/building-service-manager-cli#enumerating-services">Enumerating Services</a></li>
<li><a href="https://win32.pub/blog/building-service-manager-cli#starting-a-service">Starting a Service</a></li>
<li><a href="https://win32.pub/blog/building-service-manager-cli#stopping-a-service">Stopping a Service</a></li>
<li><a href="https://win32.pub/blog/building-service-manager-cli#querying-service-status">Querying Service Status</a></li>
</ul>
</li>
<li><a href="https://win32.pub/blog/building-service-manager-cli#building-the-cli">Building the CLI</a></li>
<li><a href="https://win32.pub/blog/building-service-manager-cli#conclusion">Conclusion</a></li>
<li><a href="https://win32.pub/blog/building-service-manager-cli#source-code">Source Code</a></li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="feature-overview">Feature Overview<a href="https://win32.pub/blog/building-service-manager-cli#feature-overview" class="hash-link" aria-label="Direct link to Feature Overview" title="Direct link to Feature Overview">​</a></h2>
<p>Our Service Manager CLI will include the following key features:</p>
<ul>
<li><strong>Enumerating services:</strong> View a set of all available services on the system.</li>
<li><strong>Starting and stopping a service:</strong> Start or stop a service by its name.</li>
<li><strong>Querying service status:</strong> Retrieve the current operational status of a
service by its name.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="setting-up-the-project">Setting Up the Project<a href="https://win32.pub/blog/building-service-manager-cli#setting-up-the-project" class="hash-link" aria-label="Direct link to Setting Up the Project" title="Direct link to Setting Up the Project">​</a></h2>
<p>Before we dive into coding, let’s set up our project.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="creating-a-new-dart-project">Creating a New Dart Project<a href="https://win32.pub/blog/building-service-manager-cli#creating-a-new-dart-project" class="hash-link" aria-label="Direct link to Creating a New Dart Project" title="Direct link to Creating a New Dart Project">​</a></h3>
<p>Open your terminal and run:</p>
<div class="win32-common-code-block language-cmd rounded-lg bg-win32-react-light-code dark:bg-win32-react-dark-code border border-gray-300 dark:border-0 mb-6 relative win32-wider-container"><div class="py-3 px-4 bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-100 text-xs flex items-center gap-2 rounded-tl-lg rounded-tr-lg"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" height="20" width="20" xmlns="http://www.w3.org/2000/svg"><path fill="none" stroke-linejoin="round" stroke-width="32" d="M416 221.25V416a48 48 0 0 1-48 48H144a48 48 0 0 1-48-48V96a48 48 0 0 1 48-48h98.75a32 32 0 0 1 22.62 9.37l141.26 141.26a32 32 0 0 1 9.37 22.62z"></path><path fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-width="32" d="M256 56v120a32 32 0 0 0 32 32h120m-232 80h160m-160 80h160"></path></svg>Terminal</div><div class="relative pt-3 pb-0 not-prose"><pre tabindex="0" class="prism-code language-cmd bg-transparent !mt-0 !mb-0 m-0 px-0 pt-0 font-jetBrains-mono pb-3"><code class="font-[inherit] bg-transparent inline-block min-w-full"><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">&gt; dart create service_manager_cli</span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">&gt; cd service_manager_cli</span><br></span></code></pre></div><div class="absolute top-2 right-2 flex items-center gap-2"><button type="button" aria-label="Copy code to clipboard" title="Copy code to clipboard" class="w-6 h-6 flex justify-center items-center bg-gray-200 dark:bg-gray-800 hover:bg-gray-300 dark:hover:bg-win32-react-dark-code rounded group transition-[background-color] duration-200 ease-in-out"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" class="w-3 h-3 text-gray-500 dark:text-gray-400 transition-all duration-200 ease-in-out" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill="none" d="M0 0h24v24H0z"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></button></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="installing-dependencies">Installing Dependencies<a href="https://win32.pub/blog/building-service-manager-cli#installing-dependencies" class="hash-link" aria-label="Direct link to Installing Dependencies" title="Direct link to Installing Dependencies">​</a></h3>
<p>Add the <strong>ffi</strong> and <strong>win32</strong> packages to your project with:</p>
<div class="win32-common-code-block language-cmd rounded-lg bg-win32-react-light-code dark:bg-win32-react-dark-code border border-gray-300 dark:border-0 mb-6 relative win32-wider-container"><div class="py-3 px-4 bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-100 text-xs flex items-center gap-2 rounded-tl-lg rounded-tr-lg"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" height="20" width="20" xmlns="http://www.w3.org/2000/svg"><path fill="none" stroke-linejoin="round" stroke-width="32" d="M416 221.25V416a48 48 0 0 1-48 48H144a48 48 0 0 1-48-48V96a48 48 0 0 1 48-48h98.75a32 32 0 0 1 22.62 9.37l141.26 141.26a32 32 0 0 1 9.37 22.62z"></path><path fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-width="32" d="M256 56v120a32 32 0 0 0 32 32h120m-232 80h160m-160 80h160"></path></svg>Terminal</div><div class="relative pt-3 pb-0 not-prose"><pre tabindex="0" class="prism-code language-cmd bg-transparent !mt-0 !mb-0 m-0 px-0 pt-0 font-jetBrains-mono pb-3"><code class="font-[inherit] bg-transparent inline-block min-w-full"><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">dart pub add ffi win32</span><br></span></code></pre></div><div class="absolute top-2 right-2 flex items-center gap-2"><button type="button" aria-label="Copy code to clipboard" title="Copy code to clipboard" class="w-6 h-6 flex justify-center items-center bg-gray-200 dark:bg-gray-800 hover:bg-gray-300 dark:hover:bg-win32-react-dark-code rounded group transition-[background-color] duration-200 ease-in-out"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" class="w-3 h-3 text-gray-500 dark:text-gray-400 transition-all duration-200 ease-in-out" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill="none" d="M0 0h24v24H0z"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></button></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="defining-the-models">Defining the Models<a href="https://win32.pub/blog/building-service-manager-cli#defining-the-models" class="hash-link" aria-label="Direct link to Defining the Models" title="Direct link to Defining the Models">​</a></h2>
<p>We'll start by defining the models responsible for storing
<strong>service information</strong> and result details for <strong>start</strong> and <strong>stop</strong>
operations.</p>
<p>Create a new file named <code>models.dart</code> in the <code>lib\src</code> directory and add the
following code:</p>
<div class="win32-common-code-block language-dart rounded-lg bg-win32-react-light-code dark:bg-win32-react-dark-code border border-gray-300 dark:border-0 mb-6 relative win32-wider-container"><div class="py-3 px-4 bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-100 text-xs flex items-center gap-2 rounded-tl-lg rounded-tr-lg"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"><path fill="#01579B" d="M5.013 18.936.996 14.92c-.476-.489-.772-1.18-.772-1.854 0-.312.176-.801.309-1.082l3.708-7.725z"></path><path fill="#40C4FF" d="m18.764 5.032-4.017-4.017c-.351-.352-1.082-.772-1.7-.772-.531 0-1.052.106-1.39.309L4.241 4.259zM9.803 23.726h9.733v-4.172l-7.261-2.317-6.644 2.317Z"></path><path fill="#29B6F6" d="M4.241 16.773c0 1.239.155 1.543.772 2.163l.618.618h13.905l-6.798-7.724-8.497-7.571z"></path><path fill="#01579B" d="M16.601 4.259H4.241l15.295 15.295h4.171V9.976l-4.943-4.944c-.694-.697-1.311-.772-2.163-.772"></path><path opacity=".2" fill="#FFF" d="M5.168 19.091c-.618-.62-.772-1.232-.772-2.318V4.414l-.154-.154v12.513c0 1.086 0 1.387.927 2.318l.464.464z"></path><path opacity=".2" fill="#263238" d="M23.553 9.821V19.4h-4.171l.154.154h4.172V9.976Z"></path><path opacity=".2" fill="#FFF" d="M18.764 5.032c-.766-.766-1.394-.772-2.318-.772H4.241l.154.154h12.051c.462 0 1.625-.077 2.318.618"></path><radialGradient id="a" cx="538.463" cy="539.28" r="528.383" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#fff" stop-opacity="0.1"></stop><stop offset="1" stop-color="#fff" stop-opacity="0"></stop></radialGradient><path opacity=".2" fill="url(#a)" d="m23.553 9.821-4.789-4.789-4.017-4.017c-.351-.352-1.082-.772-1.7-.772-.531 0-1.052.106-1.39.309L4.241 4.259.533 11.984c-.132.281-.309.769-.309 1.082 0 .674.297 1.365.772 1.854l3.702 3.675c.089.108.192.219.315.342l.154.154.464.464 4.017 4.017.154.154h9.733v-4.172h4.171V9.976z"></path></svg>lib\src\models.dart</div><div class="relative pt-3 pb-0 not-prose"><pre tabindex="0" class="prism-code language-dart bg-transparent !mt-0 !mb-0 m-0 px-0 pt-0 font-jetBrains-mono pb-3"><code class="font-[inherit] bg-transparent inline-block min-w-full"><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token string-literal string" style="color:#e3116c">'package:win32/win32.dart'</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">/// The result of an attempt to start a service.</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">enum</span><span class="token plain"> </span><span class="token class-name">ServiceStartResult</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">/// The attempt to start the service was denied due to insufficient</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">/// permissions.</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  accessDenied</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">/// The service is already running.</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  alreadyRunning</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">/// The attempt to start the service failed for an unspecified reason.</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  failed</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">/// The service was started successfully.</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  success</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">/// The attempt to start the service timed out.</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  timedOut</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">/// The various states a service can be in.</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">enum</span><span class="token plain"> </span><span class="token class-name">ServiceStatus</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">/// The service is not running.</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  stopped</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">/// The service is in the process of starting.</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  startPending</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">/// The service is in the process of stopping.</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  stopPending</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">/// The service is running.</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  running</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">/// The service is in the process of resuming from a paused state.</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  continuePending</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">/// The service is in the process of being paused.</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  pausePending</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">/// The service is paused.</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  paused</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">/// Converts an integer value to a corresponding [ServiceStatus] enum.</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">///</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">/// Throws an [ArgumentError] if the value does not correspond to a valid</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">/// value.</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token class-name">ServiceStatus</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">fromValue</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">int value</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">switch</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">value</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        SERVICE_STOPPED </span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token class-name">ServiceStatus</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">stopped</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        SERVICE_START_PENDING </span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token class-name">ServiceStatus</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">startPending</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        SERVICE_STOP_PENDING </span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token class-name">ServiceStatus</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">stopPending</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        SERVICE_RUNNING </span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token class-name">ServiceStatus</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">running</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        SERVICE_CONTINUE_PENDING </span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token class-name">ServiceStatus</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">continuePending</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        SERVICE_PAUSE_PENDING </span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token class-name">ServiceStatus</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">pausePending</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        SERVICE_PAUSED </span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token class-name">ServiceStatus</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">paused</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        _ </span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">throw</span><span class="token plain"> </span><span class="token class-name">ArgumentError</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-literal string" style="color:#e3116c">'Invalid value: </span><span class="token string-literal interpolation punctuation" style="color:#393A34">$</span><span class="token string-literal interpolation expression">value</span><span class="token string-literal string" style="color:#e3116c">'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">/// The result of an attempt to stop a service.</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">enum</span><span class="token plain"> </span><span class="token class-name">ServiceStopResult</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">/// The attempt to stop the service was denied due to insufficient</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">/// permissions.</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  accessDenied</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">/// The service is already stopped.</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  alreadyStopped</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">/// The attempt to stop the service failed for an unspecified reason.</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  failed</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">/// The service was stopped successfully.</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  success</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">/// The attempt to stop the service timed out.</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  timedOut</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">/// A Windows service with its name, display name, and current status.</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">Service</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token class-name">Service</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    required </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">displayName</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    required </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    required </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">status</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">/// The display name of the service.</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> </span><span class="token class-name">String</span><span class="token plain"> displayName</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">/// The name of the service.</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> </span><span class="token class-name">String</span><span class="token plain"> name</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">/// The current status of the service.</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> </span><span class="token class-name">ServiceStatus</span><span class="token plain"> status</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token metadata function" style="color:#d73a49">@override</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token class-name">String</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">toString</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token string-literal string" style="color:#e3116c">'Service(displayName: </span><span class="token string-literal interpolation punctuation" style="color:#393A34">$</span><span class="token string-literal interpolation expression">displayName</span><span class="token string-literal string" style="color:#e3116c">, name: </span><span class="token string-literal interpolation punctuation" style="color:#393A34">$</span><span class="token string-literal interpolation expression">name</span><span class="token string-literal string" style="color:#e3116c">, status: </span><span class="token string-literal interpolation punctuation" style="color:#393A34">$</span><span class="token string-literal interpolation expression">status</span><span class="token string-literal string" style="color:#e3116c">)'</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div><div class="absolute top-2 right-2 flex items-center gap-2"><button type="button" aria-label="Copy code to clipboard" title="Copy code to clipboard" class="w-6 h-6 flex justify-center items-center bg-gray-200 dark:bg-gray-800 hover:bg-gray-300 dark:hover:bg-win32-react-dark-code rounded group transition-[background-color] duration-200 ease-in-out"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" class="w-3 h-3 text-gray-500 dark:text-gray-400 transition-all duration-200 ease-in-out" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill="none" d="M0 0h24v24H0z"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></button></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="implementing-service-manager-logic">Implementing Service Manager Logic<a href="https://win32.pub/blog/building-service-manager-cli#implementing-service-manager-logic" class="hash-link" aria-label="Direct link to Implementing Service Manager Logic" title="Direct link to Implementing Service Manager Logic">​</a></h2>
<p>Next, we'll implement the core functionality for managing Windows services,
including enumerating services, starting and stopping services, and querying
service status.</p>
<p>Create a new file named <code>service_manager.dart</code> in the <code>lib\src</code> directory and
add the following code to set up the skeleton for managing Windows services:</p>
<div class="win32-common-code-block language-dart rounded-lg bg-win32-react-light-code dark:bg-win32-react-dark-code border border-gray-300 dark:border-0 mb-6 relative win32-wider-container"><div class="py-3 px-4 bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-100 text-xs flex items-center gap-2 rounded-tl-lg rounded-tr-lg"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"><path fill="#01579B" d="M5.013 18.936.996 14.92c-.476-.489-.772-1.18-.772-1.854 0-.312.176-.801.309-1.082l3.708-7.725z"></path><path fill="#40C4FF" d="m18.764 5.032-4.017-4.017c-.351-.352-1.082-.772-1.7-.772-.531 0-1.052.106-1.39.309L4.241 4.259zM9.803 23.726h9.733v-4.172l-7.261-2.317-6.644 2.317Z"></path><path fill="#29B6F6" d="M4.241 16.773c0 1.239.155 1.543.772 2.163l.618.618h13.905l-6.798-7.724-8.497-7.571z"></path><path fill="#01579B" d="M16.601 4.259H4.241l15.295 15.295h4.171V9.976l-4.943-4.944c-.694-.697-1.311-.772-2.163-.772"></path><path opacity=".2" fill="#FFF" d="M5.168 19.091c-.618-.62-.772-1.232-.772-2.318V4.414l-.154-.154v12.513c0 1.086 0 1.387.927 2.318l.464.464z"></path><path opacity=".2" fill="#263238" d="M23.553 9.821V19.4h-4.171l.154.154h4.172V9.976Z"></path><path opacity=".2" fill="#FFF" d="M18.764 5.032c-.766-.766-1.394-.772-2.318-.772H4.241l.154.154h12.051c.462 0 1.625-.077 2.318.618"></path><radialGradient id="a" cx="538.463" cy="539.28" r="528.383" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#fff" stop-opacity="0.1"></stop><stop offset="1" stop-color="#fff" stop-opacity="0"></stop></radialGradient><path opacity=".2" fill="url(#a)" d="m23.553 9.821-4.789-4.789-4.017-4.017c-.351-.352-1.082-.772-1.7-.772-.531 0-1.052.106-1.39.309L4.241 4.259.533 11.984c-.132.281-.309.769-.309 1.082 0 .674.297 1.365.772 1.854l3.702 3.675c.089.108.192.219.315.342l.154.154.464.464 4.017 4.017.154.154h9.733v-4.172h4.171V9.976z"></path></svg>lib\src\service_manager.dart</div><div class="relative pt-3 pb-0 not-prose"><pre tabindex="0" class="prism-code language-dart bg-transparent !mt-0 !mb-0 m-0 px-0 pt-0 font-jetBrains-mono pb-3"><code class="font-[inherit] bg-transparent inline-block min-w-full"><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token string-literal string" style="color:#e3116c">'dart:collection'</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token string-literal string" style="color:#e3116c">'dart:ffi'</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token string-literal string" style="color:#e3116c">'package:ffi/ffi.dart'</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token string-literal string" style="color:#e3116c">'package:win32/win32.dart'</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token string-literal string" style="color:#e3116c">'models.dart'</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">/// Provides functionality for managing Windows services, including:</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">/// - Enumerating available services</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">/// - Starting and stopping services</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">/// - Retrieving the current status of services</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">abstract</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">ServiceManager</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">/// Whether to log informative messages to the console.</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> bool log </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">/// Retrieves a set of all services (sorted by display name).</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token class-name">Set</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">Service</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">get</span><span class="token plain"> services </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// TODO: Implement this method</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">throw</span><span class="token plain"> </span><span class="token class-name">UnimplementedError</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">/// Starts a service defined by [serviceName].</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token class-name">ServiceStartResult</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">start</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">String</span><span class="token plain"> serviceName</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// TODO: Implement this method</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">throw</span><span class="token plain"> </span><span class="token class-name">UnimplementedError</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">/// Stops a service defined by [serviceName].</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token class-name">ServiceStopResult</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">stop</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">String</span><span class="token plain"> serviceName</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// TODO: Implement this method</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">throw</span><span class="token plain"> </span><span class="token class-name">UnimplementedError</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">/// Retrieves the status of a service defined by [serviceName].</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token class-name">ServiceStatus</span><span class="token operator" style="color:#393A34">?</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">status</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">String</span><span class="token plain"> serviceName</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// TODO: Implement this method</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">throw</span><span class="token plain"> </span><span class="token class-name">UnimplementedError</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">/// Logs a message to the console if [log] is `true`.</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">_log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">String</span><span class="token plain"> message</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">log</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">message</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div><div class="absolute top-2 right-2 flex items-center gap-2"><button type="button" aria-label="Copy code to clipboard" title="Copy code to clipboard" class="w-6 h-6 flex justify-center items-center bg-gray-200 dark:bg-gray-800 hover:bg-gray-300 dark:hover:bg-win32-react-dark-code rounded group transition-[background-color] duration-200 ease-in-out"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" class="w-3 h-3 text-gray-500 dark:text-gray-400 transition-all duration-200 ease-in-out" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill="none" d="M0 0h24v24H0z"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></button></div></div>
<p>With the skeleton in place, we can start implementing the service manager logic.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="enumerating-services">Enumerating Services<a href="https://win32.pub/blog/building-service-manager-cli#enumerating-services" class="hash-link" aria-label="Direct link to Enumerating Services" title="Direct link to Enumerating Services">​</a></h3>
<p>Now, let's implement the <code>services</code> getter to <strong>enumerate all services</strong> on the
system.</p>
<div class="win32-common-code-block language-dart rounded-lg bg-win32-react-light-code dark:bg-win32-react-dark-code border border-gray-300 dark:border-0 mb-6 relative win32-wider-container"><div class="py-3 px-4 bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-100 text-xs flex items-center gap-2 rounded-tl-lg rounded-tr-lg"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"><path fill="#01579B" d="M5.013 18.936.996 14.92c-.476-.489-.772-1.18-.772-1.854 0-.312.176-.801.309-1.082l3.708-7.725z"></path><path fill="#40C4FF" d="m18.764 5.032-4.017-4.017c-.351-.352-1.082-.772-1.7-.772-.531 0-1.052.106-1.39.309L4.241 4.259zM9.803 23.726h9.733v-4.172l-7.261-2.317-6.644 2.317Z"></path><path fill="#29B6F6" d="M4.241 16.773c0 1.239.155 1.543.772 2.163l.618.618h13.905l-6.798-7.724-8.497-7.571z"></path><path fill="#01579B" d="M16.601 4.259H4.241l15.295 15.295h4.171V9.976l-4.943-4.944c-.694-.697-1.311-.772-2.163-.772"></path><path opacity=".2" fill="#FFF" d="M5.168 19.091c-.618-.62-.772-1.232-.772-2.318V4.414l-.154-.154v12.513c0 1.086 0 1.387.927 2.318l.464.464z"></path><path opacity=".2" fill="#263238" d="M23.553 9.821V19.4h-4.171l.154.154h4.172V9.976Z"></path><path opacity=".2" fill="#FFF" d="M18.764 5.032c-.766-.766-1.394-.772-2.318-.772H4.241l.154.154h12.051c.462 0 1.625-.077 2.318.618"></path><radialGradient id="a" cx="538.463" cy="539.28" r="528.383" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#fff" stop-opacity="0.1"></stop><stop offset="1" stop-color="#fff" stop-opacity="0"></stop></radialGradient><path opacity=".2" fill="url(#a)" d="m23.553 9.821-4.789-4.789-4.017-4.017c-.351-.352-1.082-.772-1.7-.772-.531 0-1.052.106-1.39.309L4.241 4.259.533 11.984c-.132.281-.309.769-.309 1.082 0 .674.297 1.365.772 1.854l3.702 3.675c.089.108.192.219.315.342l.154.154.464.464 4.017 4.017.154.154h9.733v-4.172h4.171V9.976z"></path></svg>lib\src\service_manager.dart</div><div class="relative pt-3 pb-0 not-prose"><pre tabindex="0" class="prism-code language-dart bg-transparent !mt-0 !mb-0 m-0 px-0 pt-0 font-jetBrains-mono pb-3"><code class="font-[inherit] bg-transparent inline-block min-w-full"><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">/// Retrieves a set of all services (sorted by display name).</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token class-name">Set</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">Service</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">get</span><span class="token plain"> services </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> services </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token class-name">SplayTreeSet</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">Service</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">a</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> b</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> a</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">displayName</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">compareTo</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">b</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">displayName</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Get a handle to the SCM database.</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> scmHandle </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token class-name">OpenSCManager</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">nullptr</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> nullptr</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> SC_MANAGER_ENUMERATE_SERVICE</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">scmHandle </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> NULL</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> services</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">using</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">arena</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">try</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> bytesNeeded </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> arena</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics">DWORD</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> servicesReturned </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> arena</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics">DWORD</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> resumeHandle </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> arena</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics">DWORD</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token function" style="color:#d73a49">_log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-literal string" style="color:#e3116c">'Getting service list...'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">// First call to EnumServicesStatusEx to get the required buffer size.</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token class-name">EnumServicesStatusEx</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        scmHandle</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        SC_ENUM_PROCESS_INFO</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        SERVICE_WIN32</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        SERVICE_STATE_ALL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        nullptr</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        bytesNeeded</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        servicesReturned</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        resumeHandle</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        nullptr</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> buffer </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> arena</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics">BYTE</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">bytesNeeded</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">value</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">// Second call to EnumServicesStatusEx to get the actual data.</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">EnumServicesStatusEx</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">            scmHandle</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">            SC_ENUM_PROCESS_INFO</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">            SERVICE_WIN32</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">            SERVICE_STATE_ALL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">            buffer</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">            bytesNeeded</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">value</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">            bytesNeeded</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">            servicesReturned</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">            resumeHandle</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">            nullptr</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">          FALSE</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> enumBuffer </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> buffer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">cast</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics">ENUM_SERVICE_STATUS_PROCESS</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> servicesReturned</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">value</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i</span><span class="token operator" style="color:#393A34">++</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">          </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> serviceStatus </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">enumBuffer </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> i</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ref</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">          </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">ENUM_SERVICE_STATUS_PROCESS</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">lpServiceName</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">lpDisplayName</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">              serviceStatus</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">          </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> serviceName </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> lpServiceName</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">toDartString</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">          </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> displayName </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> lpDisplayName</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">toDartString</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">          </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> status </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">ServiceStatus</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">fromValue</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">            </span><span class="token class-name namespace" style="opacity:0.7">serviceStatus</span><span class="token class-name namespace punctuation" style="opacity:0.7;color:#393A34">.</span><span class="token class-name">ServiceStatusProcess</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">dwCurrentState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">          </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> service </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">Service</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">            displayName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> displayName</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">            name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> serviceName</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">            status</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> status</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">          services</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">service</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">finally</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token class-name">CloseServiceHandle</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">scmHandle</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> services</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div><div class="absolute top-2 right-2 flex items-center gap-2"><button type="button" aria-label="Copy code to clipboard" title="Copy code to clipboard" class="w-6 h-6 flex justify-center items-center bg-gray-200 dark:bg-gray-800 hover:bg-gray-300 dark:hover:bg-win32-react-dark-code rounded group transition-[background-color] duration-200 ease-in-out"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" class="w-3 h-3 text-gray-500 dark:text-gray-400 transition-all duration-200 ease-in-out" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill="none" d="M0 0h24v24H0z"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></button></div></div>
<p>We first obtain a handle to the Service Control Manager (SCM) database using
<a href="https://learn.microsoft.com/windows/win32/api/winsvc/nf-winsvc-openscmanagerw" target="_blank" rel="noopener noreferrer">OpenSCManager</a>, which allows us to interact with the SCM to query, start, stop,
and configure services. We then make an initial call to <a href="https://learn.microsoft.com/windows/win32/api/winsvc/nf-winsvc-enumservicesstatusexw" target="_blank" rel="noopener noreferrer">EnumServicesStatusEx</a>
to determine the required buffer size for storing the service information. With
the necessary buffer allocated, we make a second call to <code>EnumServicesStatusEx</code>
to retrieve the actual service data. Iterating through the services, we convert
them into <code>Service</code> objects and add them to a sorted set.</p>
<p>Throughout this process, we log informative messages to track progress and
errors. If we fail to open the SCM or enumerate services, we ensure appropriate
error handling and logging.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="starting-a-service">Starting a Service<a href="https://win32.pub/blog/building-service-manager-cli#starting-a-service" class="hash-link" aria-label="Direct link to Starting a Service" title="Direct link to Starting a Service">​</a></h3>
<p>Next, we’ll implement the <code>start</code> function to <strong>start a service</strong> with
<code>serviceName</code>.</p>
<div class="win32-common-code-block language-dart rounded-lg bg-win32-react-light-code dark:bg-win32-react-dark-code border border-gray-300 dark:border-0 mb-6 relative win32-wider-container"><div class="py-3 px-4 bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-100 text-xs flex items-center gap-2 rounded-tl-lg rounded-tr-lg"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"><path fill="#01579B" d="M5.013 18.936.996 14.92c-.476-.489-.772-1.18-.772-1.854 0-.312.176-.801.309-1.082l3.708-7.725z"></path><path fill="#40C4FF" d="m18.764 5.032-4.017-4.017c-.351-.352-1.082-.772-1.7-.772-.531 0-1.052.106-1.39.309L4.241 4.259zM9.803 23.726h9.733v-4.172l-7.261-2.317-6.644 2.317Z"></path><path fill="#29B6F6" d="M4.241 16.773c0 1.239.155 1.543.772 2.163l.618.618h13.905l-6.798-7.724-8.497-7.571z"></path><path fill="#01579B" d="M16.601 4.259H4.241l15.295 15.295h4.171V9.976l-4.943-4.944c-.694-.697-1.311-.772-2.163-.772"></path><path opacity=".2" fill="#FFF" d="M5.168 19.091c-.618-.62-.772-1.232-.772-2.318V4.414l-.154-.154v12.513c0 1.086 0 1.387.927 2.318l.464.464z"></path><path opacity=".2" fill="#263238" d="M23.553 9.821V19.4h-4.171l.154.154h4.172V9.976Z"></path><path opacity=".2" fill="#FFF" d="M18.764 5.032c-.766-.766-1.394-.772-2.318-.772H4.241l.154.154h12.051c.462 0 1.625-.077 2.318.618"></path><radialGradient id="a" cx="538.463" cy="539.28" r="528.383" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#fff" stop-opacity="0.1"></stop><stop offset="1" stop-color="#fff" stop-opacity="0"></stop></radialGradient><path opacity=".2" fill="url(#a)" d="m23.553 9.821-4.789-4.789-4.017-4.017c-.351-.352-1.082-.772-1.7-.772-.531 0-1.052.106-1.39.309L4.241 4.259.533 11.984c-.132.281-.309.769-.309 1.082 0 .674.297 1.365.772 1.854l3.702 3.675c.089.108.192.219.315.342l.154.154.464.464 4.017 4.017.154.154h9.733v-4.172h4.171V9.976z"></path></svg>lib\src\service_manager.dart</div><div class="relative pt-3 pb-0 not-prose"><pre tabindex="0" class="prism-code language-dart bg-transparent !mt-0 !mb-0 m-0 px-0 pt-0 font-jetBrains-mono pb-3"><code class="font-[inherit] bg-transparent inline-block min-w-full"><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">/// Starts a service defined by [serviceName].</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token class-name">ServiceStartResult</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">start</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">String</span><span class="token plain"> serviceName</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Get a handle to the SCM database.</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> scmHandle </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">OpenSCManager</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    nullptr</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// local computer</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    nullptr</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// ServicesActive database</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    SC_MANAGER_ALL_ACCESS</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// full access rights</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">scmHandle </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> NULL</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token class-name">ServiceStartResult</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">accessDenied</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">using</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">arena</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Get a handle to the service.</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> hService </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">OpenService</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      scmHandle</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      serviceName</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">toNativeUtf16</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">allocator</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> arena</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      SERVICE_ALL_ACCESS</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">hService </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> NULL</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token class-name">CloseServiceHandle</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">scmHandle</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token class-name">ServiceStartResult</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">failed</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> lpBuffer </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> arena</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics">SERVICE_STATUS_PROCESS</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> bytesNeeded </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> arena</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics">DWORD</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Check the status in case the service is not stopped.</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">QueryServiceStatusEx</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">          hService</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">          SC_STATUS_PROCESS_INFO</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">          lpBuffer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">cast</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">          sizeOf</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics">SERVICE_STATUS_PROCESS</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">          bytesNeeded</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        FALSE</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token class-name">CloseServiceHandle</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">hService</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token class-name">CloseServiceHandle</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">scmHandle</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token class-name">ServiceStartResult</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">failed</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> ssp </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> lpBuffer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ref</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Check if the service is already running. It would be possible to stop</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// the service here, but for simplicity this example just returns.</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ssp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">dwCurrentState </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> SERVICE_STOPPED </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        ssp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">dwCurrentState </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> SERVICE_STOP_PENDING</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token class-name">CloseServiceHandle</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">hService</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token class-name">CloseServiceHandle</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">scmHandle</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token class-name">ServiceStartResult</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">alreadyRunning</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Save the tick count and initial checkpoint.</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> startTickCount </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">GetTickCount</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> oldCheckPoint </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ssp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">dwCheckPoint</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// If a stop is pending, wait for it.</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">while</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ssp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">dwCurrentState </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> SERVICE_STOP_PENDING</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token function" style="color:#d73a49">_log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-literal string" style="color:#e3116c">'Service stop pending...'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">// Do not wait longer than the wait hint. A good interval is one-tenth</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">// of the wait hint but not less than 1 second and not more than 10</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">// seconds.</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> waitTime </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ssp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">dwWaitHint </span><span class="token operator" style="color:#393A34">~/</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      waitTime </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> waitTime </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1000</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">          </span><span class="token operator" style="color:#393A34">?</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1000</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> waitTime </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10000</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">              </span><span class="token operator" style="color:#393A34">?</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10000</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">              </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> waitTime</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token function" style="color:#d73a49">_log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-literal string" style="color:#e3116c">'Sleeping for </span><span class="token string-literal interpolation punctuation" style="color:#393A34">${</span><span class="token string-literal interpolation expression">ssp</span><span class="token string-literal interpolation expression punctuation" style="color:#393A34">.</span><span class="token string-literal interpolation expression">dwWaitHint</span><span class="token string-literal interpolation punctuation" style="color:#393A34">}</span><span class="token string-literal string" style="color:#e3116c"> ms...'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token class-name">Sleep</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">waitTime</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">// Check the status until the service is no longer stop pending.</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">QueryServiceStatusEx</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">            hService</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">            SC_STATUS_PROCESS_INFO</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">            lpBuffer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">cast</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">            sizeOf</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics">SERVICE_STATUS_PROCESS</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">            bytesNeeded</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">          FALSE</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">CloseServiceHandle</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">hService</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">CloseServiceHandle</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">scmHandle</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token class-name">ServiceStartResult</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">failed</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ssp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">dwCheckPoint </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> oldCheckPoint</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// Continue to wait and check.</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        startTickCount </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">GetTickCount</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        oldCheckPoint </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ssp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">dwCheckPoint</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">GetTickCount</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> startTickCount </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> ssp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">dwWaitHint</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">CloseServiceHandle</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">hService</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">CloseServiceHandle</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">scmHandle</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token class-name">ServiceStartResult</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">timedOut</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Attempt to start the service.</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">StartService</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">hService</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> nullptr</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> FALSE</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token class-name">CloseServiceHandle</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">hService</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token class-name">CloseServiceHandle</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">scmHandle</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token class-name">ServiceStartResult</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">failed</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token function" style="color:#d73a49">_log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-literal string" style="color:#e3116c">'Service start pending...'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Check the status until the service is no longer start pending.</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">QueryServiceStatusEx</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">          hService</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">          SC_STATUS_PROCESS_INFO</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">          lpBuffer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">cast</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">          sizeOf</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics">SERVICE_STATUS_PROCESS</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">          bytesNeeded</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        FALSE</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token class-name">CloseServiceHandle</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">hService</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token class-name">CloseServiceHandle</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">scmHandle</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token class-name">ServiceStartResult</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">failed</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Save the tick count and initial checkpoint.</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    startTickCount </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">GetTickCount</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    oldCheckPoint </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ssp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">dwCheckPoint</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">while</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ssp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">dwCurrentState </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> SERVICE_START_PENDING</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">// Do not wait longer than the wait hint. A good interval is one-tenth</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">// of the wait hint but not less than 1 second and not more than 10</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">// seconds.</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> waitTime </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ssp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">dwWaitHint </span><span class="token operator" style="color:#393A34">~/</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      waitTime </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> waitTime </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1000</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">          </span><span class="token operator" style="color:#393A34">?</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1000</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> waitTime </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10000</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">              </span><span class="token operator" style="color:#393A34">?</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10000</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">              </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> waitTime</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token function" style="color:#d73a49">_log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-literal string" style="color:#e3116c">'Sleeping for </span><span class="token string-literal interpolation punctuation" style="color:#393A34">${</span><span class="token string-literal interpolation expression">ssp</span><span class="token string-literal interpolation expression punctuation" style="color:#393A34">.</span><span class="token string-literal interpolation expression">dwWaitHint</span><span class="token string-literal interpolation punctuation" style="color:#393A34">}</span><span class="token string-literal string" style="color:#e3116c"> ms...'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token class-name">Sleep</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">waitTime</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">// Check the status again.</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">QueryServiceStatusEx</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">            hService</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">            SC_STATUS_PROCESS_INFO</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">            lpBuffer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">cast</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">            sizeOf</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics">SERVICE_STATUS_PROCESS</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">            bytesNeeded</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">          FALSE</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">break</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ssp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">dwCheckPoint </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> oldCheckPoint</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// Continue to wait and check.</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        startTickCount </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">GetTickCount</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        oldCheckPoint </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ssp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">dwCheckPoint</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">GetTickCount</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> startTickCount </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> ssp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">dwWaitHint</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// No progress made within the wait hint.</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">break</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Determine whether the service is running.</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> serviceRunning </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ssp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">dwCurrentState </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> SERVICE_RUNNING</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">CloseServiceHandle</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">hService</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">CloseServiceHandle</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">scmHandle</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> serviceRunning</span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        </span><span class="token operator" style="color:#393A34">?</span><span class="token plain"> </span><span class="token class-name">ServiceStartResult</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">success</span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">ServiceStartResult</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">failed</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div><div class="absolute top-2 right-2 flex items-center gap-2"><button type="button" aria-label="Copy code to clipboard" title="Copy code to clipboard" class="w-6 h-6 flex justify-center items-center bg-gray-200 dark:bg-gray-800 hover:bg-gray-300 dark:hover:bg-win32-react-dark-code rounded group transition-[background-color] duration-200 ease-in-out"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" class="w-3 h-3 text-gray-500 dark:text-gray-400 transition-all duration-200 ease-in-out" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill="none" d="M0 0h24v24H0z"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></button></div></div>
<p>We begin by obtaining a handle to the Service Control Manager (SCM) database
using <code>OpenSCManager</code> with full access rights. If this fails, we return an
<em>access denied</em> result. Next, we get a handle to the specific service using
<a href="https://learn.microsoft.com/windows/win32/api/winsvc/nf-winsvc-openservicew" target="_blank" rel="noopener noreferrer">OpenService</a>. If this fails, we close the SCM handle and return a <em>failure</em>
result.</p>
<p>We then check the service's status using <a href="https://learn.microsoft.com/windows/win32/api/winsvc/nf-winsvc-queryservicestatusex" target="_blank" rel="noopener noreferrer">QueryServiceStatusEx</a>. If the service
is not stopped, we return an <em>already running</em> result. If the service is
stopping, we wait for it to finish stopping, periodically checking its status
and updating our wait time based on the service's wait hint.</p>
<p>Once the service is stopped, we attempt to start it using <a href="https://learn.microsoft.com/windows/win32/api/winsvc/nf-winsvc-startservicew" target="_blank" rel="noopener noreferrer">StartService</a>. We
then check the service's status again, waiting for it to finish starting. If the
service starts successfully and transitions to the running state, we return a
<em>success</em> result; otherwise, we return a <em>failure</em> result.</p>
<p>Throughout this process, we log informative messages and ensure proper resource
management by closing all handles when done.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="stopping-a-service">Stopping a Service<a href="https://win32.pub/blog/building-service-manager-cli#stopping-a-service" class="hash-link" aria-label="Direct link to Stopping a Service" title="Direct link to Stopping a Service">​</a></h3>
<p>Next, we’ll implement the <code>stop</code> function to <strong>stop a service</strong> with
<code>serviceName</code>.</p>
<div class="win32-common-code-block language-dart rounded-lg bg-win32-react-light-code dark:bg-win32-react-dark-code border border-gray-300 dark:border-0 mb-6 relative win32-wider-container"><div class="py-3 px-4 bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-100 text-xs flex items-center gap-2 rounded-tl-lg rounded-tr-lg"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"><path fill="#01579B" d="M5.013 18.936.996 14.92c-.476-.489-.772-1.18-.772-1.854 0-.312.176-.801.309-1.082l3.708-7.725z"></path><path fill="#40C4FF" d="m18.764 5.032-4.017-4.017c-.351-.352-1.082-.772-1.7-.772-.531 0-1.052.106-1.39.309L4.241 4.259zM9.803 23.726h9.733v-4.172l-7.261-2.317-6.644 2.317Z"></path><path fill="#29B6F6" d="M4.241 16.773c0 1.239.155 1.543.772 2.163l.618.618h13.905l-6.798-7.724-8.497-7.571z"></path><path fill="#01579B" d="M16.601 4.259H4.241l15.295 15.295h4.171V9.976l-4.943-4.944c-.694-.697-1.311-.772-2.163-.772"></path><path opacity=".2" fill="#FFF" d="M5.168 19.091c-.618-.62-.772-1.232-.772-2.318V4.414l-.154-.154v12.513c0 1.086 0 1.387.927 2.318l.464.464z"></path><path opacity=".2" fill="#263238" d="M23.553 9.821V19.4h-4.171l.154.154h4.172V9.976Z"></path><path opacity=".2" fill="#FFF" d="M18.764 5.032c-.766-.766-1.394-.772-2.318-.772H4.241l.154.154h12.051c.462 0 1.625-.077 2.318.618"></path><radialGradient id="a" cx="538.463" cy="539.28" r="528.383" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#fff" stop-opacity="0.1"></stop><stop offset="1" stop-color="#fff" stop-opacity="0"></stop></radialGradient><path opacity=".2" fill="url(#a)" d="m23.553 9.821-4.789-4.789-4.017-4.017c-.351-.352-1.082-.772-1.7-.772-.531 0-1.052.106-1.39.309L4.241 4.259.533 11.984c-.132.281-.309.769-.309 1.082 0 .674.297 1.365.772 1.854l3.702 3.675c.089.108.192.219.315.342l.154.154.464.464 4.017 4.017.154.154h9.733v-4.172h4.171V9.976z"></path></svg>lib\src\service_manager.dart</div><div class="relative pt-3 pb-0 not-prose"><pre tabindex="0" class="prism-code language-dart bg-transparent !mt-0 !mb-0 m-0 px-0 pt-0 font-jetBrains-mono pb-3"><code class="font-[inherit] bg-transparent inline-block min-w-full"><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">/// Stops a service defined by [serviceName].</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token class-name">ServiceStopResult</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">stop</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">String</span><span class="token plain"> serviceName</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Get a handle to the SCM database.</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> scmHandle </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">OpenSCManager</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    nullptr</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// local computer</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    nullptr</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// ServicesActive database</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    SC_MANAGER_ALL_ACCESS</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// full access rights</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">scmHandle </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> NULL</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token class-name">ServiceStopResult</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">accessDenied</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">using</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">arena</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Get a handle to the service.</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> hService </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">OpenService</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      scmHandle</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      serviceName</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">toNativeUtf16</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">allocator</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> arena</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      SERVICE_STOP </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> SERVICE_QUERY_STATUS </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> SERVICE_ENUMERATE_DEPENDENTS</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">hService </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> NULL</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token class-name">CloseServiceHandle</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">scmHandle</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token class-name">ServiceStopResult</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">failed</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">try</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> lpBuffer </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> arena</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics">SERVICE_STATUS_PROCESS</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> bytesNeeded </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> arena</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics">DWORD</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">// Make sure the service is not already stopped.</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">QueryServiceStatusEx</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">            hService</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">            SC_STATUS_PROCESS_INFO</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">            lpBuffer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">cast</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">            sizeOf</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics">SERVICE_STATUS_PROCESS</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">            bytesNeeded</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">          FALSE</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token class-name">ServiceStopResult</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">failed</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> ssp </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> lpBuffer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ref</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ssp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">dwCurrentState </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> SERVICE_STOPPED</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token class-name">ServiceStopResult</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">alreadyStopped</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> startTime </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">GetTickCount</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> timeout </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">30000</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 30-second timeout</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">// If a stop is pending, wait for it.</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">while</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ssp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">dwCurrentState </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> SERVICE_STOP_PENDING</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">_log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-literal string" style="color:#e3116c">'Service stop pending...'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// Do not wait longer than the wait hint. A good interval is one-tenth</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// of the wait hint but not less than 1 second and not more than 10</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// seconds.</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> waitTime </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ssp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">dwWaitHint </span><span class="token operator" style="color:#393A34">~/</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        waitTime </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> waitTime </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1000</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">            </span><span class="token operator" style="color:#393A34">?</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1000</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> waitTime </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10000</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                </span><span class="token operator" style="color:#393A34">?</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10000</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> waitTime</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">_log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-literal string" style="color:#e3116c">'Sleeping for </span><span class="token string-literal interpolation punctuation" style="color:#393A34">${</span><span class="token string-literal interpolation expression">ssp</span><span class="token string-literal interpolation expression punctuation" style="color:#393A34">.</span><span class="token string-literal interpolation expression">dwWaitHint</span><span class="token string-literal interpolation punctuation" style="color:#393A34">}</span><span class="token string-literal string" style="color:#e3116c"> ms...'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">Sleep</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">waitTime</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">QueryServiceStatusEx</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">              hService</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">              SC_STATUS_PROCESS_INFO</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">              lpBuffer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">cast</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">              sizeOf</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics">SERVICE_STATUS_PROCESS</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">              bytesNeeded</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">            FALSE</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">          </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token class-name">ServiceStopResult</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">failed</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ssp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">dwCurrentState </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> SERVICE_STOPPED</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">          </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token class-name">ServiceStopResult</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">success</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">GetTickCount</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> startTime </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> timeout</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">          </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token class-name">ServiceStopResult</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">timedOut</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">// If the service is running, dependencies must be stopped first.</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> result </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">_stopDependentServices</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">hService</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> scmHandle</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">result</span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">          </span><span class="token keyword" style="color:#00009f">case</span><span class="token plain"> </span><span class="token class-name">ServiceStopResult</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">accessDenied </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">              </span><span class="token class-name">ServiceStopResult</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">failed </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">              </span><span class="token class-name">ServiceStopResult</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">timedOut</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> result</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">// Send a stop code to the service.</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">ControlService</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">            hService</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">            SERVICE_CONTROL_STOP</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">            lpBuffer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">cast</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics">SERVICE_STATUS</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">          FALSE</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token class-name">ServiceStopResult</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">failed</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">// Wait for the service to stop.</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token function" style="color:#d73a49">_log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-literal string" style="color:#e3116c">'Service stop pending...'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">while</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ssp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">dwCurrentState </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> SERVICE_STOPPED</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">_log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-literal string" style="color:#e3116c">'Sleeping for </span><span class="token string-literal interpolation punctuation" style="color:#393A34">${</span><span class="token string-literal interpolation expression">ssp</span><span class="token string-literal interpolation expression punctuation" style="color:#393A34">.</span><span class="token string-literal interpolation expression">dwWaitHint</span><span class="token string-literal interpolation punctuation" style="color:#393A34">}</span><span class="token string-literal string" style="color:#e3116c"> ms...'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">Sleep</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ssp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">dwWaitHint</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">QueryServiceStatusEx</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">              hService</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">              SC_STATUS_PROCESS_INFO</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">              lpBuffer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">cast</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">              sizeOf</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics">SERVICE_STATUS_PROCESS</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">              bytesNeeded</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">            FALSE</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">          </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token class-name">ServiceStopResult</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">failed</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ssp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">dwCurrentState </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> SERVICE_STOPPED</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">break</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">GetTickCount</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> startTime </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> timeout</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">          </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token class-name">ServiceStopResult</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">timedOut</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token class-name">ServiceStopResult</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">success</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">finally</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token class-name">CloseServiceHandle</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">hService</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token class-name">CloseServiceHandle</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">scmHandle</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">/// Stops dependent services of a service defined by [hService].</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token class-name">ServiceStopResult</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">_stopDependentServices</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  int hService</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  int scmHandle</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">using</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">arena</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> bytesNeeded </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> arena</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics">DWORD</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> servicesReturned </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> arena</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics">DWORD</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">_log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-literal string" style="color:#e3116c">'Checking for dependent services...'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Pass a zero-length buffer to get the required buffer size.</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">EnumDependentServices</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">          hService</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">          SERVICE_ACTIVE</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">          nullptr</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">          </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">          bytesNeeded</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">          servicesReturned</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        TRUE</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token function" style="color:#d73a49">_log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-literal string" style="color:#e3116c">'No dependent services found.'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">// Allocate a buffer for the dependencies.</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> lpServices </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">          arena</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics">BYTE</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">bytesNeeded</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">value</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">cast</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics">ENUM_SERVICE_STATUS</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">// Enumerate the dependencies.</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">EnumDependentServices</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">            hService</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">            SERVICE_ACTIVE</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">            lpServices</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">            bytesNeeded</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">value</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">            bytesNeeded</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">            servicesReturned</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">          FALSE</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token class-name">ServiceStopResult</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">failed</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token function" style="color:#d73a49">_log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-literal string" style="color:#e3116c">'Found </span><span class="token string-literal interpolation punctuation" style="color:#393A34">${</span><span class="token string-literal interpolation expression">servicesReturned</span><span class="token string-literal interpolation expression punctuation" style="color:#393A34">.</span><span class="token string-literal interpolation expression">value</span><span class="token string-literal interpolation punctuation" style="color:#393A34">}</span><span class="token string-literal string" style="color:#e3116c"> dependent services:'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> servicesReturned</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">value</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i</span><span class="token operator" style="color:#393A34">++</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> ess </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> lpServices</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">_log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-literal string" style="color:#e3116c">' (</span><span class="token string-literal interpolation punctuation" style="color:#393A34">${</span><span class="token string-literal interpolation expression">i </span><span class="token string-literal interpolation expression operator" style="color:#393A34">+</span><span class="token string-literal interpolation expression"> </span><span class="token string-literal interpolation expression number" style="color:#36acaa">1</span><span class="token string-literal interpolation punctuation" style="color:#393A34">}</span><span class="token string-literal string" style="color:#e3116c">/</span><span class="token string-literal interpolation punctuation" style="color:#393A34">${</span><span class="token string-literal interpolation expression">servicesReturned</span><span class="token string-literal interpolation expression punctuation" style="color:#393A34">.</span><span class="token string-literal interpolation expression">value</span><span class="token string-literal interpolation punctuation" style="color:#393A34">}</span><span class="token string-literal string" style="color:#e3116c">) Stopping '</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">            </span><span class="token string-literal string" style="color:#e3116c">'</span><span class="token string-literal interpolation punctuation" style="color:#393A34">${</span><span class="token string-literal interpolation expression">ess</span><span class="token string-literal interpolation expression punctuation" style="color:#393A34">.</span><span class="token string-literal interpolation expression">lpServiceName</span><span class="token string-literal interpolation expression punctuation" style="color:#393A34">.</span><span class="token string-literal interpolation expression function" style="color:#d73a49">toDartString</span><span class="token string-literal interpolation expression punctuation" style="color:#393A34">(</span><span class="token string-literal interpolation expression punctuation" style="color:#393A34">)</span><span class="token string-literal interpolation punctuation" style="color:#393A34">}</span><span class="token string-literal string" style="color:#e3116c">...'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// Open the service.</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> hDepService </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">OpenService</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">          scmHandle</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">          ess</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">lpServiceName</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">          SERVICE_STOP </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> SERVICE_QUERY_STATUS</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">hDepService </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> NULL</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token class-name">ServiceStopResult</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">failed</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">try</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">          </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> lpServiceStatus </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> arena</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics">SERVICE_STATUS_PROCESS</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">          </span><span class="token comment" style="color:#999988;font-style:italic">// Send a stop code.</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">          </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">ControlService</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                hDepService</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                SERVICE_CONTROL_STOP</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                lpServiceStatus</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">cast</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics">SERVICE_STATUS</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">              </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">              FALSE</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token class-name">ServiceStopResult</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">failed</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">          </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> startTime </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">GetTickCount</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">          </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> timeout </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">30000</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 30-second timeout</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">          </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> ssp </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> lpServiceStatus</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ref</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">          </span><span class="token comment" style="color:#999988;font-style:italic">// Wait for the service to stop.</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">          </span><span class="token keyword" style="color:#00009f">while</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ssp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">dwCurrentState </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> SERVICE_STOPPED</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">            </span><span class="token function" style="color:#d73a49">_log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-literal string" style="color:#e3116c">'Sleeping for </span><span class="token string-literal interpolation punctuation" style="color:#393A34">${</span><span class="token string-literal interpolation expression">ssp</span><span class="token string-literal interpolation expression punctuation" style="color:#393A34">.</span><span class="token string-literal interpolation expression">dwWaitHint</span><span class="token string-literal interpolation punctuation" style="color:#393A34">}</span><span class="token string-literal string" style="color:#e3116c"> ms...'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">            </span><span class="token class-name">Sleep</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ssp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">dwWaitHint</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">QueryServiceStatusEx</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                  hDepService</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                  SC_STATUS_PROCESS_INFO</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                  lpServiceStatus</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">cast</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                  sizeOf</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics">SERVICE_STATUS_PROCESS</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                  bytesNeeded</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">                FALSE</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">              </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token class-name">ServiceStopResult</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">failed</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ssp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">dwCurrentState </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> SERVICE_STOPPED</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">break</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">GetTickCount</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> startTime </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> timeout</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">              </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token class-name">ServiceStopResult</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">timedOut</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">finally</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">          </span><span class="token comment" style="color:#999988;font-style:italic">// Always release the service handle.</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">          </span><span class="token class-name">CloseServiceHandle</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">hDepService</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">_log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-literal string" style="color:#e3116c">'Dependent services stopped.'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token class-name">ServiceStopResult</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">success</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div><div class="absolute top-2 right-2 flex items-center gap-2"><button type="button" aria-label="Copy code to clipboard" title="Copy code to clipboard" class="w-6 h-6 flex justify-center items-center bg-gray-200 dark:bg-gray-800 hover:bg-gray-300 dark:hover:bg-win32-react-dark-code rounded group transition-[background-color] duration-200 ease-in-out"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" class="w-3 h-3 text-gray-500 dark:text-gray-400 transition-all duration-200 ease-in-out" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill="none" d="M0 0h24v24H0z"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></button></div></div>
<p>In the <code>stop</code> function, we first obtain a handle to the Service Control Manager
(SCM) database using <code>OpenSCManager</code> with full access rights. If this fails, we
return an <em>access denied</em> result. Next, we get a handle to the specific service
using <code>OpenService</code>, granting it stop, query status, and enumerate dependents
permissions. If this fails, we close the SCM handle and return a <em>failure</em>
result.</p>
<p>We then check the service's status using <code>QueryServiceStatusEx</code>. If the service
is already stopped, we return an <em>already stopped</em> result. If the service is
stopping, we wait for it to finish stopping, periodically checking its status
and updating our wait time based on the service's wait hint. Once the service is
no longer in the stop pending state, we attempt to stop any dependent services
first using the <code>_stopDependentServices</code> helper function.</p>
<p>After ensuring dependent services are stopped, we send a stop code to the
service using <a href="https://learn.microsoft.com/windows/win32/api/winsvc/nf-winsvc-controlservice" target="_blank" rel="noopener noreferrer">ControlService</a>. We then wait for the service to transition to
the stopped state, periodically checking its status. If the service stops
successfully, we return a <em>success</em> result; otherwise, we return a <em>failure</em> or
<em>timed out</em> result.</p>
<p>Throughout this process, we log informative messages and ensure proper resource
management by closing all handles when done. The <code>_stopDependentServices</code>
function enumerates and stops any active dependent services in a similar manner,
ensuring they are fully stopped before returning control to the main <code>stop</code>
function.</p>
<div class="rounded-lg admonition admonition-note mb-6 win32-wider-container bg-win32-react-light-green-bg dark:bg-win32-react-light-green dark:bg-opacity-[0.2] border-l-win32-react-light-green dark:border-l-win32-react-dark-green"><div class="border-l-4 border-l-solid border-l-inherit rounded-tl-lg rounded-bl-lg py-4 pr-4 pl-3 flex flex-col gap-2 sm:gap-4"><div class="flex items-center gap-2 text-xs sm:text-base 2xl:text-base 2xl:leading-7 font-semibold text-win32-react-light-green dark:text-win32-react-dark-green"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 20 20" aria-hidden="true" class="w-5 h-5" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M4.5 2A1.5 1.5 0 0 0 3 3.5v13A1.5 1.5 0 0 0 4.5 18h11a1.5 1.5 0 0 0 1.5-1.5V7.621a1.5 1.5 0 0 0-.44-1.06l-4.12-4.122A1.5 1.5 0 0 0 11.378 2H4.5Zm2.25 8.5a.75.75 0 0 0 0 1.5h6.5a.75.75 0 0 0 0-1.5h-6.5Zm0 3a.75.75 0 0 0 0 1.5h6.5a.75.75 0 0 0 0-1.5h-6.5Z" clip-rule="evenodd"></path></svg><span class="uppercase">NOTE</span></div><div class="text-gray-0 text-base last:mb-0"><p>The implementations for <code>start</code> and <code>stop</code> functions are based on the C++
examples provided in the <a href="https://learn.microsoft.com/windows/win32/services/starting-a-service" target="_blank" rel="noopener noreferrer">Microsoft documentation</a>.</p></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="querying-service-status">Querying Service Status<a href="https://win32.pub/blog/building-service-manager-cli#querying-service-status" class="hash-link" aria-label="Direct link to Querying Service Status" title="Direct link to Querying Service Status">​</a></h3>
<p>Finally, let's implement the <code>status</code> function to <strong>query service status</strong>.</p>
<div class="win32-common-code-block language-dart rounded-lg bg-win32-react-light-code dark:bg-win32-react-dark-code border border-gray-300 dark:border-0 mb-6 relative win32-wider-container"><div class="py-3 px-4 bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-100 text-xs flex items-center gap-2 rounded-tl-lg rounded-tr-lg"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"><path fill="#01579B" d="M5.013 18.936.996 14.92c-.476-.489-.772-1.18-.772-1.854 0-.312.176-.801.309-1.082l3.708-7.725z"></path><path fill="#40C4FF" d="m18.764 5.032-4.017-4.017c-.351-.352-1.082-.772-1.7-.772-.531 0-1.052.106-1.39.309L4.241 4.259zM9.803 23.726h9.733v-4.172l-7.261-2.317-6.644 2.317Z"></path><path fill="#29B6F6" d="M4.241 16.773c0 1.239.155 1.543.772 2.163l.618.618h13.905l-6.798-7.724-8.497-7.571z"></path><path fill="#01579B" d="M16.601 4.259H4.241l15.295 15.295h4.171V9.976l-4.943-4.944c-.694-.697-1.311-.772-2.163-.772"></path><path opacity=".2" fill="#FFF" d="M5.168 19.091c-.618-.62-.772-1.232-.772-2.318V4.414l-.154-.154v12.513c0 1.086 0 1.387.927 2.318l.464.464z"></path><path opacity=".2" fill="#263238" d="M23.553 9.821V19.4h-4.171l.154.154h4.172V9.976Z"></path><path opacity=".2" fill="#FFF" d="M18.764 5.032c-.766-.766-1.394-.772-2.318-.772H4.241l.154.154h12.051c.462 0 1.625-.077 2.318.618"></path><radialGradient id="a" cx="538.463" cy="539.28" r="528.383" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#fff" stop-opacity="0.1"></stop><stop offset="1" stop-color="#fff" stop-opacity="0"></stop></radialGradient><path opacity=".2" fill="url(#a)" d="m23.553 9.821-4.789-4.789-4.017-4.017c-.351-.352-1.082-.772-1.7-.772-.531 0-1.052.106-1.39.309L4.241 4.259.533 11.984c-.132.281-.309.769-.309 1.082 0 .674.297 1.365.772 1.854l3.702 3.675c.089.108.192.219.315.342l.154.154.464.464 4.017 4.017.154.154h9.733v-4.172h4.171V9.976z"></path></svg>lib\src\service_manager.dart</div><div class="relative pt-3 pb-0 not-prose"><pre tabindex="0" class="prism-code language-dart bg-transparent !mt-0 !mb-0 m-0 px-0 pt-0 font-jetBrains-mono pb-3"><code class="font-[inherit] bg-transparent inline-block min-w-full"><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">/// Retrieves the status of a service defined by [serviceName].</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token class-name">ServiceStatus</span><span class="token operator" style="color:#393A34">?</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">status</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">String</span><span class="token plain"> serviceName</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Get a handle to the SCM database.</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> scmHandle </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">OpenSCManager</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">nullptr</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> nullptr</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> SC_MANAGER_CONNECT</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">scmHandle </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> NULL</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">using</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">arena</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Get a handle to the service.</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> hService </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">OpenService</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      scmHandle</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      serviceName</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">toNativeUtf16</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">allocator</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> arena</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      SERVICE_QUERY_STATUS</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">hService </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> NULL</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token class-name">CloseServiceHandle</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">scmHandle</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">try</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> lpBuffer </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> arena</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics">SERVICE_STATUS_PROCESS</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> bytesNeeded </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> arena</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics">DWORD</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">// Query the service status.</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">QueryServiceStatusEx</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">            hService</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">            SC_STATUS_PROCESS_INFO</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">            lpBuffer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">cast</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">            sizeOf</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics">SERVICE_STATUS_PROCESS</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">            bytesNeeded</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">          FALSE</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token class-name">ServiceStatus</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">fromValue</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">lpBuffer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ref</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">dwCurrentState</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">finally</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token class-name">CloseServiceHandle</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">hService</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token class-name">CloseServiceHandle</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">scmHandle</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div><div class="absolute top-2 right-2 flex items-center gap-2"><button type="button" aria-label="Copy code to clipboard" title="Copy code to clipboard" class="w-6 h-6 flex justify-center items-center bg-gray-200 dark:bg-gray-800 hover:bg-gray-300 dark:hover:bg-win32-react-dark-code rounded group transition-[background-color] duration-200 ease-in-out"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" class="w-3 h-3 text-gray-500 dark:text-gray-400 transition-all duration-200 ease-in-out" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill="none" d="M0 0h24v24H0z"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></button></div></div>
<p>We first obtain a handle to the Service Control Manager (SCM) database using
<code>OpenSCManager</code> with connect permissions. If this fails, we return <code>null</code>. Next,
we get a handle to the specific service using <code>OpenService</code>, granting it query
status permissions. If this fails, we close the SCM handle and return <code>null</code>.</p>
<p>Using the <code>QueryServiceStatusEx</code> function, we query the service's status. We
allocate the necessary buffer to store the status information. If the query is
<em>unsuccessful</em>, we return <code>null</code>. If the query <em>succeeds</em>, we retrieve the
service's current state and convert it into a <code>ServiceStatus</code> object using
<code>ServiceStatus.fromValue</code>.</p>
<p>Throughout this process, we log informative messages and ensure proper resource
management by closing all handles when done. This ensures that the function
correctly retrieves the status of a specified service, returning the appropriate
status or <code>null</code> if any step fails.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="building-the-cli">Building the CLI<a href="https://win32.pub/blog/building-service-manager-cli#building-the-cli" class="hash-link" aria-label="Direct link to Building the CLI" title="Direct link to Building the CLI">​</a></h2>
<p>Now that we have implemented the functions to interact with Windows services,
let's create a CLI tool to manage services directly from the command line.</p>
<p>First, update the <strong>lib\service_manager_cli.dart</strong> file to export the models and
service manager implementation:</p>
<div class="win32-common-code-block language-dart rounded-lg bg-win32-react-light-code dark:bg-win32-react-dark-code border border-gray-300 dark:border-0 mb-6 relative win32-wider-container"><div class="py-3 px-4 bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-100 text-xs flex items-center gap-2 rounded-tl-lg rounded-tr-lg"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"><path fill="#01579B" d="M5.013 18.936.996 14.92c-.476-.489-.772-1.18-.772-1.854 0-.312.176-.801.309-1.082l3.708-7.725z"></path><path fill="#40C4FF" d="m18.764 5.032-4.017-4.017c-.351-.352-1.082-.772-1.7-.772-.531 0-1.052.106-1.39.309L4.241 4.259zM9.803 23.726h9.733v-4.172l-7.261-2.317-6.644 2.317Z"></path><path fill="#29B6F6" d="M4.241 16.773c0 1.239.155 1.543.772 2.163l.618.618h13.905l-6.798-7.724-8.497-7.571z"></path><path fill="#01579B" d="M16.601 4.259H4.241l15.295 15.295h4.171V9.976l-4.943-4.944c-.694-.697-1.311-.772-2.163-.772"></path><path opacity=".2" fill="#FFF" d="M5.168 19.091c-.618-.62-.772-1.232-.772-2.318V4.414l-.154-.154v12.513c0 1.086 0 1.387.927 2.318l.464.464z"></path><path opacity=".2" fill="#263238" d="M23.553 9.821V19.4h-4.171l.154.154h4.172V9.976Z"></path><path opacity=".2" fill="#FFF" d="M18.764 5.032c-.766-.766-1.394-.772-2.318-.772H4.241l.154.154h12.051c.462 0 1.625-.077 2.318.618"></path><radialGradient id="a" cx="538.463" cy="539.28" r="528.383" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#fff" stop-opacity="0.1"></stop><stop offset="1" stop-color="#fff" stop-opacity="0"></stop></radialGradient><path opacity=".2" fill="url(#a)" d="m23.553 9.821-4.789-4.789-4.017-4.017c-.351-.352-1.082-.772-1.7-.772-.531 0-1.052.106-1.39.309L4.241 4.259.533 11.984c-.132.281-.309.769-.309 1.082 0 .674.297 1.365.772 1.854l3.702 3.675c.089.108.192.219.315.342l.154.154.464.464 4.017 4.017.154.154h9.733v-4.172h4.171V9.976z"></path></svg>lib\service_manager_cli.dart</div><div class="relative pt-3 pb-0 not-prose"><pre tabindex="0" class="prism-code language-dart bg-transparent !mt-0 !mb-0 m-0 px-0 pt-0 font-jetBrains-mono pb-3"><code class="font-[inherit] bg-transparent inline-block min-w-full"><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token keyword" style="color:#00009f">library</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token string-literal string" style="color:#e3116c">'src/models.dart'</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token string-literal string" style="color:#e3116c">'src/service_manager.dart'</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div><div class="absolute top-2 right-2 flex items-center gap-2"><button type="button" aria-label="Copy code to clipboard" title="Copy code to clipboard" class="w-6 h-6 flex justify-center items-center bg-gray-200 dark:bg-gray-800 hover:bg-gray-300 dark:hover:bg-win32-react-dark-code rounded group transition-[background-color] duration-200 ease-in-out"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" class="w-3 h-3 text-gray-500 dark:text-gray-400 transition-all duration-200 ease-in-out" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill="none" d="M0 0h24v24H0z"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></button></div></div>
<p>Next, replace the existing code in <strong>bin\service_manager_cli.dart</strong> with the
following implementation for the CLI:</p>
<div class="win32-common-code-block language-dart rounded-lg bg-win32-react-light-code dark:bg-win32-react-dark-code border border-gray-300 dark:border-0 mb-6 relative win32-wider-container"><div class="py-3 px-4 bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-100 text-xs flex items-center gap-2 rounded-tl-lg rounded-tr-lg"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"><path fill="#01579B" d="M5.013 18.936.996 14.92c-.476-.489-.772-1.18-.772-1.854 0-.312.176-.801.309-1.082l3.708-7.725z"></path><path fill="#40C4FF" d="m18.764 5.032-4.017-4.017c-.351-.352-1.082-.772-1.7-.772-.531 0-1.052.106-1.39.309L4.241 4.259zM9.803 23.726h9.733v-4.172l-7.261-2.317-6.644 2.317Z"></path><path fill="#29B6F6" d="M4.241 16.773c0 1.239.155 1.543.772 2.163l.618.618h13.905l-6.798-7.724-8.497-7.571z"></path><path fill="#01579B" d="M16.601 4.259H4.241l15.295 15.295h4.171V9.976l-4.943-4.944c-.694-.697-1.311-.772-2.163-.772"></path><path opacity=".2" fill="#FFF" d="M5.168 19.091c-.618-.62-.772-1.232-.772-2.318V4.414l-.154-.154v12.513c0 1.086 0 1.387.927 2.318l.464.464z"></path><path opacity=".2" fill="#263238" d="M23.553 9.821V19.4h-4.171l.154.154h4.172V9.976Z"></path><path opacity=".2" fill="#FFF" d="M18.764 5.032c-.766-.766-1.394-.772-2.318-.772H4.241l.154.154h12.051c.462 0 1.625-.077 2.318.618"></path><radialGradient id="a" cx="538.463" cy="539.28" r="528.383" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#fff" stop-opacity="0.1"></stop><stop offset="1" stop-color="#fff" stop-opacity="0"></stop></radialGradient><path opacity=".2" fill="url(#a)" d="m23.553 9.821-4.789-4.789-4.017-4.017c-.351-.352-1.082-.772-1.7-.772-.531 0-1.052.106-1.39.309L4.241 4.259.533 11.984c-.132.281-.309.769-.309 1.082 0 .674.297 1.365.772 1.854l3.702 3.675c.089.108.192.219.315.342l.154.154.464.464 4.017 4.017.154.154h9.733v-4.172h4.171V9.976z"></path></svg>bin\service_manager_cli.dart</div><div class="relative pt-3 pb-0 not-prose"><pre tabindex="0" class="prism-code language-dart bg-transparent !mt-0 !mb-0 m-0 px-0 pt-0 font-jetBrains-mono pb-3"><code class="font-[inherit] bg-transparent inline-block min-w-full"><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token string-literal string" style="color:#e3116c">'dart:io'</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token string-literal string" style="color:#e3116c">'package:service_manager_cli/service_manager_cli.dart'</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">main</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">List</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">String</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> arguments</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">arguments</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">isEmpty </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      arguments</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">contains</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-literal string" style="color:#e3116c">'-h'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      arguments</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">contains</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-literal string" style="color:#e3116c">'--help'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">printUsage</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  bool verbose </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">arguments</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">contains</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-literal string" style="color:#e3116c">'-v'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> arguments</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">contains</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-literal string" style="color:#e3116c">'--verbose'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    verbose </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    arguments </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> arguments</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">where</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">arg</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> arg </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token string-literal string" style="color:#e3116c">'-v'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">toList</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token class-name">ServiceManager</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">log </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> verbose</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> command </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> arguments</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> serviceName </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> arguments</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">length </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">?</span><span class="token plain"> arguments</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">switch</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">command</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">case</span><span class="token plain"> </span><span class="token string-literal string" style="color:#e3116c">'list'</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token function" style="color:#d73a49">listServices</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">break</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">case</span><span class="token plain"> </span><span class="token string-literal string" style="color:#e3116c">'start'</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">serviceName </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-literal string" style="color:#e3116c">'Please provide the service name to start.'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">exit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token function" style="color:#d73a49">startService</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">serviceName</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">break</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">case</span><span class="token plain"> </span><span class="token string-literal string" style="color:#e3116c">'status'</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">serviceName </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-literal string" style="color:#e3116c">'Please provide a service name to get status.'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">exit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token function" style="color:#d73a49">status</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">serviceName</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">break</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">case</span><span class="token plain"> </span><span class="token string-literal string" style="color:#e3116c">'stop'</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">serviceName </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-literal string" style="color:#e3116c">'Please provide the service name to stop.'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">exit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token function" style="color:#d73a49">stopService</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">serviceName</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">break</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">default</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token function" style="color:#d73a49">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-literal string" style="color:#e3116c">'Unknown command: </span><span class="token string-literal interpolation punctuation" style="color:#393A34">$</span><span class="token string-literal interpolation expression">command</span><span class="token string-literal string" style="color:#e3116c">'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token function" style="color:#d73a49">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-literal string" style="color:#e3116c">''</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token function" style="color:#d73a49">printUsage</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token function" style="color:#d73a49">exit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">printUsage</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-literal string" style="color:#e3116c">'A command-line interface for managing Windows services.'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-literal string" style="color:#e3116c">''</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-literal string" style="color:#e3116c">'Usage: service_manager_cli &lt;command&gt; [arguments]'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-literal string" style="color:#e3116c">''</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-literal string" style="color:#e3116c">'Global options:'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-literal string" style="color:#e3116c">'  -v, --verbose         Show additional command output.'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-literal string" style="color:#e3116c">'  -h, --help            Print this usage information.'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-literal string" style="color:#e3116c">''</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-literal string" style="color:#e3116c">'Available commands:'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-literal string" style="color:#e3116c">'  list                  List all services.'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-literal string" style="color:#e3116c">'  start &lt;service_name&gt;  Start a service.'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-literal string" style="color:#e3116c">'  status &lt;service_name&gt; Get the status of a service.'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-literal string" style="color:#e3116c">'  stop &lt;service_name&gt;   Stop a service.'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">listServices</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> services </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">ServiceManager</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">services</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">services</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">isEmpty</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-literal string" style="color:#e3116c">'Failed to get services.'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-literal string" style="color:#e3116c">'Found </span><span class="token string-literal interpolation punctuation" style="color:#393A34">${</span><span class="token string-literal interpolation expression">services</span><span class="token string-literal interpolation expression punctuation" style="color:#393A34">.</span><span class="token string-literal interpolation expression">length</span><span class="token string-literal interpolation punctuation" style="color:#393A34">}</span><span class="token string-literal string" style="color:#e3116c"> services:'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> service </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> services</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-literal string" style="color:#e3116c">' </span><span class="token string-literal interpolation punctuation" style="color:#393A34">$</span><span class="token string-literal interpolation expression">service</span><span class="token string-literal string" style="color:#e3116c">'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">startService</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">String</span><span class="token plain"> serviceName</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">switch</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">ServiceManager</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">start</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">serviceName</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">ServiceStartResult</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">success </span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token string-literal string" style="color:#e3116c">'Service "</span><span class="token string-literal interpolation punctuation" style="color:#393A34">$</span><span class="token string-literal interpolation expression">serviceName</span><span class="token string-literal string" style="color:#e3116c">" started successfully.'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">ServiceStartResult</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">accessDenied </span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token string-literal string" style="color:#e3116c">'The attempt to start the service "</span><span class="token string-literal interpolation punctuation" style="color:#393A34">$</span><span class="token string-literal interpolation expression">serviceName</span><span class="token string-literal string" style="color:#e3116c">" was denied due to '</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">          </span><span class="token string-literal string" style="color:#e3116c">'insufficient permissions.'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">ServiceStartResult</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">alreadyRunning </span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token string-literal string" style="color:#e3116c">'Service "</span><span class="token string-literal interpolation punctuation" style="color:#393A34">$</span><span class="token string-literal interpolation expression">serviceName</span><span class="token string-literal string" style="color:#e3116c">" is already running.'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">ServiceStartResult</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">failed </span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token string-literal string" style="color:#e3116c">'Failed to start service "</span><span class="token string-literal interpolation punctuation" style="color:#393A34">$</span><span class="token string-literal interpolation expression">serviceName</span><span class="token string-literal string" style="color:#e3116c">".'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">ServiceStartResult</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">timedOut </span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token string-literal string" style="color:#e3116c">'The attempt to start service "</span><span class="token string-literal interpolation punctuation" style="color:#393A34">$</span><span class="token string-literal interpolation expression">serviceName</span><span class="token string-literal string" style="color:#e3116c">" timed out.'</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">status</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">String</span><span class="token plain"> serviceName</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> status </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">ServiceManager</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">status</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">serviceName</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">status </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-literal string" style="color:#e3116c">'Failed to get status of service "</span><span class="token string-literal interpolation punctuation" style="color:#393A34">$</span><span class="token string-literal interpolation expression">serviceName</span><span class="token string-literal string" style="color:#e3116c">".'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-literal string" style="color:#e3116c">'Status of service "</span><span class="token string-literal interpolation punctuation" style="color:#393A34">$</span><span class="token string-literal interpolation expression">serviceName</span><span class="token string-literal string" style="color:#e3116c">": </span><span class="token string-literal interpolation punctuation" style="color:#393A34">${</span><span class="token string-literal interpolation expression">status</span><span class="token string-literal interpolation expression punctuation" style="color:#393A34">.</span><span class="token string-literal interpolation expression">name</span><span class="token string-literal interpolation punctuation" style="color:#393A34">}</span><span class="token string-literal string" style="color:#e3116c">'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">stopService</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">String</span><span class="token plain"> serviceName</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">switch</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">ServiceManager</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">stop</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">serviceName</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">ServiceStopResult</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">success </span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token string-literal string" style="color:#e3116c">'Service "</span><span class="token string-literal interpolation punctuation" style="color:#393A34">$</span><span class="token string-literal interpolation expression">serviceName</span><span class="token string-literal string" style="color:#e3116c">" stopped successfully.'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">ServiceStopResult</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">accessDenied </span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token string-literal string" style="color:#e3116c">'The attempt to stop the service "</span><span class="token string-literal interpolation punctuation" style="color:#393A34">$</span><span class="token string-literal interpolation expression">serviceName</span><span class="token string-literal string" style="color:#e3116c">" was denied due to '</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">          </span><span class="token string-literal string" style="color:#e3116c">'insufficient permissions.'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">ServiceStopResult</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">alreadyStopped </span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token string-literal string" style="color:#e3116c">'Service "</span><span class="token string-literal interpolation punctuation" style="color:#393A34">$</span><span class="token string-literal interpolation expression">serviceName</span><span class="token string-literal string" style="color:#e3116c">" is already stopped.'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">ServiceStopResult</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">failed </span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token string-literal string" style="color:#e3116c">'Failed to stop service "</span><span class="token string-literal interpolation punctuation" style="color:#393A34">$</span><span class="token string-literal interpolation expression">serviceName</span><span class="token string-literal string" style="color:#e3116c">".'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">ServiceStopResult</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">timedOut </span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token string-literal string" style="color:#e3116c">'The attempt to stop service "</span><span class="token string-literal interpolation punctuation" style="color:#393A34">$</span><span class="token string-literal interpolation expression">serviceName</span><span class="token string-literal string" style="color:#e3116c">" timed out.'</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div><div class="absolute top-2 right-2 flex items-center gap-2"><button type="button" aria-label="Copy code to clipboard" title="Copy code to clipboard" class="w-6 h-6 flex justify-center items-center bg-gray-200 dark:bg-gray-800 hover:bg-gray-300 dark:hover:bg-win32-react-dark-code rounded group transition-[background-color] duration-200 ease-in-out"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" class="w-3 h-3 text-gray-500 dark:text-gray-400 transition-all duration-200 ease-in-out" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill="none" d="M0 0h24v24H0z"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></button></div></div>
<p>Finally, update the <strong>pubspec.yaml</strong> file to include the <code>executables</code> section
and specify the entry point for the CLI:</p>
<div class="win32-common-code-block language-yaml rounded-lg bg-win32-react-light-code dark:bg-win32-react-dark-code border border-gray-300 dark:border-0 mb-6 relative win32-wider-container"><div class="py-3 px-4 bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-100 text-xs flex items-center gap-2 rounded-tl-lg rounded-tr-lg"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" height="20" width="20" xmlns="http://www.w3.org/2000/svg"><path fill="none" stroke-linejoin="round" stroke-width="32" d="M416 221.25V416a48 48 0 0 1-48 48H144a48 48 0 0 1-48-48V96a48 48 0 0 1 48-48h98.75a32 32 0 0 1 22.62 9.37l141.26 141.26a32 32 0 0 1 9.37 22.62z"></path><path fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-width="32" d="M256 56v120a32 32 0 0 0 32 32h120m-232 80h160m-160 80h160"></path></svg>pubspec.yaml</div><div class="relative pt-3 pb-0 not-prose"><pre tabindex="0" class="prism-code language-yaml bg-transparent !mt-0 !mb-0 m-0 px-0 pt-0 font-jetBrains-mono pb-3"><code class="font-[inherit] bg-transparent inline-block min-w-full"><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> service_manager_cli</span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">description</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Service Manager CLI</span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">publish_to</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> none</span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">environment</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">sdk</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ^3.8.0</span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">dependencies</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">ffi</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ^2.1.4</span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">win32</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ^5.13.0</span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">dev_dependencies</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">halildurmus_lints</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ^1.0.1</span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line theme-code-block-highlighted-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">executables</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  service_manager_cli</span><span class="token punctuation" style="color:#393A34">:</span><br></span></code></pre></div><div class="absolute top-2 right-2 flex items-center gap-2"><button type="button" aria-label="Copy code to clipboard" title="Copy code to clipboard" class="w-6 h-6 flex justify-center items-center bg-gray-200 dark:bg-gray-800 hover:bg-gray-300 dark:hover:bg-win32-react-dark-code rounded group transition-[background-color] duration-200 ease-in-out"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" class="w-3 h-3 text-gray-500 dark:text-gray-400 transition-all duration-200 ease-in-out" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill="none" d="M0 0h24v24H0z"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></button></div></div>
<p>You now have a powerful CLI tool for efficiently managing Windows services.
To use it, run the following command in your terminal:</p>
<div class="win32-common-code-block language-cmd rounded-lg bg-win32-react-light-code dark:bg-win32-react-dark-code border border-gray-300 dark:border-0 mb-6 relative win32-wider-container"><div class="py-3 px-4 bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-100 text-xs flex items-center gap-2 rounded-tl-lg rounded-tr-lg"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" height="20" width="20" xmlns="http://www.w3.org/2000/svg"><path fill="none" stroke-linejoin="round" stroke-width="32" d="M416 221.25V416a48 48 0 0 1-48 48H144a48 48 0 0 1-48-48V96a48 48 0 0 1 48-48h98.75a32 32 0 0 1 22.62 9.37l141.26 141.26a32 32 0 0 1 9.37 22.62z"></path><path fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-width="32" d="M256 56v120a32 32 0 0 0 32 32h120m-232 80h160m-160 80h160"></path></svg>Terminal</div><div class="relative pt-3 pb-0 not-prose"><pre tabindex="0" class="prism-code language-cmd bg-transparent !mt-0 !mb-0 m-0 px-0 pt-0 font-jetBrains-mono pb-3"><code class="font-[inherit] bg-transparent inline-block min-w-full"><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">dart run service_manager_cli</span><br></span></code></pre></div><div class="absolute top-2 right-2 flex items-center gap-2"><button type="button" aria-label="Copy code to clipboard" title="Copy code to clipboard" class="w-6 h-6 flex justify-center items-center bg-gray-200 dark:bg-gray-800 hover:bg-gray-300 dark:hover:bg-win32-react-dark-code rounded group transition-[background-color] duration-200 ease-in-out"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" class="w-3 h-3 text-gray-500 dark:text-gray-400 transition-all duration-200 ease-in-out" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill="none" d="M0 0h24v24H0z"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></button></div></div>
<p>This command provides information about available commands, global options, and
usage:</p>
<div class="win32-common-code-block language-text rounded-lg bg-win32-react-light-code dark:bg-win32-react-dark-code border border-gray-300 dark:border-0 mb-6 relative win32-wider-container"><div class="relative pt-3 pb-0 not-prose"><pre tabindex="0" class="prism-code language-text bg-transparent !mt-0 !mb-0 m-0 px-0 pt-0 font-jetBrains-mono pb-3"><code class="font-[inherit] bg-transparent inline-block min-w-full"><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">A command-line interface for managing Windows services.</span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">Usage: service_manager_cli &lt;command&gt; [arguments]</span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">Global options:</span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  -v, --verbose         Show additional command output.</span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  -h, --help            Print this usage information.</span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">q</span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">Available commands:</span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  list                  List all services.</span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  start &lt;service_name&gt;  Start a service.</span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  status &lt;service_name&gt; Get the status of a service.</span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  stop &lt;service_name&gt;   Stop a service.</span><br></span></code></pre></div><div class="absolute top-3 right-3 flex items-center gap-2"><button type="button" aria-label="Copy code to clipboard" title="Copy code to clipboard" class="w-6 h-6 flex justify-center items-center bg-gray-200 dark:bg-gray-800 hover:bg-gray-300 dark:hover:bg-win32-react-dark-code rounded group transition-[background-color] duration-200 ease-in-out"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" class="w-3 h-3 text-gray-500 dark:text-gray-400 transition-all duration-200 ease-in-out" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill="none" d="M0 0h24v24H0z"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></button></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="conclusion">Conclusion<a href="https://win32.pub/blog/building-service-manager-cli#conclusion" class="hash-link" aria-label="Direct link to Conclusion" title="Direct link to Conclusion">​</a></h2>
<p>In this blog post, we've explored how to build a command-line interface (CLI) in
Dart using the <strong>win32</strong> package to manage Windows services. From listing and
controlling services to checking their status, we've covered essential tasks
that streamline Windows service administration directly from your command line.</p>
<p>I hope you found this tutorial helpful! If you have any questions or feedback,
please feel free to reach out. Happy coding! 🚀</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="source-code">Source Code<a href="https://win32.pub/blog/building-service-manager-cli#source-code" class="hash-link" aria-label="Direct link to Source Code" title="Direct link to Source Code">​</a></h2>
<div class="win32-wider-container py-2 px-2 flex items-center gap-2 rounded-lg font-sans text-base bg-gray-100 dark:bg-gray-700 mb-6"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 496 512" class="ml-1.5 w-6 h-6 text-gray-700 dark:text-gray-100" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg><a href="https://github.com/halildurmus/win32/tree/main/examples/service_manager_cli" target="_blank" rel="noopener noreferrer" class="text-base leading-8 text-win32-react-light-link dark:text-win32-react-dark-link"><span>View Source Code</span></a></div>]]></content>
        <author>
            <name>Halil Durmus</name>
            <uri>https://halildurmus.dev</uri>
        </author>
        <category label="win32" term="win32"/>
        <category label="dart" term="dart"/>
        <category label="tutorial" term="tutorial"/>
        <category label="cli" term="cli"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Calling Windows APIs in Dart with win32]]></title>
        <id>https://win32.pub/blog/calling-windows-apis</id>
        <link href="https://win32.pub/blog/calling-windows-apis"/>
        <updated>2024-07-10T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Learn how to call Windows APIs in Dart with the win32 package. Start with simple examples and explore its wide range of applications.]]></summary>
        <content type="html"><![CDATA[<h2 class="anchor anchorWithStickyNavbar_LWe7" id="introduction">Introduction<a href="https://win32.pub/blog/calling-windows-apis#introduction" class="hash-link" aria-label="Direct link to Introduction" title="Direct link to Introduction">​</a></h2>
<p>As Dart expands its reach beyond web and mobile development, interacting with
native Windows APIs unlocks a world of possibilities. The <strong>win32</strong> package
serves as a bridge to the powerful features of the Windows operating system,
allowing Dart developers to harness these capabilities directly in their
applications.</p>
<p>In this blog post, we'll explore how to use the <strong>win32</strong> package to call
Windows APIs in Dart, enabling you to create powerful Windows applications with
ease.</p>
<p>Here's what we'll cover:</p>
<ul>
<li><a href="https://win32.pub/blog/calling-windows-apis#what-is-win32">What is win32?</a></li>
<li><a href="https://win32.pub/blog/calling-windows-apis#key-features">Key Features</a></li>
<li><a href="https://win32.pub/blog/calling-windows-apis#getting-started">Getting Started</a></li>
<li><a href="https://win32.pub/blog/calling-windows-apis#interacting-with-windows-apis">Interacting with Windows APIs</a>
<ul>
<li><a href="https://win32.pub/blog/calling-windows-apis#displaying-a-message-box">Displaying a Message Box</a></li>
<li><a href="https://win32.pub/blog/calling-windows-apis#retrieving-the-system-memory">Retrieving the System Memory</a></li>
<li><a href="https://win32.pub/blog/calling-windows-apis#creating-a-classic-win32-window">Creating a Classic Win32 Window</a></li>
</ul>
</li>
<li><a href="https://win32.pub/blog/calling-windows-apis#conclusion">Conclusion</a></li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="what-is-win32">What is win32?<a href="https://win32.pub/blog/calling-windows-apis#what-is-win32" class="hash-link" aria-label="Direct link to What is win32?" title="Direct link to What is win32?">​</a></h2>
<p><strong>win32</strong> is a <a href="https://pub.dev/packages/win32" target="_blank" rel="noopener noreferrer">Dart package</a> that wraps some of the most common <a href="https://learn.microsoft.com/windows/win32/api/" target="_blank" rel="noopener noreferrer">Win32 API</a>
calls using <a href="https://dart.dev/guides/libraries/c-interop" target="_blank" rel="noopener noreferrer">FFI</a> to make them accessible to Dart code without needing a C
compiler or the Windows SDK.</p>
<p>The package simplifies the process of writing Dart code that can access
<strong>Windows hardware</strong> and <strong>system services</strong> by providing easy-to-use bindings
for traditional <strong>Win32</strong> and <a href="https://learn.microsoft.com/windows/win32/com/component-object-model--com--portal" target="_blank" rel="noopener noreferrer">COM (Component Object Model)</a> API calls.</p>
<p>Whether you're looking to interact with hardware, access system services, or
build sophisticated desktop applications, <strong>win32</strong> has you covered.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="key-features">Key Features<a href="https://win32.pub/blog/calling-windows-apis#key-features" class="hash-link" aria-label="Direct link to Key Features" title="Direct link to Key Features">​</a></h3>
<ul>
<li><strong>Direct Windows API Access</strong>: Invoke Windows API functions directly from Dart
without the need for a C compiler or additional setup.</li>
<li><strong>COM Support</strong>: Easily interact with COM libraries and components for
advanced Windows functionalities.</li>
<li><strong>Extensive API Coverage</strong>: Access a broad range of Windows APIs, including
system services, hardware, and registry.</li>
<li><strong>Seamless Integration</strong>: Effortlessly integrate with existing Windows
libraries and services, enabling smooth interoperability.</li>
<li><strong>Cross-Platform Development</strong>: Develop cross-platform packages with specific
implementations tailored for Windows environments.</li>
<li><strong>Developer-Friendly</strong>: Simplifies the complexity of Win32 API calls into
easy-to-use Dart functions, enhancing developer productivity.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="getting-started">Getting Started<a href="https://win32.pub/blog/calling-windows-apis#getting-started" class="hash-link" aria-label="Direct link to Getting Started" title="Direct link to Getting Started">​</a></h2>
<p>Let's dive into how you can get started with the <strong>win32</strong> package and see it in
action.</p>
<p>Add the <strong>ffi</strong> and <strong>win32</strong> packages to your project with:</p>
<div class="win32-common-code-block language-cmd rounded-lg bg-win32-react-light-code dark:bg-win32-react-dark-code border border-gray-300 dark:border-0 mb-6 relative win32-wider-container"><div class="py-3 px-4 bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-100 text-xs flex items-center gap-2 rounded-tl-lg rounded-tr-lg"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" height="20" width="20" xmlns="http://www.w3.org/2000/svg"><path fill="none" stroke-linejoin="round" stroke-width="32" d="M416 221.25V416a48 48 0 0 1-48 48H144a48 48 0 0 1-48-48V96a48 48 0 0 1 48-48h98.75a32 32 0 0 1 22.62 9.37l141.26 141.26a32 32 0 0 1 9.37 22.62z"></path><path fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-width="32" d="M256 56v120a32 32 0 0 0 32 32h120m-232 80h160m-160 80h160"></path></svg>Terminal</div><div class="relative pt-3 pb-0 not-prose"><pre tabindex="0" class="prism-code language-cmd bg-transparent !mt-0 !mb-0 m-0 px-0 pt-0 font-jetBrains-mono pb-3"><code class="font-[inherit] bg-transparent inline-block min-w-full"><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">dart pub add ffi win32</span><br></span></code></pre></div><div class="absolute top-2 right-2 flex items-center gap-2"><button type="button" aria-label="Copy code to clipboard" title="Copy code to clipboard" class="w-6 h-6 flex justify-center items-center bg-gray-200 dark:bg-gray-800 hover:bg-gray-300 dark:hover:bg-win32-react-dark-code rounded group transition-[background-color] duration-200 ease-in-out"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" class="w-3 h-3 text-gray-500 dark:text-gray-400 transition-all duration-200 ease-in-out" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill="none" d="M0 0h24v24H0z"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></button></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="interacting-with-windows-apis">Interacting with Windows APIs<a href="https://win32.pub/blog/calling-windows-apis#interacting-with-windows-apis" class="hash-link" aria-label="Direct link to Interacting with Windows APIs" title="Direct link to Interacting with Windows APIs">​</a></h2>
<p>Let's explore how you can interact with thee Windows APIs using the <strong>win32</strong>
package.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="displaying-a-message-box">Displaying a Message Box<a href="https://win32.pub/blog/calling-windows-apis#displaying-a-message-box" class="hash-link" aria-label="Direct link to Displaying a Message Box" title="Direct link to Displaying a Message Box">​</a></h3>
<p>Let's start with a simple example that displays a message box using the
<a href="https://learn.microsoft.com/windows/win32/api/winuser/nf-winuser-messagebox" target="_blank" rel="noopener noreferrer">MessageBox</a> function from the Windows API.</p>
<div class="win32-common-code-block language-dart rounded-lg bg-win32-react-light-code dark:bg-win32-react-dark-code border border-gray-300 dark:border-0 mb-6 relative win32-wider-container"><div class="py-3 px-4 bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-100 text-xs flex items-center gap-2 rounded-tl-lg rounded-tr-lg"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"><path fill="#01579B" d="M5.013 18.936.996 14.92c-.476-.489-.772-1.18-.772-1.854 0-.312.176-.801.309-1.082l3.708-7.725z"></path><path fill="#40C4FF" d="m18.764 5.032-4.017-4.017c-.351-.352-1.082-.772-1.7-.772-.531 0-1.052.106-1.39.309L4.241 4.259zM9.803 23.726h9.733v-4.172l-7.261-2.317-6.644 2.317Z"></path><path fill="#29B6F6" d="M4.241 16.773c0 1.239.155 1.543.772 2.163l.618.618h13.905l-6.798-7.724-8.497-7.571z"></path><path fill="#01579B" d="M16.601 4.259H4.241l15.295 15.295h4.171V9.976l-4.943-4.944c-.694-.697-1.311-.772-2.163-.772"></path><path opacity=".2" fill="#FFF" d="M5.168 19.091c-.618-.62-.772-1.232-.772-2.318V4.414l-.154-.154v12.513c0 1.086 0 1.387.927 2.318l.464.464z"></path><path opacity=".2" fill="#263238" d="M23.553 9.821V19.4h-4.171l.154.154h4.172V9.976Z"></path><path opacity=".2" fill="#FFF" d="M18.764 5.032c-.766-.766-1.394-.772-2.318-.772H4.241l.154.154h12.051c.462 0 1.625-.077 2.318.618"></path><radialGradient id="a" cx="538.463" cy="539.28" r="528.383" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#fff" stop-opacity="0.1"></stop><stop offset="1" stop-color="#fff" stop-opacity="0"></stop></radialGradient><path opacity=".2" fill="url(#a)" d="m23.553 9.821-4.789-4.789-4.017-4.017c-.351-.352-1.082-.772-1.7-.772-.531 0-1.052.106-1.39.309L4.241 4.259.533 11.984c-.132.281-.309.769-.309 1.082 0 .674.297 1.365.772 1.854l3.702 3.675c.089.108.192.219.315.342l.154.154.464.464 4.017 4.017.154.154h9.733v-4.172h4.171V9.976z"></path></svg>main.dart</div><div class="relative pt-3 pb-0 not-prose"><pre tabindex="0" class="prism-code language-dart bg-transparent !mt-0 !mb-0 m-0 px-0 pt-0 font-jetBrains-mono pb-3"><code class="font-[inherit] bg-transparent inline-block min-w-full"><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token string-literal string" style="color:#e3116c">'package:ffi/ffi.dart'</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token string-literal string" style="color:#e3116c">'package:win32/win32.dart'</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">main</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> lpCaption </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string-literal string" style="color:#e3116c">'Dart MessageBox Demo'</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">toNativeUtf16</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> lpText </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string-literal string" style="color:#e3116c">'''</span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token string-literal string" style="color:#e3116c">This is not really an error, but we are pretending for the sake of this demo.</span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token string-literal string" style="display:inline-block;color:#e3116c"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token string-literal string" style="color:#e3116c">Resource error.</span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token string-literal string" style="color:#e3116c">Do you want to try again?</span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token string-literal string" style="color:#e3116c">'''</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">toNativeUtf16</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> result </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">MessageBox</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    NULL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    lpText</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    lpCaption</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    MB_ICONWARNING </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// Warning icon</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        MB_CANCELTRYCONTINUE </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// Action button</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        MB_DEFBUTTON2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// Second button is the default</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">free</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">lpText</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">free</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">lpCaption</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">switch</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">result</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">case</span><span class="token plain"> IDCANCEL</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token function" style="color:#d73a49">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-literal string" style="color:#e3116c">'Cancel pressed'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">case</span><span class="token plain"> IDTRYAGAIN</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token function" style="color:#d73a49">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-literal string" style="color:#e3116c">'Try Again pressed'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">case</span><span class="token plain"> IDCONTINUE</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token function" style="color:#d73a49">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-literal string" style="color:#e3116c">'Continue pressed'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div><div class="absolute top-2 right-2 flex items-center gap-2"><button type="button" aria-label="Copy code to clipboard" title="Copy code to clipboard" class="w-6 h-6 flex justify-center items-center bg-gray-200 dark:bg-gray-800 hover:bg-gray-300 dark:hover:bg-win32-react-dark-code rounded group transition-[background-color] duration-200 ease-in-out"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" class="w-3 h-3 text-gray-500 dark:text-gray-400 transition-all duration-200 ease-in-out" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill="none" d="M0 0h24v24H0z"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></button></div></div>
<p><img decoding="async" loading="lazy" alt="MessageBox" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAZoAAAC5CAMAAAAmlwl9AAAC91BMVEUAAABBPz4yLSwzLi06NjQ6NjQmJiA/PDojISEgICA4NTM4NTMyLS0kJCD////s7+3v8Pju8vjx8Pj3/7Jf2v9CQD96ADsAAABAPjzz7/hqamidn5zf4eBBPz5lZWP17/jn96fy8Phbze717/YAhth5AABzADj/s2MsJyf7/9eE//8NADvF//8AXLPIYgAMJ4w8rv+iMACzs7jtjDhlZWYmAGWBgYOBgoPNz86iLDr/3YtGRkb/qV3Pz9W5uLx8AGWcnJ8Af8tIRkaDgYP27/ZyAABIAAAAa2VkazsbIB989e658u0AV6jp88q2uLvr7OgMADn8qwDO0dXQz9WVlZVJI4zehDa2t7uKkmQiAF/RnCXToSPy/wC8XAA6pO7Z2djSztWtr7H30IPT1NQJJ4X2ygC3ubagoaCWmJhycXD2xQD/vgD+tAD9rwD4pQCZLwDl5uTc3N/V1N7B/9jRzci8vb38/fzFx8i2uMXExcOam5xGIoVFREKZKjj/wif8xADU0MyvsLp0vIxnZ2VNAGVeXl0sJyj94AD0zwD+zgD5vwD1+Pbw8/Lk6O/Bwc7AwpiDgIODil8AZV91AF88OkH/1SX/0B//9Q3/7QnZzQm/jgf8+wTx9AD7yQDYswDUowDGy9jCw9LLzcyys79K47O1tqizqXO6tmahHWJ3elC7sktxdUS+qUMpJzi+kCPCvx/Oph0GBxXanQnRwgP4/wD82QDb1AD+0gDtpgBnQgBOQABFAABU39iNesu+/7LAx6sAk4x6EIyY5IvHuH9oZHbErmteW2tnY2a3mldNTlK2rFBZV0jEsUPJYDnEtzdiZDRBPjD/xSVSSyHHvBna4ADpxQDarADpmADQjAD3+ffp7PTt8O629svY0rrJxLdx/Kg4Vaiur5yysoz/sIu5rIrByIgAi4VusIRzFIQAN2UANV+giT9UUj9nXjpHADnDmDe4jjeSmzTDpywcHyf/3yD4ux/VyRzLuhGFaQLZpACWdAB9XgA9QADsZOqIAAAADnRSTlMA73CEwq8g3zAQr59gQLclTR8AAA4SSURBVHja7No/b9pAGMdxkjZpVVXVc5aiR54iK8vN0QmGE9YJd+nCECKxZs2YzJ079131bfV3f6InFCzcxJBz4CtxPh9MfHSGOIx8n0/PPl4cy6RPZx/OR6mvJ7f1Q1lWVVVsif4jlXnkkxny0wx6qG9/nkaZL/ePZQg023pvNJn2eP9xhE7vS5RsDoeG8u4e++b85FFo0IHQ0D5be/PkXJZWzx9/no9Ob0vpYGhopxVI5hKl2s+l2w+js7pctXnX3wNoLxW+NRlZ23Ie1uqz0aeHFZrYdpphGtFeKrrXvq8eTkYXAOluQ8O2oV0lKH7spYvRxaVvlafdhoZsQ7uu6Jumo400MBvaU4nkJTS/ruPx+tdmGs3MeuO3AW3CYTbrhDNlZrsuM2E0V9sbGk3x+q5/XKdDC81dWf5mDELDiYYXGBfckUYTmfE6zUSpG8awrWHRFKgXmzi00sDGyLYRGtNgbEx3mvFmGtio7R0gjWd5khGaq6srb5No6hl2DvOiaho2mJhAU2vvVIPGMWOOZ8Y0xrOEGRMRRq9hcQg0ekrpKV6S0wqBBukb5Zg1JjjcWPZPWb8gHaKMtxEZoYk2keZOl8iZquFnu2YxqwvXgCboYBI3RwwmFixAMQ4606kXxbIloPiXsewaZedzq5SbKG3VhOfKOmUMnsRiahAyhbRTmmTztGtKZgZN85wGJGFoGM0K/9aTtvEzHyYchTQj582cJbuksHvGvASN7JoJI4uJAhJWMcM6q9jhysgFrYXG/C75rnSRpuIq0RTahS2D1ZCDBy3ZTDmaJJpp+qzBI9HQKs1cJ6J/abSKHa5MGFppLi//aGyaspwFmqrSiyrRNFx7mpqLGOYewDNomLh4QTNPNM7GC5oNr0k0kOE5HgoJTbyg4REaAk3Re/LluYWGmf/4jcNsTNk0VVUZNpEGj8ABImZXY1gsMCzJMht88qevARrHcAIdMv4wxWvGmtCY0dPECU34GmBVKGuaYmfRxj85habzXQGJnmdchvcHBiGDN3J9KdEgoXnh/wiWPM3w3s0wZFAbTbtNx3+tGWZe5nRfbQCfL51pBOclNLndkO5X5O1pxOY/rmhZ2vS9V7KkKYdI07MMyoXmsjONlJNN3zJorzJC832bTQedd2VTCM3bJDRIaGKrNB10srJ59V7JiQYlm3WcbjQ52fT2Q6V+q9DLaNovap1s8vlJx2tl0I5k0OZzWVuh+XYsy4402XakybYjTbYdabLtSJNtR5q/7NEhAQAwDMCwKzgbnH+bs1GQWEiWmiw1WWqy1GSpyVKTpSZLTda8/SStmio1WWqy1GSpyVKTpSZLTZaaLDXHfdXzNg1F0X/gpVXNwBgrchonNlaHZIAN2DpFYrBUWZU6V6qShjGFrYjOHQtFQIvEQNWp4mtEgok/ws7Afe8efGwZB0txq6pPbXPfuffc8969ec/utR21WjPZ3Fyv8nmu664uL60sm8nSvY6iNEtDQitgemoPkkuzRlIR/Od+em6rzK6Qh7vh1mzfubs7by8VmjeqNXVir741z9KtT+nGf1rzyHVb1o7dtY7ANOGUT8+cL09sCz7sd2USOH4kiLbmIgqddr/rAAPRDBNpOR+VJ5k0hfigEKIwx1Do6XragZIdZKUymcTs8qDGZT+w35sc8Nlu2jPU/Fosm2EqYcvATXohPE205vHs9fut2f7c1niB017r5A5+zoRTamXqLg4FW1K90B+YmUTqqYkDJzZlBQaig0jhKA+ZxNRB+dzpiwW71ZJYyDArlcEkpmSocdmrgueBWLqBrXMtQLIwbi6TXrkQCJ4GWrOdpoc/T6a781rDovhRoDBNOPnBTbjme9fG00p+hqMdXTQwXA+I/DvPZ6pWGD7tfN8z+ZScZaUymcRolZIWAZKpmUOoKmWg9G9B4Fm8NZPxy29J8uFgtl6nNWLHuMVoVrXGmjhJaOxgb9TNMMbwb/3W+IPjLztvvo66mJezkkmM1mKt4epsGSDtyTEGuYHWbMxenSdJ8u5oXLM1OMY04cxdaAD9qGUKFuDCMFD8RCBgLAIis3khE27HuN/1oxA0rYjUQfIpmVmpTCYxWFSTCVhFABGlXZEHCVuGTLqH9TTQmv30+UlydibHZnq7Tmv4fKWpTn1g6hsnaMP78oTkY1Yg3bOjGFuDSMyRSUxTFX2nsKnbrqFBQWah+QU5nxUQmcQMuaAmE7CKgCEX14LX6SyMqgGkccvDs2hrXkwPDn+dnr49/3E0njiXPmJb6vqjFy4ghuo2uMyr/Jfzj/yNFp2LkTpy5Nj6bYcXBvHRGGgaahMZUoiOLf2jxlhcHLsz6Rs1lUVPr8SslDJpXT/7U4FdD98owAnoHDUyFZXfYmJWHms9eXn61aO95XyjABegc9SUGfUun7NlzuqTTjWXZ7RvuFvuzzcKcAH6Rk1y3/6Zs2fP8ZgyRfR7+9ara25V4mwJINpdiKFO9EJ9FFAtanqMelfNnj59zvm1U2o2t2/vnH94QSHu6hRzeG80amgWNaVF/TOnz5jRfmlj24V5nXPrs9f1lt5EU4MYtIQOQaigDXUiuinwMUpxFT0gA6xzNL7Iihp/o+QzM9q3bu3YJb7xwvz6rpycTUcXJKMpwuwNYw51QkcI4WOUVm4GVi2w4U6+UUBy1JQZFS3v2N6R2jl3l/jnN9eyc3Jyc2fd80NtQOMeQ8Ic34SPGsLRaDEHYOfseZqKwjj+DS5jhzq6skBMmPgImiZNTGBoOiBNa5uSaIQOtg4OYOKkDk0oRkInIchU/AREXHDBxMmXxRijgya+LDyn57TPObnc0sLh5uHy/yXl9pB7O/SXe27vc8/zP52a3PpGi8zMrS7vpjb3SU05Uz7ce740vJpwfZMGUHN6NVw8e1MkM8Vi/W+zudYhM5lK5v2X69UTJrRwqdMUBGljqzFHqlkPjKRmafFTS4lZWSmt/fvTvJ0hM5XK4c/HbgU6XN4Llzp1QdAU/FiNPhJqRlXzIT/xsqjNlP6nNr93ysoMnTbtxVwAIohFzfR6u7U8t1qvl0r116+ePNyhCY0od7amJx4FIExcaqr5j29/PSWeEdvv9r/9Prjf5WBn78FUAMLEpebWzfb2bJ+ZrZk+sz828mMBCBGXmvy9O0SjkVuo3jBUr+QajQb998VdVKAjiOWsSWez2UKhUKvV0vOaNL0vKLLzCwEIEY8aYmoAuNYMA5ajJxaoEQvUiAVqxAI1YoEasUCNWKBGLFAjFqgRC9SI5cxqTPcbEKhG9R9dw+P9QKYaWnlhGq7Vck1eyKFe3Aqu/gxqNMdqQf9qVI+WXplJjpzlT/TSbd/kRO8xqNEc+L/WjPcuOd3lmsaJu+ntEdVojrWCXtVwPoAOujB92FFqzB7mDdTEoUaFJ/QarmmqMlMUCXNawfUe0Y3mWCx4HmrUxcb0mZvJjTvFe5OZacmOajSHGtxyXhygRixQIxaoEQvUiMVPeXP8bDkkowY0cud7knt1vfx4piJAzGqYz1QnSmaNx4saO1KLPHXzM50ap52EacdqmiBOvdFHmBGVO7/uchAnR17qASdhqrtcnDXRakgHt5rr/EynxmknYTqxmtZZwx+gRV8N3CBOjrykASdhJtaMPzUsQeVnhiponISpUygjG6et0fFBnGbA42ROZ77U0PfO32w3P9NVYydh6nNpGDXHBnHS4JL0tvtQYz93CQiVd+nWOK0kTDdWM3pCo5cbxGk63PuH87mV0Edw/tYG8K9Y5cKtcVpJmHasJsdkqo05gjvc7SBOzsBUA6jxkJ/p94MmL9NDas9qOD/T/wdNppJ6c4lCzQUDasQCNWKBGrFAjVigRixQIxaoEQvUiAVqxAI1YoEasUCNWKBGLFAjFqgRC9SIBWrEAjVigRqxQI1YoEYsUCMWUjMGRAI1YoEasUCNWKBGLFAjFqg5Yr+McRqGoTB8AzxGAlRFHnIKLxmy0FTKFImhGSr2HgB15ADAJbgCQpyBCyDBBIiBM/DHeckjLU9ElpGSyL/aJE3r//3259rtaBXQjFYBzWg1YjRH3nTceS786V9SssaN5tSTTn6g8TaOC+8pJ4XGk1EPja9xXPhOGdD4MQ1ofCig8aSAhhTQOCmg+bXTJoqiVAmKE632JaKJM1gV/QabL71veXt2YCigEeIhFLtImgEacy73cTAa+ePlVaoGSEBD8eRQsqaPZrXT9rTF3ESfr3Gy0z+3Bwc0eD593lfKXCxr37uXj6U1fEt0W0RTHZaEhuJZg0JTPlzj0LpQTd3kZU0fzeZySVdYIuIst9N0XfdxXWFcXNBkqSpzVabW/hU+8MKtQlORRLd1WAIaimcNwJraEYz+qyYvt5wPGlPvEtRLPGjjqBzQ4AnX52aYwMXk7e2uSPua9QcaDiafbF5uOX00NEKYkv3O0huOaFa7d4wp8e0mNhUZiIbjDUKzn3T6aFSJPSF+xNQ23bdmtU2VsgdHNN3ub2hlhBfsqchgNByPFrQeDE5b1bZNXtYM0KjSzussukl0b0fdPOC+KxpTtOsZrq0X7KnIYDQcj34GdNtK8zOAl0nYNnm53RzQOEhCw8Jkl+8cKvzl/G7HjlUQhoEwjl9yUSsit0qLPlX2DIFA3qEP79mlLg7CKVf6/cZMgf8lhPwpjV6GOuKrZfR15TOkwUeNOIU0SPM1pPlJmsnE3tNMRt7TjFYe1rvcUprRzprGjvkuN5Rm75DGLaRx606nIuBQCXRpAg61RJwFHMpMx7kKuFPDlSh2AXc6k0od58aZ2g9neolzbninuVFaDlHLLAZO4QZOhMQDqScZV/MTUMMcKAAAAABJRU5ErkJggg==" width="410" height="185" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="retrieving-the-system-memory">Retrieving the System Memory<a href="https://win32.pub/blog/calling-windows-apis#retrieving-the-system-memory" class="hash-link" aria-label="Direct link to Retrieving the System Memory" title="Direct link to Retrieving the System Memory">​</a></h3>
<p>Next, let's retrieve the total amount of physical memory installed on the
system using the <a href="https://docs.microsoft.com/windows/win32/api/sysinfoapi/nf-sysinfoapi-getphysicallyinstalledsystemmemory" target="_blank" rel="noopener noreferrer">GetPhysicallyInstalledSystemMemory</a> function.</p>
<div class="win32-common-code-block language-dart rounded-lg bg-win32-react-light-code dark:bg-win32-react-dark-code border border-gray-300 dark:border-0 mb-6 relative win32-wider-container"><div class="py-3 px-4 bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-100 text-xs flex items-center gap-2 rounded-tl-lg rounded-tr-lg"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"><path fill="#01579B" d="M5.013 18.936.996 14.92c-.476-.489-.772-1.18-.772-1.854 0-.312.176-.801.309-1.082l3.708-7.725z"></path><path fill="#40C4FF" d="m18.764 5.032-4.017-4.017c-.351-.352-1.082-.772-1.7-.772-.531 0-1.052.106-1.39.309L4.241 4.259zM9.803 23.726h9.733v-4.172l-7.261-2.317-6.644 2.317Z"></path><path fill="#29B6F6" d="M4.241 16.773c0 1.239.155 1.543.772 2.163l.618.618h13.905l-6.798-7.724-8.497-7.571z"></path><path fill="#01579B" d="M16.601 4.259H4.241l15.295 15.295h4.171V9.976l-4.943-4.944c-.694-.697-1.311-.772-2.163-.772"></path><path opacity=".2" fill="#FFF" d="M5.168 19.091c-.618-.62-.772-1.232-.772-2.318V4.414l-.154-.154v12.513c0 1.086 0 1.387.927 2.318l.464.464z"></path><path opacity=".2" fill="#263238" d="M23.553 9.821V19.4h-4.171l.154.154h4.172V9.976Z"></path><path opacity=".2" fill="#FFF" d="M18.764 5.032c-.766-.766-1.394-.772-2.318-.772H4.241l.154.154h12.051c.462 0 1.625-.077 2.318.618"></path><radialGradient id="a" cx="538.463" cy="539.28" r="528.383" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#fff" stop-opacity="0.1"></stop><stop offset="1" stop-color="#fff" stop-opacity="0"></stop></radialGradient><path opacity=".2" fill="url(#a)" d="m23.553 9.821-4.789-4.789-4.017-4.017c-.351-.352-1.082-.772-1.7-.772-.531 0-1.052.106-1.39.309L4.241 4.259.533 11.984c-.132.281-.309.769-.309 1.082 0 .674.297 1.365.772 1.854l3.702 3.675c.089.108.192.219.315.342l.154.154.464.464 4.017 4.017.154.154h9.733v-4.172h4.171V9.976z"></path></svg>main.dart</div><div class="relative pt-3 pb-0 not-prose"><pre tabindex="0" class="prism-code language-dart bg-transparent !mt-0 !mb-0 m-0 px-0 pt-0 font-jetBrains-mono pb-3"><code class="font-[inherit] bg-transparent inline-block min-w-full"><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token string-literal string" style="color:#e3116c">'dart:ffi'</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token string-literal string" style="color:#e3116c">'package:ffi/ffi.dart'</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token string-literal string" style="color:#e3116c">'package:win32/win32.dart'</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">main</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> memoryInKB </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> calloc</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics">ULONGLONG</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">try</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> result </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">GetPhysicallyInstalledSystemMemory</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">memoryInKB</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">result </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> memoryInMB </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> memoryInKB</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">value </span><span class="token operator" style="color:#393A34">~/</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1024</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token function" style="color:#d73a49">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-literal string" style="color:#e3116c">'System memory: </span><span class="token string-literal interpolation punctuation" style="color:#393A34">$</span><span class="token string-literal interpolation expression">memoryInMB</span><span class="token string-literal string" style="color:#e3116c"> MB'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token function" style="color:#d73a49">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-literal string" style="color:#e3116c">'Failed to retrieve system memory.'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">finally</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">free</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">memoryInKB</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div><div class="absolute top-2 right-2 flex items-center gap-2"><button type="button" aria-label="Copy code to clipboard" title="Copy code to clipboard" class="w-6 h-6 flex justify-center items-center bg-gray-200 dark:bg-gray-800 hover:bg-gray-300 dark:hover:bg-win32-react-dark-code rounded group transition-[background-color] duration-200 ease-in-out"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" class="w-3 h-3 text-gray-500 dark:text-gray-400 transition-all duration-200 ease-in-out" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill="none" d="M0 0h24v24H0z"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></button></div></div>
<p><img decoding="async" loading="lazy" alt="System Memory" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAdIAAABgCAMAAACeywPOAAAA2FBMVEUAAAAoJCo5NjkzLjIUFh0qJio6NjkxKy4nJCgzLjIQGxsUGBwVGyAhISAuKS0vKi8tKCw3MzE9OTzt8O4rJirLzcw7Nzl0dHI7Nzioqqjh5OIcHx3///87OTooJSnc3t0AAAC7vLrk5+WRkpDU1tWdn5xiYmAmIyaDhIGMkZPExcO2uLZ8fXvr7uyytLJoaWhOTkzGyspCQD8kIyOpq6lubW9vb3Hd3941MDKkpqb09/WJi4nN192foaHS1NNGRUNRUVXAwb9EQkd4eXpcXV9SU1Fjd46WlpcJwdwYAAAADXRSTlMAbu+tGoDbv4+/MEAwaKFJwgAADoNJREFUeNrsV8Fu6kAMDKWt9KRHZoQsLkjv2g/gkv//spfYnoyWC+egWpCl67V3xtvxwrTZ39P5+/prB7fv89fn1Hb6WBbMnDfjNmD7gDltGFgjaq0MWst9aaWL/ATIhUpfszl2TmSAcpAsCErWgHIWjZFAezSWg8L6bNHIuX6CMaKDj88fy3I9TWnnW8YBFChDq4gCZ2qE4Ix8d7qsiGgn9SqDKLOAcx0jA4l9rp5AM+SWjJW3nOYsQ6EcEYVKPBa8nop+F/64/UmN3jYc6c7kEC02a+xgomAIszZn7tdRiH2j/j8KqwC0JiyQnbBFQBDYmIJozUD6q631V41CsucCLafedzTXGO/E/7bq9PMDTcw+DfZoc68EmzznoCoyQwUAWPTpMJrWKAZiR2ufQ10hnQAyqiFCTSjUOSGFiKqgIntfdBJt9k78cf2cTstKXzdRIiX3RFAmpydYDMTfAaJaAzurdFJrURsNVUIpwZ1PAztoNEFSS1TtokM3A+D+6H38JqDl78V/+ZrOy0C7df18O8ANhzvKEMmukiSSasDewMwpnZYHgH53PmSwOEc/0HsSwmcRwoXOMnLL4m8yAzLkpAoZqirei/9ynr4rj1BBS+puJiAUMd7uDRM7WiMmQrNwp2DTzofxUKUNJO6x+7mmBJ9CMVS7Udog8rSa6AxW6nvxx8d0PdyPjp2xmy1ULF9N+q4UOQEXo2wNzZwH/NH1gv91urKnDEaAVRjEv8f9OHb5IUKcwNLI0GvT3QNf8h9PudfKfDu6E1tpo7UM3TAlS1j9oRlCIV4sA0K/cNZndx+peD3SXG2UbvtChsf9ciy7/8RM1EvnCfYRR6nPOnvFf6yoQ6I8aqhAwO5QiLo2aynUP3y+QpIumVsG1aCZmdibGWx+wYueySN90ZcYlyPaTFI6IPrdShh/JLzi354+MJ2fj94Kc2bY9XyBJjA6FSlFEp1GESX3qMWlXCX2vn6AOtJXN/PjckT7T63Z6LYJQ1H4CYxvJapJ0YWtraIIBQtlC6yky7Yk0/r+bzSbizkz6SIIVVcubfix8seXc3197C+h5OD5EImskNL+Z2UmqMQ8wBXbjmSBDp0g6HA4LRKVkrdBetnnStU8I/XDDf148+/4fKHt/fh8Y3xOh/RysUfzFKlSq1iKXSAai3R+xa57K1EpwXJsT+BjzDTv2sxL8o2vRxoC9XYABanTNyIruwa4Ed4mADzfSZLb5LnBdcEvL07CAQH7GCoF5q7ijcXCgILtPnab4FVzDbn5j1OQAhScJmrZ+n2zm24q3nEbd0NMxftS3qC8PzcVLdJeZv/58PALmX22XalSaXNjbyYgfdUZPGkDxy4zCiQ+ikFyZOFPIEkEF7EdbpWmtKd2V/l8jrBIgzFtke1P1T4rupJ+peYasXOOaALSy2N6+R/jaeCnQR4QUjR3B1qL3vw4VLIvknLzsSzMiBqiCCD1WYP0Kds/V0kUJdXzPjtJRw2VZr1Q7zzSZijZw/RhBNI3dfDZO/g8yMF3TCtTBg4+kOK0Lo7e0D8WtVwD0uybj99uezWkhZoSuTw9WZ61SOfRw/R1BNJxEzoiLKFK7tFwG8a7fL5jJfLWBYKpHXLxQGuyNKZ60Zq0SDH7Xv89+15Huod0E8R0pLxW649qy5OYFqZwRBfnSFP3+acgfdPVF+zByQGCApcLVysj/SnsTKhUd114jeGPQyrGCpB+CiJAulwwL65DmmyVmsgURAOk41T6AzuoVOQJy4i09GlS2GrgJmEDxQJENGg5DHs58rDlMKWp7N9Ly2GQeGOLFK5mpNvEuxqC9MCHPF9eh3RyFCYH0VClpIcjvX1yj0+3aPNCI9xIKAK4HSotXOLrl6ahPBpiWUnJ65ieW1YWKWYoasxQCF8bgUqZHUzuIy1YlJZsdrwoVM7r3W67YRMcbg3vlo6j4YOVteHvgjTnP+ycbW+iQBDH7wsQNs2mlzQLJjXEF0CI0XipRGNb/f5f6XZmbvifAhZLY4QwrbAPIOiP2YfZGavCMqcDbxW6SFOxh+EFhH7/8bKlzVujls5KT3R2pqUwrdqwQgpEQs8YuAQhpUeez3dAiktAz7gPOezDobXXB8kYzliYLpgog9V5khxFObEeCWulCKSG5qVA6ginqyNdu4j3y/wULLdR5gnvXRnl+yBDssiC9dbT20drl508hUSRojDz4G8mGr2kedGItGNfCqZEFKIITNiwgAPB2BVsYc8/XxBtN+vA1NDFrPG6ETqb17pZg7S0ak7mRzmJrM3HuXwOe4aUxbkLpKmT/TYljc0yx0XMC8li+eKIXkavNZ2hSFFIcjvRhPvTOlJWrw5IwZSIQtqHqKpyD7l67pHiCp8lnqbyU56mBi0VtEDKukjiriHNlwXopUB6UfgdokEjU16v6oAU8vR0VtekTT2MhHfyPCSkaNufdwft3g+7Z8OpuNaXMlfnkUJmLs3K9F/DGzQj9diXFb3CrdHwojANTuWNSJOEd8V78+par3kpBiihfplGphKiNMISMwYsmPD+riNmUkBMYuCuXBBTutBhV4Rya3GXEW+U5s73h9HSuVnRgjRx21TpUbfq3i+R0pgpX//kgmlYm8S83TgvFYSw/lRzgsd1LXz6Ff1/uc2uoDcodhtdv21F+vAGQW6f+th4779+3d3K7/eyCWtW/oiRYhnukMyPx3lyqB5LO2AbL33mHkihFZpA5wbrPSsS6uqWolBUKEQbbqyk5ARBK1loLfzGjOY6hth5pBduL5sk2cDtxQx3cc3yF9oD6c1uP7AkdHR7gm5KnZCQHlvJYVUl7BAXIEivjL0G7HpE1qOw3xL4o0a9fBH145HWHBPP4uWGi9T2dVT50oYDNajbcAA79GIMEELfZaM1lveIveP3srD24lhTDdcAX4tC1tL2h2LYWspq0QPpt0LhWj257ubJ5JFes0UOGSkB6eX0idlEWzv2kHrskV6LWR56w9slCGJgMevaHOC2LlZNRUtbw7cGPeI1ncLXBvqbIS0evYK05SEYOtFgZU1jJJDqg0ZCdVCCQUVCeaSxtbEXG1svC0P7qmjARD1T+gCL1UIFyZVsV6t6jaW0ZGP+HkSsNX5jYst/9M+FlNEywwX8QgWlFnQblMR5XCf1/K5yEqX4SM0rBrkRzWopCd2WXor5WeuRBpOMSiako5MJ6ehkQjo6mZCOTiako5MJ6ehkQvqXXTPYkROGAegX+GRZTnqJ4gSEckD8/9c1MbAmZculu9N24EmbyWYMZvPkQHbm7XiUvh2P0rfjUfp2dEqngMHD5ySGV+EKEqyQdjw2uPaGgGEAhduAQejAIa3BwcN9OSpljOwxwaeQhxfhsgTqtC3MHGUBmNCzxwkaucARCgmm0JRm1r/ithyV+lybSH9bKWVHZEW6wiqJ4scVJlz6o0qEWJpS0t/gthyVztQqYgSn0zehA/CCGB0wKu39FDC0MsGEw4zm2UYsph9JqxnB4o4pYMYZjiRV2a+towxQKaq06XLioYOSQEiP0l5pFQBKIZ25daFLEsEx58g8ArAufdx0DTJ4hB0bsZjzCGPRE1qK2mKEnl1pINgoODT7kzCwLrxeHHSQz0P2m9KpxtwWU6qTK3HR6qmtJAAfWoWMh4U35trkCIAMCGxKbcRiziPczuzRUjQW+Fxpwigyq7qZJKtTDGprwaSnN8jPMqtSrMxwXzqlMM5BmkAZ1kWRceZlnzJ78XSp9BxDtHnSAxgthXFWWiRxks2Ok6E2mTw1tyXDSelIo98fj54qNVwuWovbopgCIi1Hpdi4UtrHnJUqluJCKXpdYfexsq3UJba3Tko1mPRHz35bjkp52adwxFHSx2a1HJVGrowXSi3mQqmluFLKW0l73sa0+CasncaFUo9wW45Kw1ybOWg3i9tvo55M6Von45XSLuZ8LwXFUvzmXmrXI1sn+L1uEYAbF0rnALel25fqc6mqGzDqiySeRLslfzzxDjJcKD3F9E+8oFiK8xPvyJwzc43Yr6c2XHBpfuuIzLByVmr30hv/+8iUVnxA8drTnYLWCGJxOtHB9qUeLpSeY7p9KSiW4rwvJVSa9e084AXzpB0duVaKiHJjo6a0ZxD4NizFg/IapTnCt2EpHpSXKF2+f1+33Hnr+Duez0sfHqV/xI8d+Ld5lD5K78v/qJSwEh18PZ6g4wu/C2NHjVjgFx6lmTkJgfFapeThmuujlp/smsuKg0AQRb8gq6JwXImvRlw0+f+vG3GqOGqBhCEEYntXF7se4F1E4+ny4eiOVHUDgHxfpFF3pKoGhzhOAnLixAomcoWqWbr8AELZRmoggg2MNUcWpqeZfxj9iF101SJSPzji848tLTfSSRI4if3dDrGCIQun9rSbF9MDoewjTdIzMNREFiasoJ1ddD0Xt0TKEZFaV6mRPocGnISPYkasYFA1Wo02ZoBQiHSdzsBYE1mYVVyZ1Y/YRRfOjjxSuoqMVBY1yXESkBOIFTNBqtxCIJRtpL2kBwOpiZEyh+mY/a4YaazxpUVGun4StTR3WIoTKxiUGqvhNgcIpRaRmYHUfCBSX1pmpGrGIgU5gVjBQCcsJQO3EAgF1UOVJTGQmg9E6kvvSDdYCsQKxmQ8EJEqEIrJGgZlIDX/+i19LdK8FmeWbjXpZO70yvUideTEiRUMaoapajsiBUI5PvGODKQGwcLEJ968e+JlF13p79n3h6NK2mqWiqVbqai50yvXi9RfCJ1YwaCk0tVKpEAo8b2UgdSg1Lz4XsouutShQY4mex2lHY1CxCdXvj3S92nsLgiqlB3p0F4QVPlt1w5uIAZhIIoOXljYrCw4oXRAAVzov7IQ5ZAOosSZ18KXJR/m1UnnCMXgUOXVSW1iUrrYmfTblQzpglSUDCkRISsZkhN8bUpmNPkDbiiZMQKm3+CdGtHGx2Pnai78ex+vlyzO47CEKPVW1keotyIxLZg2z/hIpn59EAEAAAAASUVORK5CYII=" width="466" height="96" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="creating-a-classic-win32-window">Creating a Classic Win32 Window<a href="https://win32.pub/blog/calling-windows-apis#creating-a-classic-win32-window" class="hash-link" aria-label="Direct link to Creating a Classic Win32 Window" title="Direct link to Creating a Classic Win32 Window">​</a></h3>
<p>Finally, let's create a classic Win32 window. First, we'll define the window
procedure that will handle messages sent to the window.</p>
<div class="win32-common-code-block language-dart rounded-lg bg-win32-react-light-code dark:bg-win32-react-dark-code border border-gray-300 dark:border-0 mb-6 relative win32-wider-container"><div class="py-3 px-4 bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-100 text-xs flex items-center gap-2 rounded-tl-lg rounded-tr-lg"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"><path fill="#01579B" d="M5.013 18.936.996 14.92c-.476-.489-.772-1.18-.772-1.854 0-.312.176-.801.309-1.082l3.708-7.725z"></path><path fill="#40C4FF" d="m18.764 5.032-4.017-4.017c-.351-.352-1.082-.772-1.7-.772-.531 0-1.052.106-1.39.309L4.241 4.259zM9.803 23.726h9.733v-4.172l-7.261-2.317-6.644 2.317Z"></path><path fill="#29B6F6" d="M4.241 16.773c0 1.239.155 1.543.772 2.163l.618.618h13.905l-6.798-7.724-8.497-7.571z"></path><path fill="#01579B" d="M16.601 4.259H4.241l15.295 15.295h4.171V9.976l-4.943-4.944c-.694-.697-1.311-.772-2.163-.772"></path><path opacity=".2" fill="#FFF" d="M5.168 19.091c-.618-.62-.772-1.232-.772-2.318V4.414l-.154-.154v12.513c0 1.086 0 1.387.927 2.318l.464.464z"></path><path opacity=".2" fill="#263238" d="M23.553 9.821V19.4h-4.171l.154.154h4.172V9.976Z"></path><path opacity=".2" fill="#FFF" d="M18.764 5.032c-.766-.766-1.394-.772-2.318-.772H4.241l.154.154h12.051c.462 0 1.625-.077 2.318.618"></path><radialGradient id="a" cx="538.463" cy="539.28" r="528.383" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#fff" stop-opacity="0.1"></stop><stop offset="1" stop-color="#fff" stop-opacity="0"></stop></radialGradient><path opacity=".2" fill="url(#a)" d="m23.553 9.821-4.789-4.789-4.017-4.017c-.351-.352-1.082-.772-1.7-.772-.531 0-1.052.106-1.39.309L4.241 4.259.533 11.984c-.132.281-.309.769-.309 1.082 0 .674.297 1.365.772 1.854l3.702 3.675c.089.108.192.219.315.342l.154.154.464.464 4.017 4.017.154.154h9.733v-4.172h4.171V9.976z"></path></svg>main.dart</div><div class="relative pt-3 pb-0 not-prose"><pre tabindex="0" class="prism-code language-dart bg-transparent !mt-0 !mb-0 m-0 px-0 pt-0 font-jetBrains-mono pb-3"><code class="font-[inherit] bg-transparent inline-block min-w-full"><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token string-literal string" style="color:#e3116c">'dart:ffi'</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token string-literal string" style="color:#e3116c">'package:ffi/ffi.dart'</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token string-literal string" style="color:#e3116c">'package:win32/win32.dart'</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">int </span><span class="token function" style="color:#d73a49">mainWindowProc</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">int hWnd</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> int uMsg</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> int wParam</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> int lParam</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">switch</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">uMsg</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">case</span><span class="token plain"> WM_DESTROY</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token class-name">PostQuitMessage</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">case</span><span class="token plain"> WM_PAINT</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> ps </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> calloc</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics">PAINTSTRUCT</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> hdc </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">BeginPaint</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">hWnd</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> ps</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> rect </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> calloc</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics">RECT</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> msg </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string-literal string" style="color:#e3116c">'Hello, Dart!'</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">toNativeUtf16</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token class-name">GetClientRect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">hWnd</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> rect</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token class-name">DrawText</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        hdc</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        msg</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        </span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        rect</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">        DT_CENTER </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">            DT_VCENTER </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">            DT_SINGLELINE</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token class-name">EndPaint</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">hWnd</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> ps</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">// Clean up</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token function" style="color:#d73a49">free</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ps</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token function" style="color:#d73a49">free</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">rect</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token function" style="color:#d73a49">free</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">msg</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token class-name">DefWindowProc</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">hWnd</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> uMsg</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> wParam</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> lParam</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div><div class="absolute top-2 right-2 flex items-center gap-2"><button type="button" aria-label="Copy code to clipboard" title="Copy code to clipboard" class="w-6 h-6 flex justify-center items-center bg-gray-200 dark:bg-gray-800 hover:bg-gray-300 dark:hover:bg-win32-react-dark-code rounded group transition-[background-color] duration-200 ease-in-out"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" class="w-3 h-3 text-gray-500 dark:text-gray-400 transition-all duration-200 ease-in-out" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill="none" d="M0 0h24v24H0z"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></button></div></div>
<p>Next, we'll define the <code>winMain</code> entry point, which creates the window and runs
the message loop.</p>
<div class="win32-common-code-block language-dart rounded-lg bg-win32-react-light-code dark:bg-win32-react-dark-code border border-gray-300 dark:border-0 mb-6 relative win32-wider-container"><div class="py-3 px-4 bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-100 text-xs flex items-center gap-2 rounded-tl-lg rounded-tr-lg"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"><path fill="#01579B" d="M5.013 18.936.996 14.92c-.476-.489-.772-1.18-.772-1.854 0-.312.176-.801.309-1.082l3.708-7.725z"></path><path fill="#40C4FF" d="m18.764 5.032-4.017-4.017c-.351-.352-1.082-.772-1.7-.772-.531 0-1.052.106-1.39.309L4.241 4.259zM9.803 23.726h9.733v-4.172l-7.261-2.317-6.644 2.317Z"></path><path fill="#29B6F6" d="M4.241 16.773c0 1.239.155 1.543.772 2.163l.618.618h13.905l-6.798-7.724-8.497-7.571z"></path><path fill="#01579B" d="M16.601 4.259H4.241l15.295 15.295h4.171V9.976l-4.943-4.944c-.694-.697-1.311-.772-2.163-.772"></path><path opacity=".2" fill="#FFF" d="M5.168 19.091c-.618-.62-.772-1.232-.772-2.318V4.414l-.154-.154v12.513c0 1.086 0 1.387.927 2.318l.464.464z"></path><path opacity=".2" fill="#263238" d="M23.553 9.821V19.4h-4.171l.154.154h4.172V9.976Z"></path><path opacity=".2" fill="#FFF" d="M18.764 5.032c-.766-.766-1.394-.772-2.318-.772H4.241l.154.154h12.051c.462 0 1.625-.077 2.318.618"></path><radialGradient id="a" cx="538.463" cy="539.28" r="528.383" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#fff" stop-opacity="0.1"></stop><stop offset="1" stop-color="#fff" stop-opacity="0"></stop></radialGradient><path opacity=".2" fill="url(#a)" d="m23.553 9.821-4.789-4.789-4.017-4.017c-.351-.352-1.082-.772-1.7-.772-.531 0-1.052.106-1.39.309L4.241 4.259.533 11.984c-.132.281-.309.769-.309 1.082 0 .674.297 1.365.772 1.854l3.702 3.675c.089.108.192.219.315.342l.154.154.464.464 4.017 4.017.154.154h9.733v-4.172h4.171V9.976z"></path></svg>main.dart</div><div class="relative pt-3 pb-0 not-prose"><pre tabindex="0" class="prism-code language-dart bg-transparent !mt-0 !mb-0 m-0 px-0 pt-0 font-jetBrains-mono pb-3"><code class="font-[inherit] bg-transparent inline-block min-w-full"><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// ...</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">winMain</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">int hInstance</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">List</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">String</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> args</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> int nShowCmd</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> className </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string-literal string" style="color:#e3116c">'Sample Window Class'</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">toNativeUtf16</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> lpfnWndProc </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">NativeCallable</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics">WNDPROC</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">isolateLocal</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    mainWindowProc</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    exceptionalReturn</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> wc </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> calloc</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics">WNDCLASS</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  wc</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ref</span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">style </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> CS_HREDRAW </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> CS_VREDRAW</span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">lpfnWndProc </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> lpfnWndProc</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">nativeFunction</span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">hInstance </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> hInstance</span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">lpszClassName </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> className</span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">hCursor </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">LoadCursor</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">NULL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> IDC_ARROW</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">hbrBackground </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">GetStockObject</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">WHITE_BRUSH</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token class-name">RegisterClass</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">wc</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Create the window.</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> windowCaption </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string-literal string" style="color:#e3116c">'Dart Native Win32 window'</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">toNativeUtf16</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> hWnd </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">CreateWindowEx</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// Optional window styles.</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    className</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// Window class</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    windowCaption</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// Window caption</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    WS_OVERLAPPEDWINDOW</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// Window style</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Size and position</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    CW_USEDEFAULT</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    CW_USEDEFAULT</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    CW_USEDEFAULT</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    CW_USEDEFAULT</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    NULL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// Parent window</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    NULL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// Menu</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    hInstance</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// Instance handle</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    nullptr</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// Additional application data</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">free</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">windowCaption</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">free</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">className</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token class-name">ShowWindow</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">hWnd</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> nShowCmd</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token class-name">UpdateWindow</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">hWnd</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Run the message loop.</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> msg </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> calloc</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics">MSG</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">while</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">GetMessage</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">msg</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> NULL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">TranslateMessage</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">msg</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">DispatchMessage</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">msg</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Clean up</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">free</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">msg</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">free</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">wc</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain">  lpfnWndProc</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">close</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div><div class="absolute top-2 right-2 flex items-center gap-2"><button type="button" aria-label="Copy code to clipboard" title="Copy code to clipboard" class="w-6 h-6 flex justify-center items-center bg-gray-200 dark:bg-gray-800 hover:bg-gray-300 dark:hover:bg-win32-react-dark-code rounded group transition-[background-color] duration-200 ease-in-out"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" class="w-3 h-3 text-gray-500 dark:text-gray-400 transition-all duration-200 ease-in-out" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill="none" d="M0 0h24v24H0z"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></button></div></div>
<p>Finally, we'll define the <code>main</code> function to initialize the application and call
the <code>winMain</code> function. The <strong>win32</strong> package provides the <code>initApp</code> helper
function, which sets up the WinMain function with all the necessary information,
including the entry point and command line arguments, simplifying the process
for you.</p>
<div class="win32-common-code-block language-dart rounded-lg bg-win32-react-light-code dark:bg-win32-react-dark-code border border-gray-300 dark:border-0 mb-6 relative win32-wider-container"><div class="py-3 px-4 bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-100 text-xs flex items-center gap-2 rounded-tl-lg rounded-tr-lg"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"><path fill="#01579B" d="M5.013 18.936.996 14.92c-.476-.489-.772-1.18-.772-1.854 0-.312.176-.801.309-1.082l3.708-7.725z"></path><path fill="#40C4FF" d="m18.764 5.032-4.017-4.017c-.351-.352-1.082-.772-1.7-.772-.531 0-1.052.106-1.39.309L4.241 4.259zM9.803 23.726h9.733v-4.172l-7.261-2.317-6.644 2.317Z"></path><path fill="#29B6F6" d="M4.241 16.773c0 1.239.155 1.543.772 2.163l.618.618h13.905l-6.798-7.724-8.497-7.571z"></path><path fill="#01579B" d="M16.601 4.259H4.241l15.295 15.295h4.171V9.976l-4.943-4.944c-.694-.697-1.311-.772-2.163-.772"></path><path opacity=".2" fill="#FFF" d="M5.168 19.091c-.618-.62-.772-1.232-.772-2.318V4.414l-.154-.154v12.513c0 1.086 0 1.387.927 2.318l.464.464z"></path><path opacity=".2" fill="#263238" d="M23.553 9.821V19.4h-4.171l.154.154h4.172V9.976Z"></path><path opacity=".2" fill="#FFF" d="M18.764 5.032c-.766-.766-1.394-.772-2.318-.772H4.241l.154.154h12.051c.462 0 1.625-.077 2.318.618"></path><radialGradient id="a" cx="538.463" cy="539.28" r="528.383" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#fff" stop-opacity="0.1"></stop><stop offset="1" stop-color="#fff" stop-opacity="0"></stop></radialGradient><path opacity=".2" fill="url(#a)" d="m23.553 9.821-4.789-4.789-4.017-4.017c-.351-.352-1.082-.772-1.7-.772-.531 0-1.052.106-1.39.309L4.241 4.259.533 11.984c-.132.281-.309.769-.309 1.082 0 .674.297 1.365.772 1.854l3.702 3.675c.089.108.192.219.315.342l.154.154.464.464 4.017 4.017.154.154h9.733v-4.172h4.171V9.976z"></path></svg>main.dart</div><div class="relative pt-3 pb-0 not-prose"><pre tabindex="0" class="prism-code language-dart bg-transparent !mt-0 !mb-0 m-0 px-0 pt-0 font-jetBrains-mono pb-3"><code class="font-[inherit] bg-transparent inline-block min-w-full"><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// ...</span><span class="token plain"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line px-4 text-xs sm:text-sm 2xl:text-sm" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">main</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">initApp</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">winMain</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div><div class="absolute top-2 right-2 flex items-center gap-2"><button type="button" aria-label="Copy code to clipboard" title="Copy code to clipboard" class="w-6 h-6 flex justify-center items-center bg-gray-200 dark:bg-gray-800 hover:bg-gray-300 dark:hover:bg-win32-react-dark-code rounded group transition-[background-color] duration-200 ease-in-out"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" class="w-3 h-3 text-gray-500 dark:text-gray-400 transition-all duration-200 ease-in-out" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill="none" d="M0 0h24v24H0z"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></button></div></div>
<p><img decoding="async" loading="lazy" alt="Dart Native Win32 Window" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAA4wAAAH4CAMAAAA2OJNuAAABO1BMVEUAAABBPz4yLSw5NTQ5NTMzLiwjIiEmJiA/PDo0MC8gICBAPjwyLS3////t8vju8vjr8vhCQD/v8PhBPz7x8PhAPjz87vD47/IAAAD27/T17/X67vD67vLz7/j17/bz7/ZAPz327/Xy8Pj27/P57vOEgIH67/L47/QuJyZIRkZnZGSvtLgrJyff1djVztHQz9VIRkW4vL+4t7u7trrp6+hlZWbe4N+DgYP1+fifnJ707/QbIB+9tri7uLrc4uadnJ/u8OzHztKhnJ22urygnJ6ZmJcBnYgCAwPV2OO/wcDOztjTztN0dHMAqIHx8/DT1tzJx8yQsMimq61Vk6yfnJ8AkI7k292tt7+BorhboK11tKWBgYMAsnnw5ufY3eLJz9PH6tKQyb6BmruV2rJ3up8tkph1cnDO0do8lJ04yMppAAAADXRSTlMA73Cvv4A0IN+UEM9gyi9+TQAADQ5JREFUeNrs3Glz0kAcx3G0XjMqRoaBP0dgBANJjIBgRBSl1mrVqq2t933r+38F/nbDEQghgWIT0v0qG6b2UcxndrMcMdap42tnL4pEokA6s3bydKzfuWMPuq9zrPx4l9PTKg/KOLqFsvYK/Yr9ZFapxAaU9Cjh0YV+cdFYF5ZY5M+xFHyf7z9oHLcsrv2+mhtlN5meXnmUEyNyxYjkYQfGiNwvlAhfPf4wCo0rpFGSdp6eiKHjv8HPRWOlUpmNETk1XnLXaBe5NIxIYHRgFBpXCaMkPcXcePrYVVeMCBin5zo5ZjLAOMoVI58bD6jR9UqJ8LXjH6PQuEoYdxqnY8cfpFKp+TGi6RgRMNobYhySlJel0e1KifClExfzYzyaHB+cjK11U1ZTMULj0jDyA0/2r3ERjNG9akKAMarnVQq8+2uxM69TMzVWWJeRU6MrxikaYZE1/y6OwBgGgdHXKAXe52OxiwOLu3fs7ebGOHKMi2scVrQSGEcJjeFICryLI4x794a9efNm73VuYm50XapmvDUiF4xo2RgjfcmEAWNET60UWE6M127auzbYYwVGnvt9Y7Va9aPRFSNaIsaIXzGhwBjNcystlrlFvC1T8pFxxTpeMWZifPzo+/e3b9/uXL9x4/qLFwOMKhGpsOh8zVHVMdTUcjk91KgqNo0o29GgUGGD1lHUgcYOEQGiQdQGRBtHo21nSHNiPAoXjNA4KiQYt3bv8r5sST66cvtK/+CBcX9//927JxMYa7m8QjX7xir1MVKXYeTPgVHfnJgauUZiDtlAtoVqq1g0TbnVkmWq2zGihTHG40fhevFEKDAeOka6O3gi+dXIh5kY7z96t//310OO8du3EUYoVPRpGDfUIUYsV4Fxikatlc2qGFra+Mv/HVNmaQApMC4J4yFqRFF6X4XEh0PByCEyi14Yf7169dDC+OPHGMZuA7MjUa2iKKTjic4x1nSFY1SJGmX243Kj1QDJzUZmk0jlGBUl29Ex8GNBUVRSuUatU5SRUcfQ1Eols83wac2k0SPCczYCY5OIegmtmahTIvHhg8DoA+NMjmKCnD4lHiJGaIRFT4zM4jOO8evXa1dTw2Vqvqbm0YZeUagymhlraaoBI6vRLesbZWBsNTIZa9xUGEbMiHoHg9biGGm7oHUKRaIW38Qx2zIqGaWSoZWaJseoJeuUbAJim/CsDqPNXjvZNpoJre7AGP0LJdwYI3KSJ2dGGhYcRlB89pFjZLupqZSFEQNmxjwR6XlFqVRsGDcaDOMGEXXTFsaMur2tZhRC2iUWZdXtLOGPNTMW2IPNjBo0Gi9ljtF82WxrdbPJMdaTeLTbfJnaM3Fot+sG/sWsawmB8YAbNwJj4PeMfpepzKKF8fk6w5gaYNSVHNXyGxbGCuGDjpc5RsyIKkTiyDDi0MooirKJYXjbqLO9VA2DHSMizI91mYc50Wy2XxolG8aeDWMPP9ewfv0gMIYOY6ROc5g2cP68f//+589dhnH9OjAiC6Ou5nKUyzX6GHEbyTgyjF0VGPV0DTOjoqSrwLitqplMi4a7OJuqks0qpNgxdrCBoxWUThHBIl+k1jXcOQ4x9ozRMhWPttZLmlpTYAwhxgidZ2mhtr5Yx51lvrRx/+b6+vpz/L2Jgc+MiL/OqLPJEQc9xzDmddKhkWNM61imEqmYGbtE1UYXd4w6ECpEZO2ublMLd47UsmM0iNRCQSdkco2aKWPNasOYNEcbOE0cALJnJATGMGKM0IkOz4v+e9f6PWbDHjByjZPN+EqO6tT34qDsoIK9Io9r9PE21cTUjsQ1EkqCUTzRUkA5MX66OtanVD8PjItqnPfDjQl3jQledK+RcFu0znQ0TrcUaByjd1M0pnnjn+aozqXR8cF/D4xeHUGMF0JUPApJAcYxzqlx7JNVyM/ciDw1en+CQ2AMM8ZInHBpjsKEERyBETnWqk6MLpPjEKNPjQKjjWHoNMajkOS/oDAid4zQONvjpXGNyO22EQmM/iyGUKPjlK/g/4Pkv8AwokmMCBitZu/kXPLSKA9aJsYof1XcBV74lqpxtIKf8pbCYXIBjNBozx2jh0YnRrREjFH+qriwYhw7z6u8RJECiGM8oEbucRZG5B8jWhLGFV4rrdbGzeRJj8R3LkjehQMjmsSIFsco21oWRrRaS6X/jDGRWM7v+Ne42rfvknfBYxySnMDo8YLjzJtG2aHRG+MRf2/cvEYSaNHf8S4qG60SKziOwHheJBKFIIFRJApJAqNI9I99OhYAAAAAGORvPY0d5dCEjDAhI0zICBMywoSMMCEjTMgIEzLChIwwISNMyAgTMsKEjDAhI0zICBMywoSMMCEjTMgIEzLChIwwISNMyAgTMsKEjDAhI0zICBMywoSMMCEjTMgIEzLChIwwIWPs0zERADAIALEa6MDh3ys2fkg8BCJkhAgZIUJGiJARImSECBkhQkaIkBEiZIQIGSFCRoiQESJkhAgZIUJGiJARImSECBkhQkaIkBEiZIQIGSFCRoiQESJkhAgZIUJGiJARImSECBkhQkaIkBEiZIQIGSFCRoiQESJkhAgZIUJGiJARImSECBkhQkaIkBEiZIQIGSFCRoiQESJkhIh5+4GAlREaZIQIGSFCRoiQESJkhAgZIUJGiJARImSECBkhQkaIkBEiZIQIGSFCRoiQkWOfjgUAAAAABvlbT2NHOcSEjDAhI0zICBMywoSMMCEjTMgIEzLChIwwISNMyAgTMsKEjDAhI0zICBMywoSMMCEjTMgIEzLChIwwISNMyAgTMsKEjDAhI0zICBMywoSMMCEjTMgIEzLChIwwISNMyAgTMsKEjDAhI0zICBMywoSMMCEjTMgIEzLChIwwISNMyAgTMsKEjDAhI0zICBMywoSMMCEjTMgIEzLChIwwISNMyAgTMsKEjDAhI0zICBMywoSMMCEjTMgIsVsHKQzCUABET9C99z9pSzCtIBbdTeA9yFdDcDdohBghQowQIUaIECNEiBEixAgRYoQIMUKEGCFCjBAhRogQI0SIESLECBFihAgxQoQYIUKMECFGiBAjRIgRIsQIEWKECDFChBghQowQIUaIECNEiBEixAgRYoQIMUKEGCFCjBAhRogQI0SIESLECBFihAgxQoQYIUKMECFGiBAjRIgRIsQIEWKECDFChBghQowQIUaIECNEiBEixAgRYoQIMUKEGCFCjBAhRogQI0SIsW/b5vztjHWyDVcvIU6MfU9iHOO8LcYViLHvUYxjinFJYuybiY2xXw7P/0/uxLgAMfZ9g3pdrFOMx7X5Mq5CjH2HxIYbMX7Mk35TlyHGvhnXvLsR4xhiXMybPTtGARgEAiD4/18HAhKrhHR7MgOKoO0iqBj7/se4D98aY4ixbyX2NtbJbXIzTiPGvq/X1C3G27NcO15TRxDjAYR2BjFChBghQowQIUaIECNEiBEixAgRYoQIMUKEGCFCjBAhRogQI0SIESLECBFihAgxQoQYIUKMECFGiBAjRIgRIsQIEWKECDFChBghQowQIUaIECNEiBEixAgRYoQIMUKEGCFCjBAhRogQI0SIESLECBFihAgxQoQYIUKMECFGiBAjRIgRIsQIEWKECDFChBghQowQIUaIECNEiBEixAgRYoQIMUKEGCFCjBAhRogQI0SIESLECBFivNinYwEAAACAQf7W09hRDsGEjDAhI0zICBMywoSMMCEjTMgIEzLChIwwISNMyAgTMsKEjDAhI0zICBMywoSMMCEjTMgIEzLChIwwISNMyAgTMsKEjDAhI0zICBMywoSMMCEjTMgIEzLChIwwISNMyAgTMsKEjDAhI0zICBMywoSMMCEjTMgIEzLChIwwISNMyAgTMsKEjDAhI0zICBMywoSMMCEjTMgIEzLChIwwISNMyAgTMsKEjDAhI0zICBMywoSMMCEjTMhI7NOxAAAAAMAgf+tp7CiHmJARJmSECRlhQkaYkBEmZIQJGWFCRpiQESZkhAkZYUJGmJARJmSECRlhQkaYkBEmZIQJGWFCRpiQESZkhAkZYUJGmJARJmSECRlhQkaYkBEmZIQJGWFCRpiQESZkhAkZYUJGmJARJmSECRlhQkaYkBEmZIQJGWFCRpiQESZkhAkZYUJGmJARJmSECRlhQkaYkBEmZIQJGWFCRpiQESZkhAkZYUJGmJARJmSECRlhQkaYkBEmZIQJGaF27OA0QiiMwuivURMH3mII2U8RYgcuBPuvJxPSQsK7DOf08HHhhhAjhBAjhBAjhBAjhBAjhBAjhBAjhBAjhBAjhBAjhBAjhBAjhBAjhBAjhBAjhBAjhBAjhBAjhBAjhBAjhBAjhBAjhBAjhBAjhBAjhPisj60B3W1DrWcDujunmo8GdHes9X7fG9DZPixV49WAzq65nqbLNkJX+/V2qx/j/Th9qtDJdh7DeKtfyzwNjz/zBa/l8b+GaV3q6RsY/QOl1cVkbwAAAABJRU5ErkJggg==" width="908" height="504" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="conclusion">Conclusion<a href="https://win32.pub/blog/calling-windows-apis#conclusion" class="hash-link" aria-label="Direct link to Conclusion" title="Direct link to Conclusion">​</a></h2>
<p>The <strong>win32</strong> package is a powerful tool for Dart developers aiming to leverage
the full capabilities of the Windows operating system. By bridging the gap
between Dart and the extensive Windows APIs, <strong>win32</strong> enables you to create
feature-rich applications with ease.</p>
<p>Whether you're displaying simple message boxes, querying system information, or
creating complex graphical interfaces, the <strong>win32</strong> package unlocks new
possibilities for your Dart projects. Start exploring today and discover what
you can build with Dart and Windows APIs!</p>
<p>For more detailed information, check out our <a href="https://win32.pub/docs">documentation</a>.</p>]]></content>
        <author>
            <name>Halil Durmus</name>
            <uri>https://halildurmus.dev</uri>
        </author>
        <category label="win32" term="win32"/>
        <category label="dart" term="dart"/>
    </entry>
</feed>